# 全局 Git 忽略 Office 临时文件实施计划

**创建时间**：2026-01-06 10:05
**优先级**：🔴 高（影响所有项目）
**状态**：待执行

---

## 一、问题背景

### 问题描述
在使用 Microsoft Office（Word/Excel/PowerPoint）编辑文件时，会自动生成临时文件，这些文件经常被误提交到 Git 仓库，造成污染：

1. **临时文件**：`~$文件名.docx`、`~$文件名.xlsx`
2. **自动恢复文件**：`~文件名.asd`
3. **文件锁**：`~$文件名.pptx`
4. **系统临时文件**：`._*`（Mac）、`Thumbs.db`（Windows）

### 影响范围
- 所有 Git 项目都会受到影响
- 每次 `git status` 都会显示这些临时文件
- 可能误提交到仓库，影响代码整洁度

---

## 二、解决方案

采用 **全局 Git 忽略** 方案，一次性配置，所有项目生效。

### 优势
- ✅ 一次配置，全局生效
- ✅ 不影响项目级 `.gitignore`
- ✅ 易于维护和更新
- ✅ 不需要修改每个项目

---

## 三、实施步骤

### 步骤 1：备份现有配置（安全措施）

```bash
# 备份现有的全局 .gitignore
cp ~/.gitignore_global ~/.gitignore_global.backup.$(date +%Y%m%d_%H%M%S)
```

**验证**：
```bash
ls -lh ~/.gitignore_global.backup.*
```

---

### 步骤 2：更新全局 `.gitignore_global`

在现有内容基础上，添加 Office 临时文件忽略规则：

```gitignore
# ============ Microsoft Office 临时文件 ============
# Word 临时文件
~$*.doc*
~$*.dot*
~$*.docx
~$*.dotx

# Excel 临时文件
~$*.xls*
~$*.xlsx
~$*.xlsm
~$*.xlsb

# PowerPoint 临时文件
~$*.ppt*
~$*.pptx

# Office 自动恢复文件
~*.asd
~*.wbk
*.tmp

# Office 文件锁（所有以 ~$ 开头的文件）
~$*

# ============ 其他常见临时文件 ============
# Mac OS
._*
.Spotlight-V100
.Trashes

# Windows
Thumbs.db
ehthumbs.db
Desktop.ini
$RECYCLE.BIN/

# 编辑器临时文件
*~
.swp
.swo
.*.sw[a-p]
*.bak

# LaTeX 临时文件（如果涉及 LaTeX 项目）
*.aux
*.log
*.out
*.toc
*.fls
*.fdb_latexmk
*.synctex.gz
```

---

### 步骤 3：验证配置

#### 3.1 检查全局配置路径

```bash
git config --global core.excludesfile
```

**预期输出**：`/Users/bensz/.gitignore_global`

#### 3.2 测试忽略规则

创建临时测试文件并验证：

```bash
# 进入任意 Git 项目
cd /path/to/test/project

# 创建测试临时文件
touch "~$test.docx"
touch "._test"
touch "Test.tmp"

# 检查是否被忽略
git check-ignore -v "~$test.docx"
git check-ignore -v "._test"
git check-ignore -v "Test.tmp"

# 清理测试文件
rm "~$test.docx" "._test" "Test.tmp"
```

**预期输出**：每个文件都显示被忽略，并匹配到全局 `.gitignore_global`

---

### 步骤 4：清理现有项目中的临时文件（可选）

如果某些项目中已经误提交了临时文件，需要清理：

#### 4.1 检查受影响的项目

```bash
# 在项目目录中查找临时文件
find . -name "~$*" -o -name "._*" -o -name "*.tmp"
```

#### 4.2 从 Git 中删除但保留本地文件

```bash
# 进入需要清理的项目
cd /path/to/affected/project

# 从 Git 历史中删除临时文件（但保留本地副本）
git rm --cached -r ~$*
git rm --cached -r ._*
git rm --cached --cached *.tmp

# 提交清理操作
git commit -m "chore: 移除 Office 临时文件和系统文件

- 添加全局 .gitignore 规则忽略 Office 临时文件
- 清理已提交的临时文件
- 保持仓库整洁"
```

#### 4.3 推送到远程仓库（如需要）

```bash
git push
```

---

## 四、验证清单

执行完成后，验证以下内容：

- [ ] 全局配置文件存在且包含新规则
- [ ] `git config --global core.excludesfile` 指向正确路径
- [ ] 创建测试临时文件时，`git status` 不再显示
- [ ] 现有项目不受影响（正常文件仍可提交）
- [ ] 备份文件已创建

---

## 五、预期效果

配置完成后：

### 立即生效
- ✅ 所有新建和现有的 Git 项目都会自动忽略 Office 临时文件
- ✅ `git status` 不会再显示 `~$*.docx` 等临时文件
- ✅ 避免误提交临时文件到仓库
- ✅ 保持仓库整洁

### 长期维护
- ✅ 无需为每个项目单独配置
- ✅ 统一的忽略规则，易于管理
- ✅ 新项目自动继承规则

---

## 六、注意事项

### 1. 不影响已有提交
全局忽略只影响**未跟踪的文件**，不会从历史记录中删除已提交的文件。

如果需要清理历史记录，参考步骤 4。

### 2. 项目级配置优先
如果某个项目需要跟踪这些文件（极少数情况），可以在项目内的 `.gitignore` 中使用 `!` 规则：

```gitignore
# 忽略所有临时文件（全局规则）
# 但例外：跟踪这个特定文件
!~$important.docx
```

### 3. 立即生效
配置后立即生效，无需重启 Git 或终端。

### 4. 跨平台兼容
规则已考虑 Mac 和 Windows 常见临时文件，跨平台项目都适用。

---

## 七、风险评估

**风险等级**：🟢 低风险

### 潜在风险
1. **误忽略重要文件**：极低概率，文件名以 `~$` 开头的文件几乎都是临时文件
2. **配置文件损坏**：已创建备份，可随时恢复
3. **团队协作问题**：不影响其他开发者，全局配置仅影响本地

### 缓解措施
- ✅ 执行前创建备份文件
- ✅ 使用 `git check-ignore -v` 验证规则
- ✅ 逐步测试，确认无问题后再清理历史记录

---

## 八、回滚方案

如果出现问题，恢复备份文件：

```bash
# 查找备份文件
ls -lh ~/.gitignore_global.backup.*

# 恢复最近的备份
cp ~/.gitignore_global.backup.20260106_100500 ~/.gitignore_global
```

---

## 九、后续维护

### 9.1 定期检查
每半年检查一次全局配置，确保规则完整：

```bash
# 查看当前全局忽略规则
cat ~/.gitignore_global
```

### 9.2 添加新规则
如果发现其他需要忽略的文件类型，直接添加到 `~/.gitignore_global`。

### 9.3 参考资源
- [Git 官方文档：gitignore](https://git-scm.com/docs/gitignore)
- [GitHub 的 gitignore 模板](https://github.com/github/gitignore)

---

## 十、执行时间表

| 步骤 | 预计时间 | 执行人 |
|------|----------|--------|
| 步骤 1：备份配置 | 1 分钟 | 用户 |
| 步骤 2：更新配置 | 2 分钟 | 用户 |
| 步骤 3：验证配置 | 3 分钟 | 用户 |
| 步骤 4：清理项目（可选） | 10-30 分钟 | 用户 |
| **总计** | **6-36 分钟** | - |

---

## 十一、相关文件

### 涉及文件
- `~/.gitignore_global` - 全局 Git 忽略配置
- `~/.gitignore_global.backup.*` - 配置备份文件
- `~/.gitconfig` - Git 全局配置文件

### 项目文件
- 本计划文档：`/Users/bensz/Documents/GitHub/ChineseResearchLaTeX/plans/v202601061005.md`

---

## 十二、成功标准

执行完成后，满足以下条件即为成功：

- ✅ 创建 Office 临时文件后，`git status` 不显示
- ✅ 现有项目正常提交不受影响
- ✅ 全局配置路径正确
- ✅ 备份文件已创建
- ✅ 通过所有验证清单

---

**下一步**：确认执行后，将立即开始实施步骤 1。

**是否开始执行？** 请回复 "确认" 或 "执行" 开始实施。
