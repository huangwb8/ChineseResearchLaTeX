# make_latex_model é€šç”¨åŒ–ä¼˜åŒ–è®¡åˆ’

**è®¡åˆ’ç¼–å·**: v202601052242
**åˆ›å»ºæ—¶é—´**: 2026-01-05 22:42
**çŠ¶æ€**: å¾…å®¡æ ¸
**ä¼˜å…ˆçº§**: P0

---

## ğŸ“‹ ç›®å½•

1. [é—®é¢˜æ¦‚è¿°](#é—®é¢˜æ¦‚è¿°)
2. [é€šç”¨æ€§ç›®æ ‡](#é€šç”¨æ€§ç›®æ ‡)
3. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
4. [åˆ†é˜¶æ®µå®æ–½è®¡åˆ’](#åˆ†é˜¶æ®µå®æ–½è®¡åˆ’)
5. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)
6. [é£é™©è¯„ä¼°](#é£é™©è¯„ä¼°)
7. [éªŒæ”¶æ ‡å‡†](#éªŒæ”¶æ ‡å‡†)

---

## é—®é¢˜æ¦‚è¿°

### å½“å‰å±€é™æ€§

`make_latex_model` æŠ€èƒ½å½“å‰è®¾è®¡é«˜åº¦ç»‘å®š NSFCï¼ˆå›½å®¶è‡ªç„¶ç§‘å­¦åŸºé‡‘ï¼‰é¡¹ç›®æ¨¡æ¿ï¼Œå­˜åœ¨ä»¥ä¸‹**é«˜ä¸¥é‡åº¦**é€šç”¨æ€§é—®é¢˜ï¼š

| é—®é¢˜ç±»åˆ« | å…·ä½“è¡¨ç° | å½±å“èŒƒå›´ |
|---------|---------|---------|
| **é¡¹ç›®ç±»å‹ç¡¬ç¼–ç ** | config.yaml ä»…å…è®¸ NSFC_Young/General/Local | æ— æ³•æ”¯æŒæ–°é¡¹ç›®ç±»å‹ |
| **æ ·å¼åŸºå‡†å›ºåŒ–** | æ ·å¼é…ç½®å†…åµŒ 2026 NSFC æ¨¡æ¿æ•°æ® | ä¸é€‚åº”å…¶ä»–æ¨¡æ¿æ ·å¼ |
| **æ ‡é¢˜ç»“æ„åˆšæ€§** | å›ºå®š 3 ä¸ªä¸€çº§æ ‡é¢˜ï¼Œæ¯ç»„æœ€å¤š 5 ä¸ªäºŒçº§æ ‡é¢˜ | æ— æ³•å¤„ç†çµæ´»æ–‡æ¡£ç»“æ„ |
| **è·¯å¾„ç¡¬ç¼–ç ** | validate.sh å›ºå®šæ£€æŸ¥ NSFC_Young é¡¹ç›® | å·¥å…·æ— æ³•å¤ç”¨ |

### é€šç”¨æ€§è¯„åˆ†

| ç»´åº¦ | å½“å‰è¯„åˆ† | ç›®æ ‡è¯„åˆ† |
|------|---------|---------|
| é¡¹ç›®ç±»å‹æ”¯æŒ | ğŸ”´ 1/5 | ğŸŸ¢ 5/5 |
| æ ·å¼é€‚åº”æ€§ | ğŸ”´ 2/5 | ğŸŸ¢ 5/5 |
| ç»“æ„çµæ´»æ€§ | ğŸŸ¡ 3/5 | ğŸŸ¢ 5/5 |
| å·¥å…·å¯ç§»æ¤æ€§ | ğŸŸ¡ 3/5 | ğŸŸ¢ 5/5 |
| éªŒè¯é€šç”¨æ€§ | ğŸ”´ 2/5 | ğŸŸ¢ 5/5 |

---

## é€šç”¨æ€§ç›®æ ‡

### æ ¸å¿ƒåŸåˆ™

1. **é…ç½®ä¸ä»£ç åˆ†ç¦»**ï¼šæ‰€æœ‰é¡¹ç›®ç‰¹å®šé…ç½®å¤–ç½®
2. **å‘åå…¼å®¹**ï¼šç°æœ‰ NSFC é¡¹ç›®æ— éœ€ä¿®æ”¹å³å¯ç»§ç»­ä½¿ç”¨
3. **æ¸è¿›å¢å¼º**ï¼šæ–°åŠŸèƒ½ä»¥æ’ä»¶å½¢å¼æ·»åŠ ï¼Œä¸ç ´åç°æœ‰åŠŸèƒ½
4. **æœ€å°æƒŠè®¶**ï¼šAPI è®¾è®¡ç¬¦åˆç”¨æˆ·ç›´è§‰

### è®¾è®¡ç›®æ ‡

| ç›®æ ‡ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **é¡¹ç›®æ— å…³æ€§** | æ”¯æŒä»»æ„ LaTeX æ¨¡æ¿é¡¹ç›®ï¼Œä¸é™å®šé¡¹ç›®ç±»å‹ | P0 |
| **é…ç½®å¤–éƒ¨åŒ–** | æ ·å¼åŸºå‡†ã€éªŒè¯è§„åˆ™ã€ç›®å½•ç»“æ„å‡å¯é…ç½® | P0 |
| **æ¨¡å—åŒ–å·¥å…·** | æ‰€æœ‰è„šæœ¬æ”¯æŒå‘½ä»¤è¡Œå‚æ•°ï¼Œæ— è·¯å¾„ç¡¬ç¼–ç  | P0 |
| **æ’ä»¶åŒ–éªŒè¯** | éªŒè¯è§„åˆ™å¯æ‰©å±•ï¼Œæ”¯æŒè‡ªå®šä¹‰æ£€æŸ¥é¡¹ | P1 |
| **æ¨¡æ¿ç»§æ‰¿** | æ”¯æŒæ¨¡æ¿é…ç½®ç»§æ‰¿å’Œå¤ç”¨ | P1 |

---

## æ¶æ„è®¾è®¡

### æ–°ç›®å½•ç»“æ„

```
skills/make_latex_model/
â”œâ”€â”€ SKILL.md                    # æŠ€èƒ½ä¸»æ–‡æ¡£
â”œâ”€â”€ config.yaml                 # æŠ€èƒ½é»˜è®¤é…ç½®ï¼ˆå‘åå…¼å®¹ï¼‰
â”œâ”€â”€ core/                       # æ ¸å¿ƒæ¨¡å—ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ template_base.py        # æ¨¡æ¿åŸºç±»
â”‚   â”œâ”€â”€ config_loader.py        # é…ç½®åŠ è½½å™¨
â”‚   â””â”€â”€ validator_base.py       # éªŒè¯å™¨åŸºç±»
â”œâ”€â”€ templates/                  # æ¨¡æ¿é…ç½®ç›®å½•ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ nsfc/                   # NSFC æ¨¡æ¿ç³»åˆ—
â”‚   â”‚   â”œâ”€â”€ young.yaml          # é’å¹´åŸºé‡‘é…ç½®
â”‚   â”‚   â”œâ”€â”€ general.yaml        # é¢ä¸Šé¡¹ç›®é…ç½®
â”‚   â”‚   â””â”€â”€ local.yaml          # åœ°åŒºé¡¹ç›®é…ç½®
â”‚   â””â”€â”€ thesis/                 # æ¯•ä¸šè®ºæ–‡æ¨¡æ¿ï¼ˆç¤ºä¾‹ï¼‰
â”‚       â””â”€â”€ bachelor.yaml       # æœ¬ç§‘æ¯•ä¸šè®ºæ–‡
â”œâ”€â”€ scripts/                    # å·¥å…·è„šæœ¬ï¼ˆé‡æ„ï¼‰
â”‚   â”œâ”€â”€ validate.sh             # éªŒè¯è„šæœ¬ï¼ˆæ”¯æŒå‚æ•°ï¼‰
â”‚   â”œâ”€â”€ benchmark.sh            # æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ extract_headings.py     # æ ‡é¢˜æå–ï¼ˆæ”¯æŒé…ç½®ï¼‰
â”‚   â”œâ”€â”€ compare_headings.py     # æ ‡é¢˜å¯¹æ¯”ï¼ˆæ”¯æŒé…ç½®ï¼‰
â”‚   â””â”€â”€ apply_template.py       # æ¨¡æ¿åº”ç”¨å·¥å…·ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ validators/                 # éªŒè¯æ’ä»¶ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ compilation.py          # ç¼–è¯‘æ£€æŸ¥
â”‚   â”œâ”€â”€ style_params.py         # æ ·å¼å‚æ•°æ£€æŸ¥
â”‚   â”œâ”€â”€ heading_consistency.py  # æ ‡é¢˜ä¸€è‡´æ€§æ£€æŸ¥
â”‚   â””â”€â”€ visual_similarity.py    # è§†è§‰ç›¸ä¼¼åº¦æ£€æŸ¥
â””â”€â”€ tests/                      # æµ‹è¯•ç”¨ä¾‹
    â””â”€â”€ ...
```

### æ ¸å¿ƒæ¨¡å—è®¾è®¡

#### 1. é…ç½®åŠ è½½å™¨ (config_loader.py)

```python
class ConfigLoader:
    """åˆ†å±‚é…ç½®åŠ è½½å™¨"""

    def __init__(self, project_path: str, template_name: str = None):
        self.project_path = Path(project_path)
        self.template_name = template_name or self._detect_template()

    def load(self) -> Dict:
        """åŠ è½½åˆå¹¶åçš„é…ç½®

        ä¼˜å…ˆçº§ï¼ˆä»ä½åˆ°é«˜ï¼‰:
        1. æŠ€èƒ½é»˜è®¤é…ç½® (skills/make_latex_model/config.yaml)
        2. æ¨¡æ¿åŸºç¡€é…ç½® (templates/{template}/{template}.yaml)
        3. é¡¹ç›®æœ¬åœ°é…ç½® (projects/{project}/.template.yaml)
        """
        return self._merge_configs([
            self._load_default_config(),
            self._load_template_config(),
            self._load_local_config()
        ])

    def _detect_template(self) -> str:
        """è‡ªåŠ¨æ£€æµ‹é¡¹ç›®ä½¿ç”¨çš„æ¨¡æ¿ç±»å‹"""
        # æ–¹æ³•1: æ£€æŸ¥é¡¹ç›®ç›®å½•ä¸‹çš„ .template.yaml
        # æ–¹æ³•2: æ ¹æ® main.tex çš„æ ‡é¢˜ç»“æ„æ¨æ–­
        # æ–¹æ³•3: æ ¹æ®ç›®å½•ç»“æ„æ¨æ–­
        pass
```

#### 2. æ¨¡æ¿åŸºç±» (template_base.py)

```python
class TemplateBase:
    """LaTeX æ¨¡æ¿åŸºç±»"""

    def __init__(self, config: Dict):
        self.config = config
        self.style_reference = config.get('style_reference', {})

    def extract_headings(self, source_file: Path) -> Dict[str, str]:
        """æå–æ ‡é¢˜ï¼ˆæŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å®ç°ï¼‰"""
        raise NotImplementedError

    def validate_structure(self, project_path: Path) -> ValidationResult:
        """éªŒè¯é¡¹ç›®ç»“æ„æ˜¯å¦ç¬¦åˆæ¨¡æ¿è¦æ±‚"""
        pass

    def get_style_rules(self) -> StyleRules:
        """è·å–æ ·å¼è§„åˆ™"""
        return StyleRules(
            fonts=self.style_reference.get('fonts', {}),
            colors=self.style_reference.get('colors', {}),
            page=self.style_reference.get('page', {}),
            headings=self.style_reference.get('headings', {})
        )
```

#### 3. éªŒè¯å™¨åŸºç±» (validator_base.py)

```python
class ValidatorBase(ABC):
    """éªŒè¯å™¨åŸºç±»"""

    @abstractmethod
    def get_name(self) -> str:
        """è¿”å›éªŒè¯å™¨åç§°"""
        pass

    @abstractmethod
    def get_priority(self) -> int:
        """è¿”å›ä¼˜å…ˆçº§ï¼ˆ1=æœ€é«˜ï¼‰"""
        pass

    @abstractmethod
    def validate(self, context: ValidationContext) -> ValidationResult:
        """æ‰§è¡ŒéªŒè¯"""
        pass

class ValidationResult:
    """éªŒè¯ç»“æœ"""

    def __init__(self):
        self.passed = []
        self.warnings = []
        self.failed = []

    def is_success(self) -> bool:
        return len(self.failed) == 0
```

### æ¨¡æ¿é…ç½®æ–‡ä»¶æ ¼å¼

#### templates/nsfc/young.yaml

```yaml
# NSFC é’å¹´åŸºé‡‘æ¨¡æ¿é…ç½®
template:
  name: "NSFC_Young"
  display_name: "å›½å®¶è‡ªç„¶ç§‘å­¦åŸºé‡‘-é’å¹´ç§‘å­¦åŸºé‡‘é¡¹ç›®"
  version: "2026"
  inherits: "nsfc/base"  # ç»§æ‰¿åŸºç¡€é…ç½®

# ç›®å½•ç»“æ„å®šä¹‰
structure:
  content_dir: "extraTex"       # å†…å®¹æ–‡ä»¶ç›®å½•
  config_file: "@config.tex"    # æ ·å¼é…ç½®æ–‡ä»¶
  main_file: "main.tex"         # ä¸»æ–‡ä»¶
  template_dir: "template"      # Word æ¨¡æ¿ç›®å½•

# æ ‡é¢˜ç»“æ„å®šä¹‰
heading_structure:
  sections:
    - id: "section_1"
      pattern: r'\\section\{([^}]+)\}'
      max_subsections: 5
    - id: "section_2"
      pattern: r'\\section\{([^}]+)\}'
      max_subsections: 4
    - id: "section_3"
      pattern: r'\\section\{([^}]+)\}'
      max_subsections: 5

# æ ·å¼å‚è€ƒåŸºå‡†
style_reference:
  heading_texts:
    section_1: "ï¼ˆä¸€ï¼‰ç«‹é¡¹ä¾æ®ä¸ç ”ç©¶å†…å®¹}(å»ºè®®8000å­—ä»¥å†…ï¼‰ï¼š"
    # ... å…¶ä»–æ ‡é¢˜

  colors:
    MsBlue: "RGB 0,112,192"

  fonts:
    chinese_main: "KaiTi"
    english_main: "Times New Roman"

  # ... å…¶ä»–æ ·å¼é…ç½®

# éªŒè¯è§„åˆ™
validation:
  enabled_validators:
    - compilation
    - style_params
    - heading_consistency
    - visual_similarity

  tolerance:
    font_size_diff: 0.5
    color_diff: 2
    spacing_diff: 0.05
    margin_diff: 0.5
```

---

## åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

### Phase 0: å‡†å¤‡é˜¶æ®µ (1-2å¤©)

**ç›®æ ‡**: å»ºç«‹åŸºç¡€è®¾æ–½ï¼Œç¡®ä¿å‘åå…¼å®¹

| ä»»åŠ¡ | æè¿° | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|------|------|--------|---------|
| 0.1 | åˆ›å»ºæ–°ç›®å½•ç»“æ„ | core/, templates/, validators/ | ç›®å½•åˆ›å»ºå®Œæˆ |
| 0.2 | æå–ç°æœ‰é…ç½®åˆ°æ¨¡æ¿æ–‡ä»¶ | åˆ›å»º templates/nsfc/young.yaml | é…ç½®å®Œå…¨ä¸€è‡´ |
| 0.3 | ç¼–å†™å‘åå…¼å®¹æµ‹è¯• | ç¡®ä¿ç°æœ‰é¡¹ç›®æ— éœ€ä¿®æ”¹ | æµ‹è¯•å…¨éƒ¨é€šè¿‡ |
| 0.4 | æ–‡æ¡£æ›´æ–°è®¡åˆ’ | åˆ—å‡ºéœ€è¦æ›´æ–°çš„æ–‡æ¡£ | æ–‡æ¡£æ¸…å• |

### Phase 1: P0 æ ¸å¿ƒé‡æ„ (3-5å¤©)

**ç›®æ ‡**: è§£å†³é«˜ä¸¥é‡åº¦é—®é¢˜ï¼Œå®ç°åŸºç¡€é€šç”¨æ€§

#### 1.1 é…ç½®ç³»ç»Ÿé‡æ„ (2å¤©)

**ä»»åŠ¡æ¸…å•**:

- [ ] **1.1.1** å®ç° `ConfigLoader` ç±»
  - æ”¯æŒä¸‰å±‚é…ç½®åˆå¹¶
  - æ”¯æŒé…ç½®ç»§æ‰¿
  - å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90%

- [ ] **1.1.2** è¿ç§» NSFC é…ç½®åˆ°æ¨¡æ¿æ–‡ä»¶
  - `templates/nsfc/base.yaml` (åŸºç¡€é…ç½®)
  - `templates/nsfc/young.yaml` (é’å¹´åŸºé‡‘)
  - `templates/nsfc/general.yaml` (é¢ä¸Šé¡¹ç›®)
  - `templates/nsfc/local.yaml` (åœ°åŒºåŸºé‡‘)

- [ ] **1.1.3** æ›´æ–° `config.yaml` ä¸ºé»˜è®¤é…ç½®
  - ç§»é™¤é¡¹ç›®ç‰¹å®šé…ç½®
  - ä¿ç•™æŠ€èƒ½çº§åˆ«è®¾ç½®
  - æ·»åŠ é…ç½®è¿ç§»æŒ‡å—

**éªŒæ”¶æ ‡å‡†**:
```bash
# ç°æœ‰é¡¹ç›®æ— éœ€ä¿®æ”¹å³å¯ä½¿ç”¨
cd projects/NSFC_Young
# åº”è‡ªåŠ¨æ£€æµ‹ä½¿ç”¨ nsfc/young æ¨¡æ¿
make_latex_model --validate
```

#### 1.2 å·¥å…·è„šæœ¬é‡æ„ (1-2å¤©)

**ä»»åŠ¡æ¸…å•**:

- [ ] **1.2.1** é‡æ„ `validate.sh`
  ```bash
  # ä¿®æ”¹å‰
  ./scripts/validate.sh  # åªèƒ½éªŒè¯ NSFC_Young

  # ä¿®æ”¹å
  ./scripts/validate.sh --project ../projects/NSFC_General
  ./scripts/validate.sh --project ../projects/MyThesis --template thesis/bachelor
  ```

- [ ] **1.2.2** é‡æ„ `extract_headings.py`
  ```bash
  # æ”¯æŒè‡ªå®šä¹‰æ ‡é¢˜ç»“æ„
  python scripts/extract_headings.py \
    --file main.tex \
    --config templates/nsfc/young.yaml
  ```

- [ ] **1.2.3** é‡æ„ `compare_headings.py`
  - æ”¯æŒè‡ªå®šä¹‰åŒ¹é…è§„åˆ™
  - æ”¯æŒä¸åŒçš„æ ‡é¢˜å±‚çº§ç»“æ„

**éªŒæ”¶æ ‡å‡†**:
```bash
# æ‰€æœ‰å·¥å…·æ”¯æŒ --project å’Œ --template å‚æ•°
# æ‰€æœ‰å·¥å…·æ— è·¯å¾„ç¡¬ç¼–ç 
# æ‰€æœ‰å·¥å…·å¸®åŠ©æ–‡æ¡£å®Œæ•´
```

#### 1.3 æ ‡é¢˜ç»“æ„é€šç”¨åŒ– (1å¤©)

**ä»»åŠ¡æ¸…å•**:

- [ ] **1.3.1** å®ç°å¯é…ç½®çš„æ ‡é¢˜ç»“æ„
  ```yaml
  heading_structure:
    sections:
      - id: "section_1"
        level: 1
        latex_command: "section"
        max_children: 5
      - id: "section_2"
        level: 1
        latex_command: "section"
        max_children: 4
  ```

- [ ] **1.3.2** æ›´æ–°æ ‡é¢˜æå–é€»è¾‘
  - åŸºäºé…ç½®åŠ¨æ€æå–
  - æ”¯æŒä»»æ„æ•°é‡çš„ç« èŠ‚
  - æ”¯æŒä»»æ„æ·±åº¦çš„åµŒå¥—

**éªŒæ”¶æ ‡å‡†**:
```bash
# æ”¯æŒé NSFC ç»“æ„çš„æ–‡æ¡£
python scripts/extract_headings.py \
  --file thesis.tex \
  --config templates/thesis/bachelor.yaml
```

### Phase 2: P1 åŠŸèƒ½å¢å¼º (2-3å¤©)

**ç›®æ ‡**: æå‡é€šç”¨æ€§ï¼Œæ”¯æŒæ–°æ¨¡æ¿ç±»å‹

#### 2.1 éªŒè¯å™¨æ’ä»¶åŒ– (1.5å¤©)

**ä»»åŠ¡æ¸…å•**:

- [ ] **2.1.1** å®ç° `ValidatorBase` æŠ½è±¡ç±»
- [ ] **2.1.2** è¿ç§»ç°æœ‰éªŒè¯é€»è¾‘åˆ°æ’ä»¶
  - `validators/compilation.py`
  - `validators/style_params.py`
  - `validators/heading_consistency.py`
- [ ] **2.1.3** å®ç°æ’ä»¶å‘ç°å’ŒåŠ è½½æœºåˆ¶
  ```python
  # è‡ªåŠ¨åŠ è½½ validators/ ç›®å½•ä¸‹çš„æ‰€æœ‰éªŒè¯å™¨
  validators = ValidatorRegistry.load_all()
  ```

**éªŒæ”¶æ ‡å‡†**:
```bash
# å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„éªŒè¯å™¨
# åªéœ€ç»§æ‰¿ ValidatorBase å¹¶æ”¾åˆ° validators/ ç›®å½•
```

#### 2.2 ç¤ºä¾‹æ¨¡æ¿å®ç° (1å¤©)

**ä»»åŠ¡æ¸…å•**:

- [ ] **2.2.1** å®ç°æ¯•ä¸šè®ºæ–‡æ¨¡æ¿
  ```yaml
  # templates/thesis/bachelor.yaml
  template:
    name: "Thesis_Bachelor"
    display_name: "æœ¬ç§‘æ¯•ä¸šè®ºæ–‡"

  heading_structure:
    sections:
      - id: "chapter_1"  # ç»ªè®º
        max_children: 3
      # ... æ›´å¤šç« èŠ‚
  ```

- [ ] **2.2.2** æ·»åŠ ç¤ºä¾‹é¡¹ç›®
  - `projects/Thesis_Bachelor/`

**éªŒæ”¶æ ‡å‡†**:
```bash
# å¯ä»¥å¤„ç†å®Œå…¨ä¸åŒçš„æ–‡æ¡£ç»“æ„
make_latex_model \
  --project projects/Thesis_Bachelor \
  --template thesis/bachelor
```

#### 2.3 æ¨¡æ¿åº”ç”¨å·¥å…· (0.5å¤©)

**ä»»åŠ¡æ¸…å•**:

- [ ] **2.3.1** å®ç° `apply_template.py`
  ```bash
  # ä¸ºç°æœ‰é¡¹ç›®åº”ç”¨æ¨¡æ¿
  python scripts/apply_template.py \
    --project projects/MyProject \
    --template nsfc/young
  ```

**éªŒæ”¶æ ‡å‡†**:
```bash
# ä¸€é”®ä¸ºæ–°é¡¹ç›®é…ç½®æ¨¡æ¿
# è‡ªåŠ¨ç”Ÿæˆ @config.tex
# è‡ªåŠ¨ç”Ÿæˆ main.tex éª¨æ¶
```

### Phase 3: P2 ä¼˜åŒ–å®Œå–„ (1-2å¤©)

**ç›®æ ‡**: é”¦ä¸Šæ·»èŠ±ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

#### 3.1 æ¨¡æ¿ç»§æ‰¿æœºåˆ¶ (0.5å¤©)

**ä»»åŠ¡æ¸…å•**:

- [ ] **3.1.1** å®ç°é…ç½®ç»§æ‰¿
  ```yaml
  # templates/nsfc/young.yaml
  template:
    inherits: "nsfc/base"

  # å¯ä»¥è¦†ç›–åŸºç¡€é…ç½®çš„ä»»æ„éƒ¨åˆ†
  style_reference:
    heading_texts:
      section_1: "è¦†ç›–åŸºç¡€é…ç½®çš„æ ‡é¢˜"
  ```

#### 3.2 äº¤äº’å¼æ¨¡æ¿åˆ›å»º (0.5å¤©)

**ä»»åŠ¡æ¸…å•**:

- [ ] **3.2.1** å®ç°æ¨¡æ¿å‘å¯¼
  ```bash
  python scripts/create_template.py --interactive
  # å¼•å¯¼ç”¨æˆ·åˆ›å»ºæ–°æ¨¡æ¿
  ```

#### 3.3 æ–‡æ¡£å’Œæ•™ç¨‹ (0.5-1å¤©)

**ä»»åŠ¡æ¸…å•**:

- [ ] **3.3.1** ç¼–å†™ã€Šæ¨¡æ¿å¼€å‘æŒ‡å—ã€‹
- [ ] **3.3.2** ç¼–å†™ã€ŠéªŒè¯å™¨å¼€å‘æŒ‡å—ã€‹
- [ ] **3.3.3** æ›´æ–° SKILL.md
- [ ] **3.3.4** åˆ›å»ºç¤ºä¾‹å’Œæ•™ç¨‹

---

## æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”

```
        /\
       /E2E\        ç«¯åˆ°ç«¯æµ‹è¯• (5%)
      /------\
     /  é›†æˆ  \     é›†æˆæµ‹è¯• (20%)
    /----------\
   /    å•å…ƒ    \   å•å…ƒæµ‹è¯• (75%ï¼‰
  /--------------\
```

### æµ‹è¯•ç”¨ä¾‹åˆ†ç±»

#### 1. å‘åå…¼å®¹æµ‹è¯•

```python
# test_backward_compat.py
def test_nsfc_young_no_config_change():
    """ç°æœ‰ NSFC_Young é¡¹ç›®æ— éœ€ä»»ä½•ä¿®æ”¹"""
    project = load_project("projects/NSFC_Young")
    result = validate(project)

    assert result.is_success()
    assert result.passed == ["ç¼–è¯‘æˆåŠŸ", "æ ·å¼ä¸€è‡´", "æ ‡é¢˜åŒ¹é…"]

def test_nsfc_general_no_config_change():
    """ç°æœ‰ NSFC_General é¡¹ç›®æ— éœ€ä»»ä½•ä¿®æ”¹"""
    # åŒä¸Š
```

#### 2. é…ç½®ç³»ç»Ÿæµ‹è¯•

```python
# test_config_loader.py
def test_config_merge_priority():
    """é…ç½®åˆå¹¶ä¼˜å…ˆçº§æ­£ç¡®"""
    loader = ConfigLoader("test_project")

    # é¡¹ç›®æœ¬åœ°é…ç½® > æ¨¡æ¿é…ç½® > é»˜è®¤é…ç½®
    assert loader.config["key"] == "local_value"

def test_config_inheritance():
    """é…ç½®ç»§æ‰¿æ­£ç¡®"""
    child = load_template("nsfc/young")
    parent = load_template("nsfc/base")

    assert child.inherits == "nsfc/base"
    assert child.get("fonts") == parent.get("fonts")
```

#### 3. å·¥å…·è„šæœ¬æµ‹è¯•

```bash
# test_scripts.sh
test_validate_sh_supports_project_param() {
  ./scripts/validate.sh --project test_project
  assert_eq $? 0
}

test_validate_sh_supports_template_param() {
  ./scripts/validate.sh \
    --project custom_project \
    --template thesis/bachelor
  assert_eq $? 0
}
```

#### 4. è·¨æ¨¡æ¿æµ‹è¯•

```python
# test_cross_template.py
def test_different_heading_structure():
    """æ”¯æŒä¸åŒçš„æ ‡é¢˜ç»“æ„"""
    thesis = load_template("thesis/bachelor")

    headings = thesis.extract_headings("thesis.tex")
    assert len(headings["chapters"]) == 6  # 6ç« 
    assert headings["max_depth"] == 3      # 3çº§æ ‡é¢˜
```

### æµ‹è¯•æ‰§è¡Œè®¡åˆ’

| é˜¶æ®µ | æµ‹è¯•ç±»å‹ | è¦†ç›–ç‡ç›®æ ‡ | æ‰§è¡Œé¢‘ç‡ |
|------|---------|-----------|---------|
| Phase 0 | å›å½’æµ‹è¯• | 100% | æ¯æ¬¡æäº¤ |
| Phase 1 | å•å…ƒ+é›†æˆ | 80% | æ¯æ—¥ |
| Phase 2 | E2Eæµ‹è¯• | 60% | æ¯å‘¨ |
| Phase 3 | å…¨é¢æµ‹è¯• | 85% | å‘å¸ƒå‰ |

---

## é£é™©è¯„ä¼°

### é£é™©çŸ©é˜µ

| é£é™© | æ¦‚ç‡ | å½±å“ | ç­‰çº§ | ç¼“è§£æªæ–½ |
|------|------|------|------|---------|
| ç ´åç°æœ‰é¡¹ç›® | ä¸­ | é«˜ | ğŸ”´ é«˜ | å‘åå…¼å®¹æµ‹è¯• + ç°åº¦å‘å¸ƒ |
| é…ç½®å¤æ‚åº¦å¢åŠ  | é«˜ | ä¸­ | ğŸŸ¡ ä¸­ | æä¾›é…ç½®å‘å¯¼ + é»˜è®¤æ¨¡æ¿ |
| æ€§èƒ½ä¸‹é™ | ä½ | ä¸­ | ğŸŸ¢ ä½ | æ€§èƒ½åŸºå‡†æµ‹è¯• |
| ç”¨æˆ·å­¦ä¹ æˆæœ¬ | ä¸­ | ä¸­ | ğŸŸ¡ ä¸­ | è¯¦ç»†æ–‡æ¡£ + è¿ç§»æŒ‡å— |
| å·¥æœŸå»¶è¯¯ | ä¸­ | é«˜ | ğŸŸ¡ ä¸­ | åˆ†é˜¶æ®µäº¤ä»˜ + MVPä¼˜å…ˆ |

### å›æ»šè®¡åˆ’

**è§¦å‘æ¡ä»¶**:
- å‘åå…¼å®¹æµ‹è¯•å¤±è´¥ç‡ > 10%
- å…³é”®åŠŸèƒ½å›å½’
- ç”¨æˆ·åé¦ˆä¸¥é‡é—®é¢˜

**å›æ»šæ­¥éª¤**:
1. ç«‹å³åœæ­¢åˆå¹¶æ–°ä»£ç 
2. æ¢å¤åˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬
3. åˆ†æå¤±è´¥åŸå› 
4. ä¿®å¤åé‡æ–°æµ‹è¯•

---

## éªŒæ”¶æ ‡å‡†

### Phase 0 éªŒæ”¶

- [ ] æ–°ç›®å½•ç»“æ„åˆ›å»ºå®Œæˆ
- [ ] NSFC é…ç½®è¿ç§»åˆ°æ¨¡æ¿æ–‡ä»¶
- [ ] ç°æœ‰é¡¹ç›®å‘åå…¼å®¹æµ‹è¯•é€šè¿‡
- [ ] CI/CD é›†æˆå®Œæˆ

### Phase 1 éªŒæ”¶

- [ ] é…ç½®ç³»ç»Ÿæ”¯æŒä¸‰å±‚åˆå¹¶å’Œç»§æ‰¿
- [ ] æ‰€æœ‰å·¥å…·è„šæœ¬æ”¯æŒ `--project` å’Œ `--template` å‚æ•°
- [ ] æ ‡é¢˜ç»“æ„æ”¯æŒè‡ªå®šä¹‰é…ç½®
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 75%
- [ ] ç°æœ‰ NSFC é¡¹ç›®é›¶ä¿®æ”¹å¯ç”¨

### Phase 2 éªŒæ”¶

- [ ] éªŒè¯å™¨æ’ä»¶åŒ–å®Œæˆ
- [ ] è‡³å°‘å®ç° 1 ä¸ªé NSFC æ¨¡æ¿
- [ ] å¯ä»¥è½»æ¾æ·»åŠ æ–°æ¨¡æ¿
- [ ] é›†æˆæµ‹è¯•è¦†ç›–ç‡ > 60%
- [ ] ç”¨æˆ·æ–‡æ¡£å®Œæ•´

### Phase 3 éªŒæ”¶

- [ ] æ¨¡æ¿ç»§æ‰¿æœºåˆ¶å·¥ä½œæ­£å¸¸
- [ ] äº¤äº’å¼æ¨¡æ¿åˆ›å»ºå¯ç”¨
- [ ] æ–‡æ¡£å’Œæ•™ç¨‹å®Œæ•´
- [ ] æ•´ä½“æµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ€§èƒ½ä¸ä½äºä¼˜åŒ–å‰

### æœ€ç»ˆéªŒæ”¶

**é€šç”¨æ€§æŒ‡æ ‡**:

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | éªŒæ”¶æ–¹æ³• |
|------|------|------|---------|
| æ”¯æŒé¡¹ç›®ç±»å‹ | 3 | æ— é™åˆ¶ | æ·»åŠ æ–°æ¨¡æ¿æµ‹è¯• |
| é…ç½®çµæ´»æ€§ | ä½ | é«˜ | é…ç½®è¦†ç›–åº¦æµ‹è¯• |
| å·¥å…·å¯ç§»æ¤æ€§ | ä½ | é«˜ | è·¨é¡¹ç›®ä½¿ç”¨æµ‹è¯• |
| å­¦ä¹ æ›²çº¿ | é™¡å³­ | å¹³ç¼“ | æ–°ç”¨æˆ·ä¸Šæ‰‹æµ‹è¯• |

**è´¨é‡æŒ‡æ ‡**:

- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å®¡æŸ¥é€šè¿‡
- [ ] Beta ç”¨æˆ·åé¦ˆæ­£é¢
- [ ] æ€§èƒ½åŸºå‡†è¾¾æ ‡

---

## é™„å½•

### A. é…ç½®æ–‡ä»¶è¿ç§»ç¤ºä¾‹

#### æ—§é…ç½® (config.yaml)

```yaml
style_reference:
  heading_texts:
    section_1: "ï¼ˆä¸€ï¼‰ç«‹é¡¹ä¾æ®ä¸ç ”ç©¶å†…å®¹}"
    # ... ç¡¬ç¼–ç çš„ NSFC é…ç½®
```

#### æ–°é…ç½®

**skills/make_latex_model/config.yaml** (é»˜è®¤é…ç½®):
```yaml
# æŠ€èƒ½çº§åˆ«é»˜è®¤é…ç½®
validation:
  max_iterations: 3
```

**templates/nsfc/base.yaml** (NSFC åŸºç¡€é…ç½®):
```yaml
template:
  name: "NSFC_Base"
  display_name: "å›½å®¶è‡ªç„¶ç§‘å­¦åŸºé‡‘åŸºç¡€æ¨¡æ¿"

style_reference:
  colors:
    MsBlue: "RGB 0,112,192"
  # ... NSFC é€šç”¨é…ç½®
```

**templates/nsfc/young.yaml** (é’å¹´åŸºé‡‘é…ç½®):
```yaml
template:
  name: "NSFC_Young"
  inherits: "nsfc/base"

style_reference:
  heading_texts:
    section_1: "ï¼ˆä¸€ï¼‰ç«‹é¡¹ä¾æ®ä¸ç ”ç©¶å†…å®¹}"
    # ... é’å¹´åŸºé‡‘ç‰¹å®šé…ç½®
```

### B. å‘½ä»¤è¡Œæ¥å£å¯¹æ¯”

#### ä¿®æ”¹å‰

```bash
# åªèƒ½éªŒè¯ NSFC_Young
./scripts/validate.sh

# æ— æ³•æŒ‡å®šé¡¹ç›®æˆ–æ¨¡æ¿
```

#### ä¿®æ”¹å

```bash
# éªŒè¯æŒ‡å®šé¡¹ç›®
./scripts/validate.sh --project ../projects/NSFC_General

# ä½¿ç”¨æŒ‡å®šæ¨¡æ¿
./scripts/validate.sh \
  --project ../projects/MyProject \
  --template thesis/bachelor

# è‡ªåŠ¨æ£€æµ‹æ¨¡æ¿
./scripts/validate.sh --project ../projects/NSFC_Young
```

### C. æ–°å¢æ¨¡æ¿ç¤ºä¾‹

```yaml
# templates/thesis/bachelor.yaml
template:
  name: "Thesis_Bachelor"
  display_name: "æœ¬ç§‘æ¯•ä¸šè®ºæ–‡"
  version: "1.0"

structure:
  content_dir: "chapters"
  config_file: "config.tex"
  main_file: "thesis.tex"

heading_structure:
  chapters:
    - id: "introduction"
      required: true
    - id: "literature_review"
      required: true
    - id: "methodology"
      required: true
    # ... æ›´å¤šç« èŠ‚

style_reference:
  fonts:
    chinese_main: "SimSun"
    english_main: "Times New Roman"

  page:
    margin_left: "2.54cm"
    margin_right: "2.54cm"
    # ... å…¶ä»–é…ç½®
```

---

**è®¡åˆ’åˆ¶å®š**: Claude Code
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
**é¢„è®¡å·¥æœŸ**: 7-12 å¤©
**ä¼˜å…ˆçº§**: P0 (é«˜ä¼˜å…ˆçº§)
