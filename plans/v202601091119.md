# nsfc-justification-writer 评估与改进计划

**日期**：2026-01-09
**当前版本**：v0.2.0
**评估对象**：`skills/nsfc-justification-writer`

---

## 一、现状评估

### 1.1 核心优点（Strengths）

| 类别 | 具体优点 | 价值 |
|------|----------|------|
| **硬编码确定性** | Tier1 诊断（结构/引用/字数/质量扫描） | 快速、稳定、无需 AI |
| **安全机制** | 白名单写入 + 备份 + 禁止改动关键文件 | 防止破坏模板结构 |
| **架构设计** | HybridCoordinator（混合协调器）分层清晰 | AI 与硬编码能力解耦 |
| **可观测性** | run_id + 日志记录 | 可复现、可审计 |
| **术语一致性** | 基于 `config.yaml` 的 `alias_groups` 检查 | 跨章节术语统一 |
| **测试覆盖** | 存在 pytest 测试 | 保证代码质量 |
| **文档规范** | SKILL.md / README.md / references/ 清晰 | 降低使用门槛 |

### 1.2 核心缺点与改进空间（Weaknesses & Opportunities）

#### A. 功能完整性

| 缺点 | 影响 | 改进方向 |
|------|------|----------|
| **信息表收集流程手工化** | 用户需手动填写 `info_form.md` | 交互式问答生成器 |
| **缺少「从零生成」模板** | 用户需自己建骨架 | 提供模板初始化脚本 |
| **缺少章节间一致性深度检查** | 与 `2.1 研究内容`、`3.1 研究基础` 可能冲突 | 跨章节引用/术语/指标联动检查 |
| **未与 `nsfc-bib-manager` 深度集成** | 引用核验需手工切换技能 | 自动调用 bib-manager 核验 DOI |
| **缺少评审建议生成** | 无「评审人视角」反馈 | 基于常见评审质疑点生成建议 |
| **无版本对比/回滚能力** | 备份存在但缺少版本管理 | 版本树 + diff 展示 |

#### B. 用户体验

| 缺点 | 影响 | 改进方向 |
|------|------|----------|
| **CLI 输出不够直观** | 终端文本不易快速定位问题 | 可视化 HTML 报告（带高亮） |
| **缺少「渐进式写作」引导** | 一步到位压力大 | 分步提示：先骨架→再段落→再润色 |
| **错误提示缺少可操作建议** | 只报错不说怎么修 | 每个诊断项附带修复建议 |
| **缺少示例驱动** | 有 `examples/` 但未在流程中引用 | 智能匹配相似领域示例 |

#### C. 技术债务

| 缺点 | 影响 | 改进方向 |
|------|------|----------|
| **Tier2 AI 提示词硬编码在 Python** | 修改提示词需改代码 | 外部化到 `prompts/` 目录 |
| **配置项 `ai.enabled` 与实际行为不完全一致** | 某些路径未走 AI 开关 | 统一 AI 调用入口 |
| **测试用例覆盖面偏窄** | 主要测试 parser，缺少端到端场景 | 增加 E2E 测试 + 真实案例回归 |
| **`hybrid_coordinator.py` 承担过多职责** | 单文件 170+ 行 | 拆分为子协调器（诊断/写入/字数） |

---

## 二、改进优先级矩阵

```
高价值 ┃ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
      ┃  ① 信息表交互式生成器         ⑤ 可视化诊断报告
      ┃  ② 跨章节一致性检查           ⑥ 与 nsfc-bib-manager 集成
      ┃  ③ 评审建议生成器             ⑦ 端到端测试
      ┃  ④ 版本对比/回滚能力
━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
低价值 ┃  ⑧ 提示词外部化               ⑩ 渐进式写作引导
      ┃  ⑨ hybrid_coordinator 拆分    ⑪ 示例驱动推荐
      ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
             低成本 ━━━━━━━━━━━━━━━━━ 高成本
```

### 第一优先级（高价值 + 中低成本）

1. **信息表交互式生成器**
   - 目标：用户无需手动填写 `info_form.md`
   - 实现方式：`scripts/run.py init --interactive` 问答式收集
   - 预期收益：降低新手使用门槛，减少信息遗漏

2. **跨章节一致性检查**
   - 目标：确保 `1.1`、`2.1`、`3.1` 术语/指标/引用一致
   - 实现方式：扩展 `term_consistency.py`，增加跨文件模式
   - 预期收益：避免评审质疑术语不统一

3. **评审建议生成器**
   - 目标：提供「评审人视角」的常见质疑与建议
   - 实现方式：基于 `dod_checklist.md` 生成针对性建议（Tier2 AI）
   - 预期收益：提高中标率，减少常见错误

### 第二优先级（高价值 + 中高成本）

4. **可视化诊断报告**
   - 目标：生成 HTML 报告，带语法高亮和可跳转行号
   - 实现方式：`scripts/run.py diagnose --html-report`
   - 预期收益：大幅提升问题定位效率

5. **与 `nsfc-bib-manager` 深度集成**
   - 目标：自动核验 DOI/引用，避免幻觉引用
   - 实现方式：在 `apply-section` 前自动调用 `nsfc-bib-manager`
   - 预期收益：引用可核验，避免评审质疑

6. **版本对比/回滚能力**
   - 目标：查看历史版本 diff，支持一键回滚
   - 实现方式：利用已有 `runs/` 备份，增加 `diff` 和 `rollback` 子命令
   - 预期收益：支持多轮迭代，不怕改错

### 第三优先级（长期优化）

7. **端到端测试**（增加真实案例回归）
8. **提示词外部化**（`prompts/` 目录 + YAML 配置）
9. **渐进式写作引导**（分步提示流程）
10. **示例驱动推荐**（智能匹配领域示例）

---

## 三、改进任务清单（按优先级排序）

### 第一优先级

| 任务 | 文件变更 | 验收标准 |
|------|----------|----------|
| 信息表交互式生成器 | `scripts/run.py` 新增 `init` 子命令 | 用户可按问答完成 info_form.md |
| 跨章节术语检查增强 | `core/term_consistency.py` 扩展 | 支持 1.1 / 2.1 / 3.1 联动检查 |
| 评审建议生成器 | `scripts/run.py` 新增 `review` 子命令 | 输出常见评审质疑与建议 |

### 第二优先级

| 任务 | 文件变更 | 验收标准 |
|------|----------|----------|
| 可视化 HTML 诊断报告 | `scripts/run.py --html-report` + `templates/html/` | 输出可交互 HTML 报告 |
| 版本对比/回滚 | `scripts/run.py diff / rollback` | 支持查看历史 diff 和回滚 |
| 与 nsfc-bib-manager 集成 | `core/reference_validator.py` 增强 | 自动调用 bib-manager 核验 |

### 第三优先级

| 任务 | 文件变更 | 验收标准 |
|------|----------|----------|
| 端到端测试 | `tests/e2e/` | 覆盖真实案例场景 |
| 提示词外部化 | `prompts/` 目录 + `config.yaml` | 修改提示词无需改代码 |
| 渐进式写作引导 | `core/writing_coach.py` | 分步引导用户完成写作 |
| 示例驱动推荐 | `core/example_matcher.py` | 智能匹配相似领域示例 |

---

## 四、风险与约束

| 风险 | 缓解措施 |
|------|----------|
| **AI 成本**（Tier2 过度调用） | 增加 `--tier2` 显式开关，默认不启用 |
| **破坏模板结构**（写入失败） | 白名单 + dry-run 模式 + 写入前预览 |
| **跨项目路径冲突** | 使用相对路径 + 项目根校验 |
| **Python 依赖膨胀** | 保持最小依赖，可选功能用 import guard |

---

## 五、成功指标

| 指标 | 当前 | 目标 |
|------|------|------|
| CLI 命令完成率 | 未知 | >90%（通过用户测试） |
| 诊断报告阅读时间 | 纯文本需 5+ 分钟 | HTML 报告 <2 分钟 |
| 信息表填写时间 | 手工 20-30 分钟 | 交互式 10-15 分钟 |
| 跨章节术语冲突率 | 未知 | 降低 50% |
| 引用幻觉率 | 未知 | 0%（强制核验） |

---

## 六、变更历史

记录在根级 `CHANGELOG.md`，本文件不维护版本历史。
