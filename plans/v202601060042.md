# make_latex_model Skill 优化方案

**方案编号**: v202601060042
**创建时间**: 2026-01-06
**目标**: 实现全自动的 LaTeX 模板参数对齐优化流程

---

## 一、当前问题分析

### 1.1 用户需求流程
用户希望实现以下全自动优化流程：

1. **预处理 main.tex** - 暂时注释掉 `\input{}` 类代码
2. **生成可靠基准** - 把模板 .doc/.docx 打印为 PDF
3. **参数提取** - 结合 PDF 和 main.tex 了解模板参数（字体、大小、颜色、加粗等）
4. **初次优化** - 根据参数优化 `@config.tex`，渲染出 main.pdf
5. **像素对比** - 像素级可靠方法比较 main.pdf 与模板 PDF
6. **迭代优化** - 根据差异调整参数，重新渲染，再次对比
7. **停止条件** - 模型无法分辨两个 PDF 的差异

### 1.2 目录组织问题

**问题 1：分析结果散落在项目根目录**
- 当前状态：`*_analysis.json` 等文件被放置在项目根目录（如 `/2026年最新word模板-青年科学基金项目（C类）-正文_analysis.json`）
- 问题：污染项目根目录，不利于版本控制和项目维护
- 需求：统一收纳到 skill 工作目录

**问题 2：artifacts 目录位置不当**
- 当前状态：`projects/NSFC_Young/artifacts/` 位于具体项目目录内
- 问题：artifacts 是 skill 工作产生的临时文件，不应污染用户项目目录
- 需求：移至 skill 专用的工作空间

### 1.3 目标目录结构

```
skills/make_latex_model/
├── SKILL.md
├── config.yaml
├── scripts/           # 脚本工具
├── workspace/         # ⚠️ 新增：skill 专用工作空间
│   ├── {project_name}/    # 按项目名称隔离
│   │   ├── baseline/      # PDF 基准文件
│   │   │   ├── word.pdf
│   │   │   └── word_analysis.json
│   │   ├── iterations/    # 迭代历史
│   │   │   ├── iteration_001/
│   │   │   │   ├── main.pdf
│   │   │   │   ├── config.tex
│   │   │   │   └── metrics.json
│   │   │   └── iteration_002/
│   │   ├── reports/       # 生成的报告
│   │   │   ├── diff_report.html
│   │   │   └── optimization_report.html
│   │   └── cache/         # 缓存文件
│   │       ├── pdf_renders/
│   │       └── analysis_cache.json
│   └── NSFC_General/
│       └── ...
├── templates/          # 模板配置
├── core/              # 核心模块
└── validators/        # 验证器
```

### 1.4 当前 Skill 的能力

| 功能模块 | 当前状态 | 工具 |
|---------|---------|------|
| 项目状态检查 | ✅ 已实现 | `check_state.py` |
| PDF 样式分析 | ✅ 已实现 | `analyze_pdf.py` |
| 标题文字对比 | ✅ 已实现 | `compare_headings.py` |
| 样式参数验证 | ✅ 已实现 | `run_validators.py` |
| 像素对比 | ✅ 已实现 | `compare_pdf_pixels.py` |
| 一键优化 | ⚠️ 部分实现 | `optimize.py`（流程不完整） |
| **预处理 main.tex** | ❌ 未实现 | 无 |
| **可靠 Word PDF 生成** | ❌ 未实现 | 无 |
| **迭代优化闭环** | ❌ 未实现 | 无 |
| **智能停止判断** | ❌ 未实现 | 无 |

---

## 二、优化方案架构

### 2.1 新增 `workspace_manager.py` - 工作空间管理

**功能**：
- 统一管理 skill 工作目录 `skills/make_latex_model/workspace/`
- 按项目名称隔离工作空间（`workspace/{project_name}/`）
- 自动创建必要的子目录（baseline、iterations、reports、cache）
- 清理过期的缓存和临时文件
- 提供工作空间路径查询接口

**输入**：
- 项目名称（如 `NSFC_Young`）

**输出**：
- 返回工作空间路径对象
- 自动创建目录结构

**API 设计**：
```python
class WorkspaceManager:
    def __init__(self, skill_root: Path):
        self.skill_root = skill_root
        self.workspace_root = skill_root / "workspace"

    def get_project_workspace(self, project_name: str) -> Path:
        """获取项目工作空间路径"""
        ws = self.workspace_root / project_name
        ws.mkdir(parents=True, exist_ok=True)
        # 创建子目录
        (ws / "baseline").mkdir(exist_ok=True)
        (ws / "iterations").mkdir(exist_ok=True)
        (ws / "reports").mkdir(exist_ok=True)
        (ws / "cache").mkdir(exist_ok=True)
        return ws

    def get_baseline_path(self, project_name: str) -> Path:
        """获取基准文件路径"""
        return self.get_project_workspace(project_name) / "baseline"

    def get_iteration_path(self, project_name: str, iteration_num: int) -> Path:
        """获取迭代目录路径"""
        iterations_dir = self.get_project_workspace(project_name) / "iterations"
        iter_dir = iterations_dir / f"iteration_{iteration_num:03d}"
        iter_dir.mkdir(parents=True, exist_ok=True)
        return iter_dir

    def cleanup_cache(self, project_name: str, max_age_hours: int = 24):
        """清理过期缓存"""
        # 删除超过 max_age_hours 小时的缓存文件
        pass
```

### 2.2 核心改进点

#### 1. 新增 `prepare_main.py` - 预处理 main.tex
**功能**：
- 自动注释掉 `main.tex` 中的 `\input{}` 行
- 保留 `\section{}`、`\subsection{}` 等标题结构
- 生成备份文件 `main.tex.bak`
- 支持一键恢复（取消注释）

**输入**：
- `projects/NSFC_Young/main.tex`

**输出**：
- `projects/NSFC_Young/main.tex`（修改版）
- `projects/NSFC_Young/main.tex.bak`（备份）
- **备份也保存到工作空间**：`workspace/NSFC_Young/backup/main.tex.bak`

#### 2. 新增 `generate_baseline.py` - 可靠 PDF 生成
**功能**：
- 自动检测模板目录中的 .doc/.docx 文件
- 使用 LibreOffice 命令行转换为 PDF（跨平台）
- 如果检测到 Microsoft Word，优先使用 Word（更精确）
- 验证生成的 PDF 质量（检查尺寸、字体嵌入）
- 支持 macOS QuickLook 预览（标记为低质量基准）

**输入**：
- `projects/NSFC_Young/template/2026年最新word模板-*.doc*`

**输出**：
- **移至工作空间**：`workspace/NSFC_Young/baseline/word.pdf`
- **分析结果保存到工作空间**：`workspace/NSFC_Young/baseline/word_analysis.json`
- 质量报告：`workspace/NSFC_Young/baseline/quality_report.json`

#### 3. 修改现有脚本 - 路径迁移

需要修改以下脚本，使其使用 `workspace_manager` 获取路径：

| 脚本 | 当前路径 | 新路径 |
|------|---------|--------|
| `analyze_pdf.py` | 输出到当前目录 | `workspace/{project}/baseline/` |
| `compare_headings.py` | 输出到项目目录 | `workspace/{project}/reports/` |
| `compare_pdf_pixels.py` | 输出到当前目录 | `workspace/{project}/reports/` |
| `check_state.py` | 检查 `projects/{project}/artifacts/` | 检查 `workspace/{project}/baseline/` |
| `run_validators.py` | 输出到项目目录 | `workspace/{project}/reports/` |

#### 4. 增强 `optimize.py` - 迭代优化闭环
**新增功能**：
- **迭代循环**：执行 `optimize → compile → compare → 分析差异 → 调整参数` 循环
- **智能参数调整**：根据像素差异自动推断需要调整的参数
  - 换行位置差异 → 调整字间距或字号 ±0.1pt
  - 垂直位置偏移 → 调整行距或段间距
  - 颜色差异 → 调整 RGB 值
- **收敛检测**：当 `changed_ratio < 0.05` 或迭代达到 10 次时停止
- **回滚机制**：如果某次迭代导致指标恶化，自动回滚到上一版本

**迭代流程**（使用工作空间）：
```python
from workspace_manager import WorkspaceManager

ws_manager = WorkspaceManager(skill_root)
project_ws = ws_manager.get_project_workspace("NSFC_Young")

iteration = 0
best_ratio = float('inf')
best_config = None

while iteration < max_iterations:
    # 1. 编译 LaTeX
    compile_latex("projects/NSFC_Young/main.tex")
    output_pdf = "projects/NSFC_Young/main.pdf"

    # 2. 像素对比（基准和报告都保存到工作空间）
    baseline_pdf = project_ws / "baseline" / "word.pdf"
    ratio = compare_pdfs(baseline_pdf, output_pdf)

    # 3. 保存本轮迭代结果到工作空间
    iter_dir = ws_manager.get_iteration_path("NSFC_Young", iteration)
    shutil.copy(output_pdf, iter_dir / "main.pdf")
    shutil.copy("projects/NSFC_Young/extraTex/@config.tex",
                iter_dir / "config.tex")
    (iter_dir / "metrics.json").write_text(json.dumps({
        "iteration": iteration,
        "changed_ratio": ratio,
        "timestamp": datetime.now().isoformat()
    }))

    # 4. 判断是否收敛
    if ratio < tolerance:
        break

    # 5. 保存最佳配置
    if ratio < best_ratio:
        best_ratio = ratio
        best_config = current_config.copy()
    else:
        # 回滚到最佳配置
        current_config = best_config.copy()

    # 6. 分析差异并调整参数
    diffs = analyze_pixel_differences(baseline_pdf, output_pdf)
    adjustments = generate_adjustments(diffs)
    apply_adjustments(adjustments)

    iteration += 1

# 7. 生成最终报告到工作空间
report_path = project_ws / "reports" / "optimization_report.html"
generate_report(iteration_history, report_path)
```

#### 5. 新增 `intelligent_adjust.py` - 智能参数调整
**功能**：
- 解析像素对比的差异热图
- 识别差异区域（标题区域、正文区域、页边距）
- 根据差异特征推断需要调整的参数
- 生成具体的 LaTeX 代码修改建议

**差异特征与参数映射**：
| 差异特征 | 推断参数 | 调整策略 |
|---------|---------|---------|
| 换行位置大面积差异 | 字间距/字号 | ±0.1pt 字号，或调整 `\XeTeXinterchartokenstate` |
| 文本垂直偏移 | 行距 | 调整 `\linespread` 或 `\baselinestretch` ±0.05 |
| 颜色不一致 | RGB 值 | 调整 `\definecolor` 的 RGB 参数 |
| 左右边距差异 | geometry | 调整 `\geometry` 的 hmargin ±0.1cm |
| 标题位置偏移 | titleformat | 调整 `\titlespacing` 的参数 |

#### 6. 新增 `convergence_detector.py` - 收敛检测
**功能**：
- 综合判断是否达到停止条件
- 输出详细的收敛报告
- 记录每轮迭代的指标变化

**停止条件（优先级从高到低）**：
1. **编译失败** → 立即停止，报错
2. **像素对比 changed_ratio < 0.03** → 达到像素级对齐
3. **连续 3 轮迭代指标无改善** → 收敛
4. **迭代达到 10 轮** → 强制停止

---

### 2.2 工作流程设计

```
┌─────────────────────────────────────────────────────────────┐
│              用户调用：优化 NSFC_Young 模板                   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  步骤 0：预检查 (check_state.py)                             │
│  - 检查项目初始化状态                                         │
│  - 检查是否有 Word PDF 基准                                  │
│  - 检查编译状态                                               │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  步骤 1：预处理 main.tex (prepare_main.py)                   │
│  - 自动注释 \input{} 行                                      │
│  - 生成备份文件                                              │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  步骤 2：生成可靠 PDF 基准 (generate_baseline.py)            │
│  - 检测 .doc/.docx 文件                                      │
│  - 使用 LibreOffice/Word 转换为 PDF                          │
│  - 验证 PDF 质量                                             │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  步骤 3：分析基准 PDF (analyze_pdf.py)                       │
│  - 提取样式参数（字体、颜色、间距、边距）                      │
│  - 生成 JSON 分析报告                                        │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  步骤 4：首次参数对齐 (AI 决策 + Edit 工具)                   │
│  - 对比 PDF 分析结果与 @config.tex                           │
│  - 生成修改方案                                              │
│  - 应用修改到 @config.tex                                    │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  步骤 5：迭代优化循环 (enhanced_optimize.py)                 │
│  ┌─────────────────────────────────────────────────────────┐│
│  │  WHILE NOT converged:                                   ││
│  │    1. 编译 LaTeX (xelatex -> bibtex -> xelatex -> xelatex)││
│  │    2. 像素对比 (compare_pdf_pixels.py)                  ││
│  │    3. 检测收敛 (convergence_detector.py)                ││
│  │    4. IF NOT converged:                                ││
│  │         - 分析差异 (intelligent_adjust.py)              ││
│  │         - 生成调整方案                                   ││
│  │         - 应用调整到 @config.tex                         ││
│  │    5. 保存最佳配置                                      ││
│  │  END WHILE                                              ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  步骤 6：恢复 main.tex (prepare_main.py --restore)           │
│  - 取消注释 \input{} 行                                      │
│  - 最终编译验证                                              │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│  步骤 7：生成报告 (generate_report.py)                       │
│  - 迭代历史记录                                              │
│  - 最终参数对比                                              │
│  - 像素对比结果                                              │
│  - 修改摘要（追加到 @CHANGELOG.md）                           │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│              完成：main.pdf 与 word.pdf 像素级对齐            │
└─────────────────────────────────────────────────────────────┘
```

---

## 三、新增/修改脚本清单

### 3.1 新增脚本

| 脚本名称 | 功能 | 依赖 |
|---------|------|------|
| `workspace_manager.py` | 工作空间路径管理 | pathlib, shutil |
| `prepare_main.py` | 预处理/恢复 main.tex | pathlib, re |
| `generate_baseline.py` | 生成可靠 PDF 基准 | subprocess, platform |
| `intelligent_adjust.py` | 智能参数调整推理 | numpy, PIL, PyMuPDF |
| `convergence_detector.py` | 收敛检测 | json, pathlib |
| `enhanced_optimize.py` | 增强版迭代优化 | 上述所有脚本 |

### 3.2 修改脚本（路径迁移）

| 脚本名称 | 修改内容 | 优先级 |
|---------|---------|--------|
| `analyze_pdf.py` | 输出改为 `workspace/{project}/baseline/` | 高 |
| `compare_headings.py` | 输出改为 `workspace/{project}/reports/` | 高 |
| `compare_pdf_pixels.py` | 输出改为 `workspace/{project}/reports/` | 高 |
| `check_state.py` | 检查路径改为 `workspace/{project}/` | 高 |
| `run_validators.py` | 输出改为 `workspace/{project}/reports/` | 中 |
| `optimize.py` | 集成新脚本，实现完整迭代闭环 | 高 |

### 3.3 配置文件更新

| 文件 | 修改内容 |
|------|---------|
| `SKILL.md` | 更新执行流程，新增工作空间说明和迭代优化章节 |
| `config.yaml` | 新增迭代配置参数和工作空间配置 |

---

## 四、配置参数扩展

在 `config.yaml` 中新增：

```yaml
# ================================
# 工作空间配置（⚠️ 新增）
# ================================
workspace:
  root: "workspace"               # 工作空间根目录（相对于 skill 根目录）
  auto_cleanup: true              # 自动清理过期缓存
  cache_max_age_hours: 24         # 缓存最大保留时间（小时）
  keep_iterations: true           # 是否保留所有迭代历史
  max_iterations_kept: 10         # 最多保留的迭代历史数量

# ================================
# 迭代优化配置
# ================================
iteration:
  max_iterations: 10              # 最大迭代次数
  convergence_threshold: 0.03     # 收敛阈值（像素差异比例）
  no_improvement_limit: 3         # 连续无改善轮数阈值

  # 参数调整粒度
  adjustment_granularity:
    font_size_pt: 0.1             # 字号调整粒度（pt）
    line_spacing: 0.05            # 行距调整粒度（倍数）
    margin_cm: 0.05               # 边距调整粒度（cm）
    color_rgb: 1                  # 颜色调整粒度（RGB 0-255）

  # 回滚策略
  rollback_on_worsening: true     # 指标恶化时是否回滚
  save_best_config: true          # 是否保存最佳配置

  # 像素对比配置
  pixel_comparison:
    dpi: 150                      # 渲染分辨率
    tolerance: 2                  # 像素容差（RGB）
    focus_areas:                  # 重点对比区域
      - title_area                # 标题区域
      - body_area                 # 正文区域
      - page_margins              # 页边距
```

---

## 五、SKILL.md 文档更新要点

### 5.0 新增章节：工作空间说明（第 0.7 节）

```markdown
## 0.7) 工作空间说明（⚠️ 新增）

本 skill 使用专用工作空间存储所有工作产物，避免污染用户项目目录。

### 工作空间结构

```
skills/make_latex_model/workspace/{project_name}/
├── baseline/          # Word PDF 基准文件
│   ├── word.pdf
│   ├── word_analysis.json
│   └── quality_report.json
├── iterations/        # 迭代历史记录
│   ├── iteration_001/
│   │   ├── main.pdf
│   │   ├── config.tex
│   │   └── metrics.json
│   └── iteration_002/
├── reports/           # 生成的报告
│   ├── diff_report.html
│   └── optimization_report.html
└── cache/             # 缓存文件
    ├── pdf_renders/
    └── analysis_cache.json
```

### 路径管理

所有脚本统一使用 `WorkspaceManager` 获取路径：

```python
from workspace_manager import WorkspaceManager

ws_manager = WorkspaceManager(skill_root)
baseline_dir = ws_manager.get_baseline_path("NSFC_Young")
report_path = ws_manager.get_project_workspace("NSFC_Young") / "reports"
```

### 清理策略

- 缓存文件默认保留 24 小时
- 迭代历史默认保留最近 10 轮
- 可通过 `config.yaml` 配置清理策略
```

### 5.1 新增章节：迭代优化闭环（第 3.5 节）

```markdown
### 步骤 3.5：迭代优化闭环（⚠️ 新增）

本步骤实现全自动的"优化-对比-调整"循环：

#### 3.5.1 循环逻辑
```
WHILE 未达到收敛条件:
  1. 编译 LaTeX 项目（xelatex -> bibtex -> xelatex -> xelatex）
  2. 执行像素级 PDF 对比（compare_pdf_pixels.py）
  3. 检测是否收敛（convergence_detector.py）
  4. IF 未收敛:
       - 分析差异特征（intelligent_adjust.py）
       - 生成参数调整方案
       - 应用调整到 @config.tex
  5. 记录本轮指标
  6. 保存或回滚配置
END WHILE
```

#### 3.5.2 收敛条件（优先级从高到低）
1. **编译失败** → 立即停止
2. **changed_ratio < 0.03** → 达到像素级对齐
3. **连续 3 轮无改善** → 收敛
4. **迭代达到 10 轮** → 强制停止

#### 3.5.3 智能参数调整策略

脚本 `intelligent_adjust.py` 根据差异特征自动推断参数调整：

| 差异特征 | 推断参数 | 调整策略 |
|---------|---------|---------|
| 换行位置大面积差异 | 字间距/字号 | ±0.1pt |
| 文本垂直偏移 | 行距 | ±0.05 倍 |
| 颜色不一致 | RGB 值 | ±1 |
| 左右边距差异 | geometry | ±0.05cm |
| 标题位置偏移 | titleformat | 调整 spacing |
```

### 5.2 更新章节：执行流程

在原有的"步骤 6：验证与迭代"后，新增：

```markdown
### 步骤 6.5：全自动迭代优化（⚠️ 推荐）

使用增强版一键优化脚本：

```bash
python3 skills/make_latex_model/scripts/enhanced_optimize.py \
  --project NSFC_Young \
  --max-iterations 10 \
  --report optimization_report.html
```

脚本会自动完成：
1. 预处理 main.tex（注释 input）
2. 生成可靠 Word PDF 基准
3. 分析 PDF 样式参数
4. 首次参数对齐
5. 迭代优化循环（最多 10 轮）
6. 恢复 main.tex
7. 生成详细报告

预计耗时：5-15 分钟（取决于迭代轮数）
```

---

## 六、实施优先级

### Phase 0：工作空间重构（最高优先级）⚠️
1. ✅ 实现 `workspace_manager.py` 核心模块
2. ✅ 创建工作空间目录结构
3. ✅ 迁移现有脚本使用新路径系统
   - `analyze_pdf.py` → 输出到 `workspace/{project}/baseline/`
   - `compare_headings.py` → 输出到 `workspace/{project}/reports/`
   - `compare_pdf_pixels.py` → 输出到 `workspace/{project}/reports/`
   - `check_state.py` → 检查 `workspace/{project}/baseline/`
4. ✅ 更新 `config.yaml` 添加工作空间配置
5. ✅ 更新 `SKILL.md` 添加工作空间说明

### Phase 1：基础功能（高优先级）
1. ✅ 实现 `prepare_main.py`
2. ✅ 实现 `generate_baseline.py`
3. ✅ 实现 `convergence_detector.py`
4. ✅ 增强现有 `optimize.py` 集成新脚本

### Phase 2：智能调整（中优先级）
1. ✅ 实现 `intelligent_adjust.py` 基础版本
2. ✅ 完善差异特征与参数的映射关系
3. ✅ 添加更多调整策略（字间距、断行等）

### Phase 3：高级功能（低优先级）
1. ⚠️ 实现机器学习模型预测参数调整
2. ⚠️ 支持多模板并行优化
3. ⚠️ Web UI 可视化迭代过程

---

## 七、风险与应对

### 风险 1：无限循环
**描述**：迭代无法收敛，陷入死循环
**应对**：
- 设置最大迭代次数（10 轮）
- 强制回滚到最佳配置
- 编译失败立即停止

### 风险 2：参数调整过度
**描述**：调整幅度过大，导致编译失败或样式崩坏
**应对**：
- 使用保守的调整粒度（字号 ±0.1pt）
- 每轮只调整 1-2 个参数
- 保留每轮配置备份

### 风险 3：Word PDF 生成失败
**描述**：LibreOffice 或 Word 不可用
**应对**：
- 降级使用 QuickLook（标记低质量）
- 提示用户手动生成 PDF
- 降低像素对比权重

### 风险 4：目录迁移兼容性（⚠️ 新增）
**描述**：路径变更导致现有流程中断或用户脚本失效
**应对**：
- 保持向后兼容：检查旧路径是否存在，自动迁移到新路径
- 添加迁移脚本：`migrate_to_workspace.py` 自动移动旧文件
- 提供文档说明：在 CHANGELOG 中记录路径变更
- 设置过渡期：同时支持新旧路径，逐步弃用旧路径

---

## 八、验收标准

### 功能验收
- [ ] `workspace_manager.py` 能正确创建和管理工作空间
- [ ] 所有脚本正确使用新的路径系统
- [ ] 旧文件能自动迁移到新工作空间
- [ ] `prepare_main.py` 能正确注释/恢复 `\input{}` 行
- [ ] `generate_baseline.py` 能成功生成 PDF 并验证质量
- [ ] `enhanced_optimize.py` 能完整执行迭代流程
- [ ] `convergence_detector.py` 能正确检测收敛条件
- [ ] `intelligent_adjust.py` 能生成合理的调整建议

### 质量验收
- [ ] 迭代后 `changed_ratio < 0.05`
- [ ] 编译无错误和警告
- [ ] 生成的 PDF 与 Word PDF 视觉一致
- [ ] 迭代历史记录完整
- [ ] @CHANGELOG.md 记录清晰
- [ ] **工作空间目录整洁**：无文件散落在项目根目录
- [ ] **路径配置化**：所有路径通过配置文件管理

---

## 九、后续优化方向

1. **性能优化**：缓存 PDF 渲染结果，减少重复编译
2. **参数优化**：通过机器学习学习最优调整策略
3. **可视化**：实时显示迭代进度和差异热图
4. **跨模板**：支持同时优化多个 NSFC 模板
5. **云服务**：部署为在线服务，无需本地环境

---

**方案状态**: 待审查
**预计工作量**: 3-5 个工作日
**负责团队**: ChineseResearchLaTeX Project
