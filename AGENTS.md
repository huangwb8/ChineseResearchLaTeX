# 中国科研常用 LaTeX 模板集 - 项目指令

本项目为「中国科研常用LaTeX模板集」，整理中国科研常用的LaTeX模板，包括国自然科学基金的正文模板（Mac/Win/Overleaf）、毕业论文等。一般建议使用最新的 [Release](https://github.com/huangwb8/ChineseResearchLaTeX/releases)。

---

## 项目目标

整理中国科研常用的 LaTeX 模板（国自然科学基金正文模板、毕业论文等），维护可直接使用的项目结构与说明文档；一般建议优先使用最新的 [Release](https://github.com/huangwb8/ChineseResearchLaTeX/releases)。

## 目录结构

```
ChineseResearchLaTeX/
├── projects/              # LaTeX 项目模板
│   ├── NSFC_General/      # 面上项目模板
│   ├── NSFC_Local/        # 地区项目模板
│   └── NSFC_Young/        # 青年基金模板
├── references/            # 项目辅助文档
│   ├── README.md
│   └── latex-writing-guide.md
├── skills/                # 项目专用技能
│   └── [各个 skill 目录...]
├── plans/                 # 计划文档（可选）
├── tests/                 # 测试/验证记录（可选）
├── config.yaml            # 项目配置文件
├── CLAUDE.md              # Claude Code 项目指令
├── AGENTS.md              # OpenAI Codex 项目指令
├── CHANGELOG.md           # 变更日志
├── README.md              # 项目说明
└── license.txt            # 许可证
```

---

## 核心工作流

当用户提出 LaTeX 模板相关需求时，按以下流程执行：

### 任务理解

- 理解用户的真实需求和意图（模板使用、编译问题、格式调整等）
- 确认任务范围和预期输出（PDF 文档、代码修改、文档说明等）
- 识别可能的依赖和约束（宏包版本、编译引擎、文件路径等）

### 执行流程

模板选择 → 内容编辑 → 编译验证 → 格式检查 → 输出交付

### 输出规范

- LaTeX 代码应遵循项目模板规范
- 文档更新应保持格式一致性
- 编译结果应无错误和警告

---

## 工程原则

本项目遵循以下工程原则：

| 原则 | 核心思想 | 在本项目中的体现 |
|------|----------|------------------|
| **KISS** | Keep It Simple, Stupid | 追求极致简洁，避免过度设计；文档标题不使用序号前缀 |
| **YAGNI** | You Aren't Gonna Need It | 只实现当前需要的功能 |
| **DRY** | Don't Repeat Yourself | 相似逻辑应抽象复用 |
| **SOLID** | 面向对象设计五大原则 | 单一职责、开闭原则等 |
| **关注点分离** | Separation of Concerns | 不同层次逻辑应分离 |
| **奥卡姆剃刀** | 如无必要，勿增实体 | 优先选择最简单的解决方案 |
| **最小惊讶原则** | Principle of Least Astonishment | API 行为应符合用户直觉 |
| **早期返回原则** | Early Return | 尽早返回，减少嵌套 |

**原则冲突时的决策优先级**：
1. **正确性 > 一切**
2. **简洁性 > 灵活性**
3. **清晰性 > 性能**
4. **扩展性 > 紧凑性**

---

## Skill 开发规范

本项目在 `skills/` 目录中维护多个 Agent Skill。所有新增或修改的 Skill 必须遵守以下规范，确保与上游 [huangwb8/skills](https://github.com/huangwb8/skills) 项目的标准保持一致。

### 目录结构

每个 Skill 应包含以下标准文件：

```
skills/your-skill/
├── SKILL.md              # 必需：技能功能文档（AI 执行规范）
├── README.md             # 推荐：用户友好的使用指南
├── config.yaml           # 推荐：参数和版本管理
├── CHANGELOG.md          # 可选：技能变更记录
├── scripts/              # 可选：可执行脚本
├── tests/                # 可选：测试用例和结果
├── references/           # 可选：参考文档
├── plans/                # 可选：计划文档
└── assets/               # 可选：资源文件
```

### SKILL.md 规范

**核心原则**：SKILL.md 应聚焦于 **AI 执行逻辑**，而非版本历史或宣传信息。

| 要求 | 说明 | 示例 |
|------|------|------|
| **长度控制** | ≤500 行，避免冗余内容 | - |
| **描述精简** | config.yaml 的 description 字段 ≤ 1024 字符 | `支持 DOI 和 arxiv ID` |
| **移除版本标记** | 不使用 `⚠️ v2.3.0 新增` 类标记 | ❌ `⚠️ v2.3.0 新增：支持XXX`<br>✅ `支持XXX功能` |
| **简洁标题** | 标题不使用序号前缀 | ❌ `## 1) 功能概述`<br>✅ `## 功能概述` |
| **单线描述** | description 字段使用单行格式，融入负向约束 | `生成 NSFC 摘要（不适用：非标书场景）` |

**理由**：对 AI 而言，重要的是"功能是什么"，而非"何时加入的"。版本标记增加认知负荷，降低信号噪声比。

### README.md 规范

README.md 是**面向用户的使用指南**，说明如何触发和使用技能。

**应包含内容**：
- 技能用途和适用场景
- 快速开始指南
- 参数说明（如有）
- 使用示例
- 常见问题和限制

**注意**：README.md 应由 `write-skill-readme` skill 生成和维护。

### config.yaml 规范

配置文件统一管理技能的元信息和版本号，遵循单一真相来源（Single Source of Truth）原则。

**必需节点结构**：

```yaml
skill_info:
  name: skill-name              # 技能名称（kebab-case）
  version: x.y.z                # 版本号（遵循 Semver）
  description: "功能描述（≤1024字符，单行格式）"
  category: writing|development|normal  # 技能分类
```

**版本号规则**（遵循语义化版本）：

| 类型 | 格式 | 示例 | 说明 |
|------|------|------|------|
| **稳定版** | v1.0.0+ | v1.0.0 | 功能完整，经过充分测试（✅ 稳定） |
| **开发中** | v0.x.x | v0.7.3 | 核心功能可用，持续优化（🚧 开发中） |
| **实验性** | v0.0.x | v0.0.1 | 功能验证阶段（⚠️ 实验性） |

**版本号递增规则**：
- **主版本号（Major）**：不兼容的 API 变更
- **次版本号（Minor）**：向下兼容的功能性新增
- **修订号（Patch）**：向下兼容的问题修正

### 六大质量原则

每个 Skill 的实现必须遵守以下质量原则：

#### 1. 硬编码与 AI 功能划分

- **硬编码的确定性操作**：脚本化处理
  - 路径处理、文件验证、格式转换等
- **灵活判断**：交由 AI 处理
  - 语义理解、多轮对话、启发式决策等

#### 2. 多轮自检与人类监督

- Skill 应支持多轮对话和渐进式优化
- 关键决策应请求用户确认

#### 3. 冗余残留检查

- 删除功能时，全局清理所有引用和依赖
- 避免"孤立"的代码、配置、文档遗留物

#### 4. 安全性审视

- **输入验证**：验证用户输入的合法性
- **路径处理**：使用正确的路径规范，避免路径穿越攻击
- **敏感信息防护**：不在日志中泄露密钥、密码等

#### 5. 过度设计检查

遵守 YAGNI 原则：
- 不添加用户未要求的"预留功能"
- 优先选择最简单的解决方案

#### 6. 通用性验证

- 避免时间敏感的硬编码
- 避免场景限制
- 确保跨平台兼容性

### 版本管理

**核心原则**：`config.yaml` 为版本号的唯一真相来源。

**版本号同步顺序**：
1. 更新 `config.yaml` 中的 `skill_info.version`
2. 同步更新 README.md（如有版本表格）
3. 同步更新 CHANGELOG.md（记录变更内容）
4. 其他文档中的版本号必须与 config.yaml 保持一致

### 文档更新与发布

每次修改 Skill 时：

1. **更新 CHANGELOG.md**（Skill 级别）
   - 记录该 Skill 的版本历史
   - 遵循 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.1.0/) 格式

2. **更新 SKILL.md**（如有功能变更）
   - 移除版本标记，只保留最新功能说明
   - 保持文档简洁（≤500 行）

3. **重新生成 README.md**（使用 write-skill-readme skill）
   - 确保用户文档与实现同步

4. **同步到项目级 CHANGELOG.md**
   - 在项目根目录的 CHANGELOG.md 中记录该 Skill 的更新

---

## 通用规范

### 默认语言

除非用户明确要求其他语言，始终使用 **简体中文** 与用户对话与撰写文档/说明。

### 联网与搜索

默认优先使用项目内文件与本地上下文；确需联网获取信息时，优先使用本地搜索工具。仅当本地工具不足以满足需求时再使用其它联网手段，并说明原因与保留关键链接。

### 文件引用规范

在项目指令文档中引用文件时：
- 使用 Markdown 链接语法（如 `[filename.md](path/filename.md)`）
- 包含相关的起始行号（如 `path/filename.md#L42`）
- 使每个引用有独立路径，即使是同一文件

### 变更边界

- 仅修改与当前任务直接相关的文件
- 不主动添加用户未要求的功能
- 保持现有代码风格和结构
- 不自动清理/删除 `.DS_Store`（通常由 Git 全局忽略管理）
- `CLAUDE.md` 与 `AGENTS.md` 的核心章节需保持一致
- `skills/` 目录内文件有变化时，检查 `README.md` 是否需要同步更新

---

## LaTeX 技术规范

### 编译规范

**PDF 渲染4步法**：为保证参考文献和交叉引用的正确性，始终按以下顺序编译：

```
xelatex → bibtex → xelatex → xelatex
```

| 步骤 | 作用 |
|------|------|
| `xelatex` (第1次) | 生成辅助文件（.aux 等） |
| `bibtex` | 处理参考文献 |
| `xelatex` (第2次) | 解析文献引用 |
| `xelatex` (第3次) | 确保所有交叉引用正确 |

**使用原则**：
- 每次修改参考文献后必须重新执行完整4步
- 仅修改正文时可省略 bibtex 步骤
- 使用 `-interaction=nonstopmode` 参数避免编译中断

### 标题换行控制

对于需要精确控制换行长度的标题（如 NSFC 申请书的括号提示语）：

**推荐方案：使用 `\linebreak{}`**

```latex
% 示例：控制长标题的换行位置
\subsection{2. 工作条件（包括已具备的实验条件，尚缺少的实验条件和拟\linebreak{}解决的途径...）}
```

| 方法 | 优势 | 适用场景 |
|------|------|----------|
| `\linebreak{}` | 建议换行，保留 LaTeX 微调空间 | **推荐**：标题断行控制 |
| `\\` | 强制换行，不允许调整 | 仅用于必须强制换行的场景 |

---

## 文档与版本管理

### 变更记录规范

**核心原则**：项目中的任何更新都必须在根级 [CHANGELOG.md](CHANGELOG.md) 中记录，避免在分散的文档中维护重复的版本历史。

### 记录范围

每次修改以下内容时，必须更新 CHANGELOG.md：
- **项目指令文件**：CLAUDE.md、AGENTS.md 的任何修改
- **项目结构变更**：新增/删除/重命名目录或关键文件
- **工作流变更**：核心工作流程的调整
- **工程原则变更**：新增、修改或删除工程原则
- **重要配置变更**：影响项目行为的配置文件修改
- **Skill 变更**：任何 Skill 的版本更新

### 记录格式

遵循 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.1.0/) 格式：

```markdown
## [版本号] - YYYY-MM-DD

### Added（新增）
- 新增了 XXX 功能/章节：用途是 YYY

### Changed（变更）
- 修改了 XXX 章节：原因是 YYY，具体变更内容是 ZZZ

### Fixed（修复）
- 修复了 XXX 问题：表现是 YYY，修复方式是 ZZZ
```

### 记录时机

- **修改前**：先在 CHANGELOG.md 的 `[Unreleased]` 部分草拟变更内容
- **修改后**：完善变更描述，添加具体细节和影响范围
- **发布时**：将 `[Unreleased]` 内容移至具体版本号下

### Skill 文档编写原则

**核心理念**：Skill 文档应始终展示最新状态，不包含版本标记等对 AI 执行无用的元信息。

| 原则 | 说明 | 示例 |
|------|------|------|
| **内容优先于版本** | 移除版本标记 | ❌ `⚠️ v2.3.0 新增：支持XXX`<br>✅ `支持XXX功能` |
| **简洁标题** | 标题不使用序号前缀 | ❌ `## 1) 功能概述`<br>✅ `## 功能概述` |
| **单一职责** | SKILL.md 专注功能规范，CHANGELOG.md 专注版本追踪 | 各司其职，避免重复 |
| **技术必要引用例外** | 保留技术性版本引用 | `v2.3.0 前的旧路径` |

**设计公式**：
```
有效信息 = 总内容 - (版本标记 + 冗余序号 + 宣传性强调)
```

---

## 文档更新原则

当需要更新本文档时，遵循以下原则：

### 1. 理解意图

首先理解用户需求背后的意图和在工作流中的本质作用。

### 2. 定位生态位

每条规则/要求都应找到其在整个文档结构中的"生态位"——它与其他内容的关系、它服务的目标、它影响的其他部分。

### 3. 协调生长

更新一个部分时，检查并同步更新相关部分：
- 更新工作流步骤时，同步更新示例和验证清单
- 更新输出规范时，同步更新引用该规范的其他章节
- 更新术语定义时，全局统一替换
- **更新本文档时，必须同步更新 CHANGELOG.md**
- **更新本文档后，确保 CLAUDE.md 的核心内容保持一致**

### 4. 保持呼吸感

文档应该像生物体一样有"呼吸感"——章节之间有逻辑流动，而非割裂的清单。

### 5. 定期修剪整合

当某个章节变得过于臃肿时，主动重构。

---

**提示**：修改本文档后，请立即在 `CHANGELOG.md` 中记录变更，并确保 `CLAUDE.md` 的核心内容保持一致。这是项目管理的强制性要求，不是可选项。
