# ================================
# nsfc-justification-writer 默认配置
# ================================

skill_info:
  name: nsfc-justification-writer
  version: 0.6.1
  template_year: "2026"
  category: writing

parameters:
  project_root:
    type: string
    required: true
    description: 项目根目录（如 projects/NSFC_Young 或你的标书项目路径）
  output_mode:
    type: string
    required: false
    default: apply
    allowed_values: [preview, apply]
    description: preview 仅输出建议文本；apply 则写入目标 .tex 文件（如由平台/工具支持）
  word_count_target:
    type: integer
    required: false
    default: 4000
    description: 目标字数（中文字符数，不含 LaTeX 命令/注释）
  word_count_tolerance:
    type: integer
    required: false
    default: 200
    description: 允许偏差范围（±200 字）

targets:
  justification_tex: extraTex/1.1.立项依据.tex
  related_tex:
    research_content: extraTex/2.1.研究内容.tex
    research_foundation: extraTex/3.1.研究基础.tex
  bib_globs:
    - references/*.bib
    - references/**/*.bib

workspace:
  runs_dir: runs

ai:
  enabled: true
  tier2_chunk_size: 12000
  tier2_max_chunks: 20
  cache_dir: .cache/ai

prompts:
  intent_parse: prompts/intent_parse.txt
  tier2_diagnostic: prompts/tier2_diagnostic.txt
  review_suggestions: prompts/review_suggestions.txt
  writing_coach: prompts/writing_coach.txt

references:
  # 默认严格：发现缺失 bibkey 的 \\cite{...} 直接拒绝写入（防止幻觉引用）
  allow_missing_citations: false

structure:
  expected_subsubsections:
    - 研究背景
    - 国内外研究现状
    - 现有研究的局限性
    - 研究切入点
  strict_title_match: true
  # strict_title_match=false 时启用“模糊标题匹配”（必要时会调用 AI 在候选标题中做语义匹配）
  min_title_similarity: 0.6
  min_subsubsection_count: 4

guardrails:
  allowed_write_files:
    - extraTex/1.1.立项依据.tex
  forbidden_write_files:
    - main.tex
    - extraTex/@config.tex
  forbidden_write_globs:
    - "**/*.cls"
    - "**/*.sty"

latex_style_contract:
  keep_commands:
    - "\\justifying"
    - "\\indent"
  avoid_commands:
    - "\\section"
    - "\\subsection"
    - "\\input"
    - "\\include"

quality_contract:
  must_include:
    - 价值与必要性（为什么要做）
    - 国内外现状与不足（现有不足）
    - 科学问题/核心假说（切入点）
    - 本项目贡献与小结（承上启下）
  avoid:
    - 无法核验的绝对表述（例如“国内首次”“国际领先”）
    - 幻觉引用（未核验即给出作者/年份/期刊/DOI）

quality:
  forbidden_phrases:
    - 国际领先
    - 国内首次
    - 世界领先
    - 填补空白
  avoid_commands:
    - "\\section"
    - "\\subsection"
    - "\\input"
    - "\\include"

word_count:
  target: 4000
  tolerance: 200
  # cjk_only: 仅剔除注释后统计 CJK 字符数（默认）
  # cjk_strip_commands: 粗剔除命令/数学环境/类代码环境后统计（更接近“正文字符数”的估计）
  mode: cjk_only

terminology:
  # auto: AI 可用则叠加 AI 语义检查，否则仅 legacy 规则矩阵
  # ai:   强制尝试 AI（不可用则回退）
  # legacy: 仅使用硬编码维度/别名组
  mode: auto
  ai:
    enabled: true
    max_chars: 20000
  dimensions:
    研究对象:
      研究对象: ["患者", "病例", "受试者", "样本"]
    指标:
      准确率: ["准确率", "精确度"]
    术语:
      深度学习: ["深度学习", "DL"]
