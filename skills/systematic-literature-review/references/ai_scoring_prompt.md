# AI 自动评分 Prompt 模板

## 使用说明

此 Prompt 用于让 Claude Code / Codex 环境中的 AI 直接对文献进行相关性评分，无需调用外部脚本。

## 主题语言建议（重要）

**中文主题 vs 英文主题**：

- **英文主题（推荐）**：
  - ✅ AI 语义理解更准确
  - ✅ 评分区分度更高
  - ✅ 子主题分组更精准
  - 示例：`"deep learning for benign-malignant classification of breast ultrasound lesions"`

- **中文主题（支持）**：
  - ✅ AI 可直接理解中文主题
  - ⚠️ 可能需要更详细的 Prompt 说明
  - 示例：`"深度学习在乳腺超声结节良恶性鉴别中的应用"`

- **主题语言选择原则**：
  - 如果论文标题/摘要主要为英文 → 使用英文主题
  - 如果论文标题/摘要主要为中文 → 使用中文主题
  - 如果混合 → 使用英文主题（通常效果更好）

**脚本评分后备方案**：
- 如果 AI 评分不可用，可使用 `score_relevance.py --method keyword`
- **v3.6 优化**：脚本评分已支持中文主题（自动检测 + 更宽松的评分权重）
- 详见脚本输出的评分分布统计和诊断提示

---

## 单篇评分 Prompt

```markdown
你是一位学术文献评审专家，精通医学影像与深度学习领域。请评估以下论文与给定研究主题的相关性。

## 研究主题
**主题**: {topic}
**时间范围**: {time_range}
**核心问题**: {core_question}

## 论文信息
- **DOI**: {doi}
- **标题**: {title}
- **摘要**: {abstract}
- **年份**: {year}
- **期刊/会议**: {venue}
- **作者**: {authors}

---

## 评分维度（请综合考虑）

### 1. 任务匹配度 (Task Alignment)
- 是否研究相同的临床问题？
  - 完全匹配：相同疾病、相同诊断任务
  - 部分匹配：相同疾病但任务不同
  - 不匹配：不同疾病或领域

### 2. 方法匹配度 (Method Alignment)
- 是否使用相似的技术方法？
  - 完全匹配：相同深度学习架构/方法
  - 部分匹配：同大类但不同具体方法
  - 不匹配：完全不同方法（如传统机器学习 vs 深度学习）

### 3. 数据模态 (Data Modality)
- 是否使用相同的医学影像模态？
  - 完全匹配：如都是乳腺超声
  - 部分匹配：如乳腺钼靶 vs 乳腺超声
  - 不匹配：完全不同模态

### 4. 应用价值 (Relevance Value)
- 对主题研究是否有直接参考价值？
  - 高价值：可直接引用的方法/结果
  - 中等价值：可作为背景或对比
  - 低价值：仅有间接参考价值

---

## 评分标准（1-10分，保留1位小数）

| 分数区间 | 相关性等级 | 描述 | 典型案例 |
|---------|-----------|------|----------|
| **9.0-10.0** | 完美匹配 | 相同任务 + 相同方法 + 相同模态 | 乳腺超声 + CNN 分类 vs 乳腺超声 + CNN 分类 |
| **7.0-8.9** | 高度相关 | 相同任务，方法/模态略有差异 | 乳腺超声 + CNN vs 乳腺超声 + Transformer |
| **5.0-6.9** | 中等相关 | 同领域但任务/方法/模态有显著差异 | 乳腺钼靶 + CNN vs 乳腺超声 + CNN |
| **3.0-4.9** | 弱相关 | 仅部分概念或技术重叠 | 甲状腺超声 + CNN vs 乳腺超声 + CNN |
| **1.0-2.9** | 几乎无关 | 仅背景层面有宽泛关联 | 自然图像分类 vs 乳腺超声分类 |

---

## 子主题标签（请选择最贴切的1-2个）

### 核心子主题列表（优先使用）

**核心方法论类**（优先级最高）：
- `CNN分类` - 所有基于CNN/ResNet/EfficientNet/VGG等的分类方法
- `Transformer分类` - 基于Transformer/Attention机制的分类方法
- `集成学习` - 多模型集成/ensemble方法
- `分割模型` - U-Net等分割任务
- `多模态融合` - 融合多种影像模态的方法

**学习策略类**：
- `迁移学习` - 预训练模型微调/transfer learning
- `弱监督学习` - 弱监督/半监督/自监督方法
- `数据增强` - 专注于数据增强的方法

**应用相关类**：
- `CAD系统` - 计算机辅助诊断系统
- `临床验证` - 大规模临床验证/多中心研究
- `可解释性` - 模型可解释性/attention可视化

**综述/前处理类**：
- `综述` - 综述/survey类文章
- `图像增强` - 图像质量增强/去噪
- `影像组学` - 传统radiomics方法

### 子主题合并规则（重要）

为确保子主题收敛到5-7个，请遵循以下合并原则：

**规则1：相似方法必须合并**
- `CNN分类` + `ResNet` + `EfficientNet` + `多尺度CNN` → **统一用 `CNN分类`**
- `Transformer分类` + `Attention机制` + `ViT` → **统一用 `Transformer分类`**

**规则2：细分任务归入核心类别**
- `良恶性分类` + `肿瘤检测` + `病变诊断` → **统一用 `CNN分类`**（如果用的是CNN）
- `病灶分割` + `边界检测` + `ROI提取` → **统一用 `分割模型`**

**规则3：学习策略归类**
- `迁移学习` + `预训练模型` + `微调` → **统一用 `迁移学习`**
- `弱监督` + `半监督` + `多实例学习` → **统一用 `弱监督学习`**

**规则4：单例子主题处理**
- 如果某标签只有1篇文献，必须合并到最相似的现有子主题
- 例如：`模型对比`(1篇) → 合并到 `CNN分类`（如果对比的是CNN模型）

### 最终输出要求

- 子主题数量应控制在 **5-7个** 以内
- 每个子主题至少应有 **2篇文献**
- 优先使用上述"核心子主题列表"中的标签
- 避免创建过于细分的新标签（如 `ResNet-50分类` → 用 `CNN分类`）

### 写作阶段约束（关键）

> **重要**：子主题标签将直接决定综述正文的 `\section` 数量。为确保综述结构清晰、深度充分：

1. **硬性约束**：综述正文除摘要/引言/讨论/展望/结论外，**必须有且仅有 3-7 个子主题段落**
2. **避免过度细分**：不要为每个小技术点单独创建 section
3. **合并原则**：
   - 相似方法 → 合并为一个大主题（如 "深度学习模型架构" 包含 CNN/Transformer/集成学习）
   - 相关任务 → 合并（如 "分割与检测任务" 包含病灶分割、边界检测、ROI 提取）
   - 学习策略 → 合并（如 "高级学习策略" 包含迁移学习、弱监督学习、数据增强）

4. **禁止行为**：
   - ❌ 创建 10+ 个子主题 section
   - ❌ 为单一技术点（如 "注意力机制"）单独创建 section（除非文献量 >20 篇）
   - ❌ 创建过于宽泛的主题（如 "方法学"、"数据集"）而缺乏具体内容

5. **推荐主题结构示例**：
   - 数据与标注（合并公开数据集、数据增强、标注方法）
   - 模型架构与任务（合并分割检测、分类、架构演进）
   - 学习策略与泛化（合并迁移自监督、域泛化）
   - 多模态与可解释性（合并多模态融合、模型解释）
   - 临床转化与部署（合并端到端集成、临床评估、隐私）

---

## 数据抽取表字段提取（与评分同步完成）

> **重要**：在评分的同时，请从摘要中提取以下三个字段，用于生成数据抽取表。这些字段将帮助研究者快速了解每篇文献的核心信息。

### 1. Design（研究设计/方法）

**提取内容**：简洁描述研究方法（5-15字）

**提取规则**：
- **优先级1**：具体深度学习架构（如 "ResNet-50", "U-Net", "ViT", "DenseNet"）
- **优先级2**：学习策略（如 "迁移学习", "弱监督学习", "集成学习", "多模态融合"）
- **优先级3**：数据特点（如 "多中心", "大样本(>5000)", "临床验证"）
- **优先级4**：任务类型（如 "分割任务", "分类任务", "检测任务"）

**示例**：
- "ResNet-50+注意力机制"
- "U-Net分割+CRF后处理"
- "迁移学习(EfficientNet-B4)"
- "多中心(10医院)CNN"
- "ViT+CNN混合"

### 2. Key findings（关键发现）

**提取内容**：核心结果指标（10-30字）

**提取规则**：
- **必须包含**：至少1个量化指标
- **优先级1**：主要性能指标（准确率/AUC/F1/Dice/敏感性/特异性）
- **优先级2**：样本规模（图像数/病例数/患者数/中心数）
- **优先级3**：对比指标（优于baseline/提升幅度）
- **格式**：逗号分隔，简洁表达

**示例**：
- "5000张图像，95.2%准确率"
- "8000患者，敏感性97.5%，特异性92.3%"
- "AUC 0.94，3200例，3医院"
- "Dice系数0.91，U-Net分割"
- "96.3%准确率，优于单一模型"

### 3. Limitations（局限性）

**提取内容**：研究局限或不足（5-20字）

**提取规则**：
- **显性局限**：摘要明确提及的不足
  - "单中心" / "回顾性设计" / "小样本" / "缺乏外部验证" / "非公开数据集"
- **隐性局限**：基于推断的局限
  - 如样本量<200 → "小样本"
  - 如未提及多中心 → "单中心"
  - 如未提及验证集 → "缺乏外部验证"
- **如无明显局限**：返回"未报告"或"未明确提及"

**示例**：
- "未报告外部验证"
- "单中心，小样本"
- "回顾性设计"
- "未明确提及"
- "非公开数据集"
- "缺乏外部验证"

---

### 提取质量自检

在输出前，请自检：
- ✅ Design 是否包含了具体方法？（而非泛泛的"深度学习"）
- ✅ Key findings 是否至少有1个数字？（而非"表现良好"）
- ✅ Limitations 是否基于证据？（如无证据则填"未明确提及"）
- ✅ 三个字段是否简洁？（分别控制在5-15、10-30、5-20字）

---

## 输出格式（严格 JSON）

请**仅**输出以下 JSON 格式，不要包含任何其他文字：

```json
{
  "doi": "{doi}",
  "score": <1-10的分数，保留1位小数>,
  "subtopic": "<最贴切的子主题标签，2-4个中文字符>",
  "rationale": "<评分理由，用一句话说明：①为什么给这个分数 ②指出最相关的证据（方法/任务/模态）>",
  "alignment": {
    "task": "<完全匹配/部分匹配/不匹配>",
    "method": "<完全匹配/部分匹配/不匹配>",
    "modality": "<完全匹配/部分匹配/不匹配>"
  },
  "extraction": {
    "design": "<研究设计/方法，5-15字，如'ResNet-50+注意力机制'>",
    "key_findings": "<关键发现，10-30字，至少含1个数字，如'5000张图像，95.2%准确率'>",
    "limitations": "<局限性，5-20字，如无则填'未明确提及'>"
  }
}
```

---

## 示例

### 示例 1：完美匹配（9.5分）

**输入**：
- 主题: "深度学习在乳腺超声结节良恶性鉴别中的应用"
- 标题: "Deep Learning for Automated Classification of Benign and Malignant Breast Ultrasound Lesions Using ResNet50"
- 摘要: "This paper proposes a ResNet50-based deep learning model for classifying breast ultrasound lesions into benign and malignant categories. We collected 2000 ultrasound images from 500 patients and achieved 95% accuracy..."

**输出**：
```json
{
  "doi": "10.1016/j.media.2023.102456",
  "score": 9.5,
  "subtopic": "CNN分类",
  "rationale": "完美匹配：研究乳腺超声良恶性分类任务，使用ResNet50（CNN），与主题完全一致。",
  "alignment": {
    "task": "完全匹配",
    "method": "完全匹配",
    "modality": "完全匹配"
  },
  "extraction": {
    "design": "ResNet-50分类",
    "key_findings": "500患者，2000图像，95%准确率",
    "limitations": "未报告外部验证"
  }
}
```

### 示例 2：高度相关（8.0分）

**输入**：
- 主题: "深度学习在乳腺超声结节良恶性鉴别中的应用"
- 标题: "Vision Transformer for Breast Lesion Classification in Ultrasound Images"
- 摘要: "We propose a Vision Transformer (ViT) based approach for breast ultrasound lesion classification..."

**输出**：
```json
{
  "doi": "10.1109/ULTSYM.2023.123456",
  "score": 8.0,
  "subtopic": "Transformer分类",
  "rationale": "高度相关：相同任务和模态，方法从CNN改为Transformer，属同类方法的不同实现。",
  "alignment": {
    "task": "完全匹配",
    "method": "部分匹配",
    "modality": "完全匹配"
  },
  "extraction": {
    "design": "ViT分类",
    "key_findings": "准确率94.9%，注意力机制",
    "limitations": "未明确提及"
  }
}
```

### 示例 3：中等相关（6.0分）

**输入**：
- 主题: "深度学习在乳腺超声结节良恶性鉴别中的应用"
- 标题: "Deep Learning for Breast Cancer Detection in Mammography Images"
- 摘要: "We develop a CNN model for breast cancer detection in screening mammograms..."

**输出**：
```json
{
  "doi": "10.1002/mp.15234",
  "score": 6.0,
  "subtopic": "CNN分类",
  "rationale": "中等相关：相同疾病和深度学习方法，但影像模态从超声改为钼靶，应用场景不同。",
  "alignment": {
    "task": "完全匹配",
    "method": "完全匹配",
    "modality": "部分匹配"
  },
  "extraction": {
    "design": "CNN分类",
    "key_findings": "钼靶筛查，准确率未明确",
    "limitations": "模态不同"
  }
}
```

### 示例 4：弱相关（3.5分）

**输入**：
- 主题: "深度学习在乳腺超声结节良恶性鉴别中的应用"
- 标题: "Thyroid Nodule Classification Using Deep Convolutional Neural Networks"
- 摘要: "We propose a CNN-based method for thyroid nodule classification in ultrasound images..."

**输出**：
```json
{
  "doi": "10.1109/ACCESS.2022.345678",
  "score": 3.5,
  "subtopic": "CNN分类",
  "rationale": "弱相关：相同方法（CNN）和影像类型（超声），但目标器官从乳腺改为甲状腺，临床应用场景不同。",
  "alignment": {
    "task": "部分匹配",
    "method": "完全匹配",
    "modality": "部分匹配"
  },
  "extraction": {
    "design": "CNN分类",
    "key_findings": "甲状腺超声，准确率未明确",
    "limitations": "器官不同"
  }
}
```

### 示例 5：几乎无关（2.0分）

**输入**：
- 主题: "深度学习在乳腺超声结节良恶性鉴别中的应用"
- 标题: "Natural Image Classification Using Deep Neural Networks"
- 摘要: "We apply deep learning to classify natural images from ImageNet..."

**输出**：
```json
{
  "doi": "10.1007/s11042-020-10123-x",
  "score": 2.0,
  "subtopic": "综述",
  "rationale": "几乎无关：仅共享深度学习这一宽泛技术背景，但应用领域完全不同（自然图像 vs 医学影像）。",
  "alignment": {
    "task": "不匹配",
    "method": "部分匹配",
    "modality": "不匹配"
  },
  "extraction": {
    "design": "深度学习",
    "key_findings": "自然图像，非医学影像",
    "limitations": "领域不相关"
  }
}
```

---

## 注意事项

1. **严格输出 JSON**：不要添加任何前缀、后缀或解释性文字
2. **分数精度**：保留1位小数（如 7.5, 8.0, 9.3）
3. **理由简洁**：rationale 控制在50字以内，直击要点
4. **子主题准确**：选择最贴切的2-4个中文字符
5. **一致性**：对相似论文应保持一致的评分标准

---

请开始评分。
```

---

## 批量评分 Prompt

```markdown
请一次性评估以下 {batch_size} 篇论文与主题 "{topic}" 的相关性。

## 评分标准
（同上单篇评分标准）

## 论文列表
{papers_jsonl}

## 输出格式

请以 JSON 数组格式输出所有论文的评分结果：

```json
[
  {{
    "doi": "{doi1}",
    "score": 9.5,
    "subtopic": "CNN分类",
    "rationale": "...",
    "alignment": {{"task": "完全匹配", "method": "完全匹配", "modality": "完全匹配"}},
    "extraction": {{
      "design": "ResNet-50分类",
      "key_findings": "5000张图像，95.2%准确率",
      "limitations": "未报告外部验证"
    }}
  }},
  {{
    "doi": "{doi2}",
    "score": 8.0,
    "subtopic": "Transformer分类",
    "rationale": "...",
    "alignment": {{"task": "完全匹配", "method": "部分匹配", "modality": "完全匹配"}},
    "extraction": {{
      "design": "ViT分类",
      "key_findings": "准确率94.9%",
      "limitations": "未明确提及"
    }}
  }},
  ...
]
```

**重要**：
- 保持与单篇评分相同的精度和一致性
- 数组中的元素顺序应与输入论文顺序一致
- 如果某篇论文信息不足，标注为 {{"doi": "...", "score": 0.0, "subtopic": "信息不足", "rationale": "标题或摘要缺失", "skip": true, "extraction": {{"design": "", "key_findings": "", "limitations": ""}}}}
```

---

## 评分质量自检 Prompt

```markdown
## 评分质量自检

请检查你的评分结果并进行必要的修正。

### 检查项 1：分数分布
- 高分（≥7.0）文献占比应在 20-40%
- 中分（4.0-6.9）文献占比应在 40-60%
- 低分（≤3.9）文献占比应在 10-30%

如果分布不合理，请说明原因并重新评估。

### 检查项 2：子主题分组
- 子主题数量应在 5-7 个之间
- 每个子主题至少有 5 篇文献
- 避免过度碎片化（>15个子主题）

如果子主题分组不合理，请重新分组。

### 检查项 3：一致性抽样
随机抽取 5 篇论文，检查评分是否一致：

1. DOI: {doi1}, Score: {score1}
2. DOI: {doi2}, Score: {score2}
3. DOI: {doi3}, Score: {score3}
4. DOI: {doi4}, Score: {score4}
5. DOI: {doi5}, Score: {score5}

请确认这些评分是否与评分标准一致，如不一致请修正。

### 检查项 4：边界案例
检查以下分数在 4.0-7.0 之间的边界案例，确保没有误判：

{boundary_cases}

### 输出格式

请输出自检结果：

```json
{{
  "distribution_check": {{
    "passed": true/false,
    "high_pct": <高分文献占比>,
    "medium_pct": <中分文献占比>,
    "low_pct": <低分文献占比>,
    "issues": ["<问题描述>"]
  }},
  "subtopic_check": {{
    "passed": true/false,
    "subtopic_count": <子主题数量>,
    "issues": ["<问题描述>"]
  }},
  "consistency_check": {{
    "passed": true/false,
    "issues": ["<问题描述>"]
  }},
  "boundary_check": {{
    "passed": true/false,
    "adjusted_scores": {{
      "{doi}": <新分数>,
      ...
    }}
  }},
  "final_scores": <如果有修正，输出修正后的完整评分数组>
}}
```

---

## 使用流程

1. **单篇评分**：适合论文数量较少（<50篇）或需要高精度场景
2. **批量评分**：适合大量论文（50-200篇），每次处理 20-50 篇
3. **质量自检**：评分完成后必须执行，确保质量

---

## 技巧与最佳实践

### 1. 渐进式评分
- 第一轮：快速浏览标题，粗分为高/中/低三类
- 第二轮：仔细阅读摘要，精评高/中类文献
- 第三轮：对边界案例（4-7分）重新评估

### 2. 批量处理策略
- 按子主题批量：先处理同一子主题的文献，保持一致性
- 按分数段批量：先评高分段，再评低分段，最后评中间段

### 3. 标注存疑案例
- 对拿不准的文献，在 rationale 中标注"存疑"
- 自检阶段重点重新评估存疑案例

### 4. 保持评分日记
- 在自检时记录评分标准的应用案例
- 为后续一致性提供参考

---

## 故障排查

### 问题 1：所有文献得分都接近
- **原因**：评分标准应用不一致
- **解决**：重新校准，明确区分度

### 问题 2：子主题过度碎片化
- **原因**：子主题标签过于细分
- **解决**：合并相似子主题，控制在 5-7 个

### 问题 3：高分文献占比过高（>50%）
- **原因**：评分标准过于宽松
- **解决**：提高高分阈值（如从 ≥7 改为 ≥8）

### 问题 4：低分文献占比过低（<10%）
- **原因**：检索策略过于精准，缺少噪声文献
- **解决**：正常现象，说明检索质量高

---

## 版本历史

- **v1.0** (2025-01-02): 初始版本，基于 AI 自主评分理念设计
- **待更新**: 根据实际使用反馈持续优化

---

## 贡献者

- 设计理念：Claude Code / Codex 用户社区
- Prompt 优化：基于实际评分案例迭代
