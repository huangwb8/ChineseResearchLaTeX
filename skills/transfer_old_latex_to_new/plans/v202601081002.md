# LaTeX æ ‡ä¹¦æ™ºèƒ½è¿ç§»æŠ€èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

**æ–¹æ¡ˆç¼–å·**: v202601081002
**åˆ›å»ºæ—¶é—´**: 2026-01-08
**ç›®æ ‡ç‰ˆæœ¬**: v1.3.0
**å½“å‰ç‰ˆæœ¬**: v1.2.0
**çŠ¶æ€**: å¾…è¯„å®¡

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

### ç°çŠ¶è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **æ¶æ„è®¾è®¡** | â­â­â­â­ | äº”é˜¶æ®µå·¥ä½œæµæ¸…æ™°ï¼Œæ¨¡å—èŒè´£æ˜ç¡® |
| **æ–‡æ¡£å®Œæ•´æ€§** | â­â­â­â­â­ | è¶…è¿‡ 2000 è¡Œå‚è€ƒæ–‡æ¡£ï¼Œè¦†ç›–æ‰€æœ‰åœºæ™¯ |
| **å®‰å…¨æ€§** | â­â­â­â­â­ | ç™½åå•æœºåˆ¶ + è‡ªåŠ¨å¿«ç…§ + ä¸€é”®æ¢å¤ |
| **æ€§èƒ½** | â­â­â­ | å¤§å‹é¡¹ç›®å¯èƒ½è€—æ—¶ 30+ åˆ†é’Ÿï¼ˆAI è°ƒç”¨ç“¶é¢ˆï¼‰ |
| **å¯æµ‹è¯•æ€§** | â­â­ | ç¼ºå°‘è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œé•¿æœŸå¯ç»´æŠ¤æ€§é£é™© |

### å…³é”®é—®é¢˜

| ä¼˜å…ˆçº§ | é—®é¢˜ | å½±å“ |
|--------|------|------|
| **ğŸ”´ é«˜** | AI è¯­ä¹‰æ˜ å°„æ€§èƒ½ç“¶é¢ˆ | å¤§å‹é¡¹ç›®è€—æ—¶ 30+ åˆ†é’Ÿ |
| **ğŸ”´ é«˜** | ç¼ºå°‘æµ‹è¯•è¦†ç›– | ä»£ç è´¨é‡éš¾ä»¥ä¿è¯ |
| **ğŸ”´ é«˜** | é”™è¯¯æ¢å¤æœºåˆ¶ä¸å®Œå–„ | æ— æ³•é’ˆå¯¹å•ä¸ªæ–‡ä»¶å›æ»š |
| **ğŸŸ¡ ä¸­** | é…ç½®å¤æ‚åº¦è¿‡é«˜ | æ–°ç”¨æˆ·ä¸Šæ‰‹å›°éš¾ |
| **ğŸŸ¡ ä¸­** | ç¼ºå°‘è¿›åº¦åé¦ˆ | "é»‘ç›’"æ“ä½œä½“éªŒå·® |
| **ğŸŸ¡ ä¸­** | ç‰ˆæœ¬å…¼å®¹æ€§æ£€æµ‹ä¸è¶³ | å¯èƒ½äº§ç”Ÿéšå¼é”™è¯¯ |

---

## ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆè¯¦è§£

### ä¼˜åŒ–é¡¹ 1: å¼•å…¥åˆ†å±‚ç¼“å­˜æœºåˆ¶

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜
**å®æ–½éš¾åº¦**: â­â­ ä¸­ç­‰
**é¢„æœŸæ•ˆæœ**: æ€§èƒ½æå‡ 5-10 å€

#### é—®é¢˜æè¿°

å½“å‰ AI è¯­ä¹‰æ˜ å°„å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼š
- æ¯å¯¹æ–‡ä»¶éƒ½éœ€è¦è°ƒç”¨ AI åˆ¤æ–­æ˜ å°„å…³ç³»
- å¤§å‹é¡¹ç›®ï¼ˆ100+ æ–‡ä»¶ï¼‰å¯èƒ½éœ€è¦æ•°ç™¾æ¬¡ AI è°ƒç”¨
- æ¯æ¬¡è°ƒç”¨è€—æ—¶ 5-10 ç§’ï¼Œæ€»è®¡å¯èƒ½è¶…è¿‡ 30 åˆ†é’Ÿ

#### è§£å†³æ–¹æ¡ˆ

å¼•å…¥ä¸‰å±‚ç¼“å­˜æœºåˆ¶ï¼š

```python
# core/cache_manager.pyï¼ˆæ–°å»ºï¼‰

class CacheManager:
    """åˆ†å±‚ç¼“å­˜ç®¡ç†å™¨"""

    def __init__(self, cache_dir: str = "cache"):
        self.cache_dir = Path(cache_dir)
        self.cache_dir.mkdir(exist_ok=True)

        # L1: å†…å­˜ç¼“å­˜ï¼ˆå½“å‰ä¼šè¯ï¼‰
        self.memory_cache = {}

        # L2: SQLite ç£ç›˜ç¼“å­˜ï¼ˆè·¨ä¼šè¯ï¼‰
        self.db_path = self.cache_dir / "mapping_cache.db"
        self.conn = sqlite3.connect(self.db_path)
        self._init_db()

    def get(self, old_file: str, new_file: str) -> Optional[dict]:
        """è·å–ç¼“å­˜ï¼ˆL1 â†’ L2 â†’ AIï¼‰"""
        cache_key = self._make_key(old_file, new_file)

        # L1: å†…å­˜ç¼“å­˜
        if cache_key in self.memory_cache:
            return self.memory_cache[cache_key]

        # L2: SQLite ç¼“å­˜
        cursor = self.conn.execute(
            "SELECT result FROM mapping_cache WHERE cache_key = ?",
            (cache_key,)
        )
        row = cursor.fetchone()
        if row:
            result = json.loads(row[0])
            self.memory_cache[cache_key] = result  # æå‡åˆ° L1
            return result

        return None

    def set(self, old_file: str, new_file: str, result: dict):
        """è®¾ç½®ç¼“å­˜ï¼ˆåŒæ—¶å†™å…¥ L1 å’Œ L2ï¼‰"""
        cache_key = self._make_key(old_file, new_file)

        # å†™å…¥ L1
        self.memory_cache[cache_key] = result

        # å†™å…¥ L2
        self.conn.execute(
            "INSERT OR REPLACE INTO mapping_cache (cache_key, result) VALUES (?, ?)",
            (cache_key, json.dumps(result))
        )
        self.conn.commit()
```

#### é…ç½®å˜æ›´

```yaml
# config.yaml æ–°å¢

cache:
  enabled: true                    # å¯ç”¨ç¼“å­˜
  strategy: "layered"              # åˆ†å±‚ç­–ç•¥: layered/none
  memory_max_size: 1000            # å†…å­˜ç¼“å­˜æœ€å¤§æ¡ç›®æ•°
  disk_db_path: "cache/mapping_cache.db"  # ç£ç›˜ç¼“å­˜è·¯å¾„
  ttl_days: 30                     # ç¼“å­˜è¿‡æœŸå¤©æ•°
```

#### é›†æˆåˆ° mapping_engine.py

```python
class MappingEngine:
    def __init__(self, config: dict):
        self.config = config
        self.cache = CacheManager(config['cache']['disk_db_path'])

    async def _ai_judge_mapping(self, context: dict) -> dict:
        # æ£€æŸ¥ç¼“å­˜
        cached = self.cache.get(context['old_file'], context['new_file'])
        if cached:
            return cached

        # è°ƒç”¨ AI
        result = await self._call_ai(context)

        # å†™å…¥ç¼“å­˜
        self.cache.set(context['old_file'], context['new_file'], result)

        return result
```

---

### ä¼˜åŒ–é¡¹ 2: æ‰¹é‡ AI è°ƒç”¨ä¼˜åŒ–

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜
**å®æ–½éš¾åº¦**: â­â­ ä¸­ç­‰
**é¢„æœŸæ•ˆæœ**: å‡å°‘ç½‘ç»œå¼€é”€ï¼Œæå‡ 3-5 å€

#### é—®é¢˜æè¿°

å½“å‰æ¯å¯¹æ–‡ä»¶ç‹¬ç«‹è°ƒç”¨ AIï¼Œå­˜åœ¨å¤§é‡ç½‘ç»œå¼€é”€ã€‚

#### è§£å†³æ–¹æ¡ˆ

å®ç°æ‰¹é‡è°ƒç”¨ï¼š

```python
class MappingEngine:
    async def batch_ai_judge(self, contexts: List[dict]) -> List[dict]:
        """æ‰¹é‡åˆ¤æ–­æ˜ å°„å…³ç³»ï¼ˆå•æ¬¡ API è°ƒç”¨ï¼‰"""
        # æ„å»ºæ‰¹é‡ prompt
        batch_prompt = self._build_batch_prompt(contexts)

        # å•æ¬¡ API è°ƒç”¨
        response = await self.ai_client.complete(
            prompt=batch_prompt,
            max_tokens=16000  # è¶³å¤Ÿå¤„ç†å¤šä¸ªç»“æœ
        )

        # è§£ææ‰¹é‡ç»“æœ
        results = self._parse_batch_results(response)

        return results

    def _build_batch_prompt(self, contexts: List[dict]) -> str:
        """æ„å»ºæ‰¹é‡åˆ¤æ–­ prompt"""
        prompt = "è¯·åˆ¤æ–­ä»¥ä¸‹æ–‡ä»¶å¯¹æ˜¯å¦åº”è¯¥æ˜ å°„ï¼Œè¿”å› JSON æ•°ç»„ï¼š\n\n"
        for i, ctx in enumerate(contexts):
            prompt += f"\n## æ–‡ä»¶å¯¹ {i+1}\n"
            prompt += f"æ—§æ–‡ä»¶: {ctx['old_file']}\n"
            prompt += f"æ–°æ–‡ä»¶: {ctx['new_file']}\n"
            prompt += f"å†…å®¹é¢„è§ˆ: {ctx['old_content'][:200]}...\n"
            prompt += f"å†…å®¹é¢„è§ˆ: {ctx['new_content'][:200]}...\n"

        prompt += "\n## è¾“å‡ºæ ¼å¼\n"
        prompt += '''
[
  {"should_map": true, "confidence": "high", "score": 0.95, "reason": "..."},
  {"should_map": false, "confidence": "low", "score": 0.3, "reason": "..."}
]
'''
        return prompt
```

#### é…ç½®å˜æ›´

```yaml
# config.yaml æ–°å¢

ai:
  # æ‰¹é‡è°ƒç”¨é…ç½®
  batch_mode: true                # å¯ç”¨æ‰¹é‡æ¨¡å¼
  batch_size: 10                  # æ¯æ‰¹å¤„ç†æ•°é‡
  max_concurrent_batches: 3       # æœ€å¤§å¹¶å‘æ‰¹æ¬¡æ•°
```

---

### ä¼˜åŒ–é¡¹ 3: å¹¶è¡ŒåŒ–å¤„ç†

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜
**å®æ–½éš¾åº¦**: â­â­ ä¸­ç­‰
**é¢„æœŸæ•ˆæœ**: å¤šæ ¸ CPU åœºæ™¯ä¸‹æå‡ 2-4 å€

#### é—®é¢˜æè¿°

å½“å‰å¤„ç†æµç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œæ— æ³•åˆ©ç”¨å¤šæ ¸ CPUã€‚

#### è§£å†³æ–¹æ¡ˆ

ä½¿ç”¨ asyncio + ThreadPoolExecutor å®ç°å¹¶è¡Œï¼š

```python
import asyncio
from concurrent.futures import ThreadPoolExecutor

class MappingEngine:
    def __init__(self, config: dict):
        self.executor = ThreadPoolExecutor(max_workers=config['ai']['max_workers'])

    async def compute_structure_diff(self, old_sections, new_sections):
        """å¹¶è¡Œè®¡ç®—æ‰€æœ‰æ–‡ä»¶å¯¹çš„æ˜ å°„å…³ç³»"""
        tasks = []

        # ä¸ºæ¯å¯¹æ–‡ä»¶åˆ›å»ºä»»åŠ¡
        for old_section in old_sections:
            for new_section in new_sections:
                task = self._judge_pair(old_section, new_section)
                tasks.append(task)

        # å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡
        results = await asyncio.gather(*tasks)

        return self._aggregate_results(results)
```

#### é…ç½®å˜æ›´

```yaml
# config.yaml æ–°å¢

ai:
  max_workers: 4                  # æœ€å¤§å¹¶è¡Œ worker æ•°ï¼ˆé»˜è®¤ CPU æ ¸å¿ƒæ•°ï¼‰
```

---

### ä¼˜åŒ–é¡¹ 4: å»ºç«‹æµ‹è¯•ä½“ç³»

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜
**å®æ–½éš¾åº¦**: â­â­â­ å¤æ‚
**é¢„æœŸæ•ˆæœ**: è¦†ç›–ç‡ 80%ï¼Œé•¿æœŸå¯ç»´æŠ¤æ€§æå‡

#### é—®é¢˜æè¿°

å½“å‰æ— è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä»£ç è´¨é‡éš¾ä»¥ä¿è¯ã€‚

#### è§£å†³æ–¹æ¡ˆ

å»ºç«‹ pytest æµ‹è¯•æ¡†æ¶ï¼š

```python
# tests/test_mapping_engine.pyï¼ˆæ–°å»ºï¼‰

import pytest
from core.mapping_engine import MappingEngine

@pytest.fixture
def engine():
    config = load_config("config.yaml")
    return MappingEngine(config)

def test_high_confidence_mapping(engine):
    """æµ‹è¯•é«˜ç½®ä¿¡åº¦ä¸€å¯¹ä¸€æ˜ å°„"""
    old_file = create_test_file("ç«‹é¡¹ä¾æ®.tex", "è¿™æ˜¯ç«‹é¡¹ä¾æ®å†…å®¹")
    new_file = create_test_file("ç«‹é¡¹ä¾æ®.tex", "è¿™æ˜¯ç«‹é¡¹ä¾æ®å†…å®¹")

    result = engine._ai_judge_mapping({
        'old_file': old_file,
        'new_file': new_file
    })

    assert result['should_map'] == True
    assert result['confidence'] == 'high'
    assert result['score'] >= 0.85

def test_low_confidence_mapping(engine):
    """æµ‹è¯•ä½ç½®ä¿¡åº¦æ˜ å°„ï¼ˆéœ€äººå·¥ç¡®è®¤ï¼‰"""
    old_file = create_test_file("ç ”ç©¶å†…å®¹.tex", "ç ”ç©¶å†…å®¹...")
    new_file = create_test_file("å·¥ä½œæ¡ä»¶.tex", "å·¥ä½œæ¡ä»¶...")

    result = engine._ai_judge_mapping({
        'old_file': old_file,
        'new_file': new_file
    })

    assert result['should_map'] == False
    assert result['confidence'] == 'low'
```

#### æµ‹è¯•è¦†ç›–ç›®æ ‡

| æ¨¡å— | ç›®æ ‡è¦†ç›–ç‡ | å…³é”®æµ‹è¯•ç‚¹ |
|------|-----------|-----------|
| `config_loader.py` | 90% | é…ç½®åŠ è½½ã€è·¯å¾„è§£æã€é»˜è®¤å€¼ |
| `project_analyzer.py` | 85% | ç« èŠ‚æ ‘è§£æã€æ ‡ç­¾æå–ã€ç‰ˆæœ¬è¯†åˆ« |
| `mapping_engine.py` | 80% | AI æ˜ å°„ã€ç¼“å­˜æœºåˆ¶ã€æ‰¹é‡è°ƒç”¨ |
| `migration_plan.py` | 75% | è®¡åˆ’ç”Ÿæˆã€ä»»åŠ¡åˆ†è§£ |
| `migrator.py` | 70% | å†…å®¹è¿ç§»ã€èµ„æºæ–‡ä»¶å¤„ç† |
| `compiler.py` | 80% | 4æ­¥ç¼–è¯‘ã€é”™è¯¯æå– |

---

### ä¼˜åŒ–é¡¹ 5: ç»†ç²’åº¦é”™è¯¯æ¢å¤

**ä¼˜å…ˆçº§**: ğŸ”´ é«˜
**å®æ–½éš¾åº¦**: â­â­ ä¸­ç­‰
**é¢„æœŸæ•ˆæœ**: æ”¯æŒå•æ–‡ä»¶å›æ»šï¼Œæå‡å¯é æ€§

#### é—®é¢˜æè¿°

å½“å‰åªæ”¯æŒ"å…¨éƒ¨æ¢å¤"ï¼Œæ— æ³•é’ˆå¯¹å•ä¸ªæ–‡ä»¶å›æ»šã€‚

#### è§£å†³æ–¹æ¡ˆ

å®ç°åŸºäº Git çš„ç»†ç²’åº¦ç‰ˆæœ¬æ§åˆ¶ï¼š

```python
# core/rollback_manager.pyï¼ˆæ–°å»ºï¼‰

class RollbackManager:
    """ç»†ç²’åº¦å›æ»šç®¡ç†å™¨"""

    def __init__(self, project_path: str, backup_dir: str):
        self.project_path = Path(project_path)
        self.backup_dir = Path(backup_dir)

    def create_file_snapshot(self, file_path: str) -> str:
        """ä¸ºå•ä¸ªæ–‡ä»¶åˆ›å»ºå¿«ç…§"""
        file_path = Path(file_path)
        snapshot_name = f"{file_path.name}_{uuid.uuid4().hex[:8]}.bak"
        snapshot_path = self.backup_dir / snapshot_name

        shutil.copy2(file_path, snapshot_path)

        return snapshot_path

    def restore_file(self, file_path: str, snapshot_name: str):
        """æ¢å¤å•ä¸ªæ–‡ä»¶"""
        snapshot_path = self.backup_dir / snapshot_name
        shutil.copy2(snapshot_path, file_path)

    def restore_all(self, run_id: str):
        """æ¢å¤æ‰€æœ‰æ–‡ä»¶ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰"""
        backup_path = self.backup_dir / f"run_{run_id}"
        shutil.copytree(backup_path, self.project_path, dirs_exist_ok=True)
```

---

### ä¼˜åŒ–é¡¹ 6: å®æ—¶è¿›åº¦åé¦ˆ

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**å®æ–½éš¾åº¦**: â­ ç®€å•
**é¢„æœŸæ•ˆæœ**: ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡

#### é—®é¢˜æè¿°

å½“å‰æ˜¯"é»‘ç›’"æ“ä½œï¼Œç”¨æˆ·çœ‹ä¸åˆ°å®æ—¶è¿›åº¦ã€‚

#### è§£å†³æ–¹æ¡ˆ

ä½¿ç”¨ rich.progress å®ç°è¿›åº¦æ¡ï¼š

```python
from rich.progress import Progress, SpinnerColumn, TextColumn, BarColumn

class MigrationOrchestrator:
    def run_migration(self, old_project, new_project):
        with Progress(
            SpinnerColumn(),
            TextColumn("[progress.description]{task.description}"),
            BarColumn(),
            TextColumn("[progress.percentage]{task.percentage:>3.0f}%"),
            expand=True
        ) as progress:

            # Phase 1: åˆ†æç»“æ„
            task1 = progress.add_task("[cyan]åˆ†ææ—§é¡¹ç›®ç»“æ„...", total=100)
            self.analyze_project(old_project)
            progress.update(task1, completed=100)

            # Phase 2: è®¡ç®—å·®å¼‚
            task2 = progress.add_task("[cyan]è®¡ç®—ç»“æ„å·®å¼‚...", total=100)
            self.compute_diff(old_project, new_project)
            progress.update(task2, completed=100)

            # Phase 3: ç”Ÿæˆè¿ç§»è®¡åˆ’
            task3 = progress.add_task("[cyan]ç”Ÿæˆè¿ç§»è®¡åˆ’...", total=100)
            plan = self.build_plan(diff_result)
            progress.update(task3, completed=100)

            # Phase 4: æ‰§è¡Œè¿ç§»ï¼ˆæ˜¾ç¤ºè¯¦ç»†è¿›åº¦ï¼‰
            task4 = progress.add_task("[cyan]è¿ç§»å†…å®¹...", total=len(plan.tasks))
            for task in plan.tasks:
                self.execute_task(task)
                progress.update(task4, advance=1, description=f"[cyan]è¿ç§»: {task.description}")
```

---

### ä¼˜åŒ–é¡¹ 7: ç®€åŒ–é…ç½®ï¼ˆé¢„è®¾æ¨¡æ¿ï¼‰

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**å®æ–½éš¾åº¦**: â­ ç®€å•
**é¢„æœŸæ•ˆæœ**: æ–°ç”¨æˆ·ä¸Šæ‰‹æ—¶é—´ä» 30 åˆ†é’Ÿé™è‡³ 5 åˆ†é’Ÿ

#### é—®é¢˜æè¿°

å½“å‰ 400+ è¡Œé…ç½®ï¼Œæ–°ç”¨æˆ·ä¸Šæ‰‹å›°éš¾ã€‚

#### è§£å†³æ–¹æ¡ˆ

æä¾›é¢„è®¾æ¨¡æ¿ï¼š

```yaml
# config.yaml æ–°å¢

profiles:
  quick:
    description: "å¿«é€Ÿæ¨¡å¼ï¼ˆé€‚åˆå°é¡¹ç›®ï¼Œ<20 ä¸ªæ–‡ä»¶ï¼‰"
    ai:
      batch_mode: false
      max_workers: 2
    cache:
      enabled: false
    optimization:
      max_rounds: 3

  balanced:
    description: "å¹³è¡¡æ¨¡å¼ï¼ˆé€‚åˆä¸­å‹é¡¹ç›®ï¼Œ20-100 ä¸ªæ–‡ä»¶ï¼‰"
    ai:
      batch_mode: true
      batch_size: 10
      max_workers: 4
    cache:
      enabled: true
    optimization:
      max_rounds: 5

  thorough:
    description: "ç²¾ç¡®æ¨¡å¼ï¼ˆé€‚åˆå¤§å‹é¡¹ç›®ï¼Œ>100 ä¸ªæ–‡ä»¶ï¼‰"
    ai:
      batch_mode: true
      batch_size: 20
      max_workers: 8
    cache:
      enabled: true
    optimization:
      max_rounds: 7
```

#### CLI ä½¿ç”¨

```bash
# ä½¿ç”¨é¢„è®¾æ¨¡æ¿
python scripts/run.py apply --profile quick --old ... --new ...

# è¦†ç›–ç‰¹å®šé…ç½®
python scripts/run.py apply --profile balanced --ai.max_workers 8 --old ... --new ...
```

---

### ä¼˜åŒ–é¡¹ 8: æ™ºèƒ½ç‰ˆæœ¬æ£€æµ‹

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**å®æ–½éš¾åº¦**: â­â­ ä¸­ç­‰
**é¢„æœŸæ•ˆæœ**: é¿å…éšå¼é”™è¯¯ï¼Œæå‰é¢„è­¦

#### é—®é¢˜æè¿°

å½“å‰ä¸ä¼šä¸»åŠ¨æ£€æµ‹ç‰ˆæœ¬å†²çªï¼Œå¯èƒ½å¯¼è‡´éšå¼é”™è¯¯ã€‚

#### è§£å†³æ–¹æ¡ˆ

å¢å¼ºç‰ˆæœ¬æ£€æµ‹ï¼š

```python
class ProjectAnalyzer:
    def detect_project_version(self, project_path: str) -> str:
        """æ£€æµ‹é¡¹ç›®ç‰ˆæœ¬ï¼ˆå¢å¼ºç‰ˆï¼‰"""
        main_tex = Path(project_path) / "main.tex"

        # è§£æ main.tex
        with open(main_tex, 'r', encoding='utf-8') as f:
            content = f.read()

        # æ–¹æ³•1: æ£€æŸ¥ç‰ˆæœ¬æ³¨é‡Š
        version_match = re.search(r'%\s*Version:\s*(\d{4})', content)
        if version_match:
            return version_match.group(1)

        # æ–¹æ³•2: æ£€æŸ¥æ¿å—ç»“æ„ç‰¹å¾
        if r'\section{ï¼ˆä¸€ï¼‰' in content:
            return "2026"
        elif r'\section{ä¸€ã€' in content:
            return "2025"
        elif r'\section{1}' in content:
            return "2024"

        return "unknown"

    def check_version_compatibility(self, old_version: str, new_version: str) -> dict:
        """æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§"""
        compatibility_map = {
            ("2024", "2025"): {"status": "compatible", "notes": "ç« èŠ‚ç¼–å·ä½“ç³»å˜åŒ–"},
            ("2025", "2026"): {"status": "compatible", "notes": "æ¿å—é‡ç»„ï¼Œæ–°å¢é£é™©åº”å¯¹ç« èŠ‚"},
            ("2024", "2026"): {"status": "requires_review", "notes": "è·¨ç‰ˆæœ¬è¿ç§»ï¼Œå»ºè®®åˆ†æ­¥è¿›è¡Œ"},
        }

        key = (old_version, new_version)
        if key in compatibility_map:
            return compatibility_map[key]

        return {"status": "unknown", "notes": "æœªçŸ¥ç‰ˆæœ¬ç»„åˆ"}
```

---

### ä¼˜åŒ–é¡¹ 9: AI å†™ä½œé£æ ¼è¯„åˆ†

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½
**å®æ–½éš¾åº¦**: â­â­ ä¸­ç­‰
**é¢„æœŸæ•ˆæœ**: è¿ç§»å†…å®¹è´¨é‡æå‡ 20%

#### è§£å†³æ–¹æ¡ˆ

åœ¨ Phase 5 è¿­ä»£ä¼˜åŒ–ä¸­å¢åŠ å†™ä½œé£æ ¼è¯„åˆ†ï¼š

```python
class WritingStyleScorer:
    """AI å†™ä½œé£æ ¼è¯„åˆ†å™¨"""

    def score_section(self, content: str, section_type: str) -> dict:
        """å¯¹ç« èŠ‚å†…å®¹è¿›è¡Œé£æ ¼è¯„åˆ†"""
        criteria = {
            "clarity": "æ¸…æ™°åº¦ï¼ˆè¡¨è¿°æ˜¯å¦æ˜ç¡®ï¼‰",
            "conciseness": "ç®€æ´æ€§ï¼ˆæœ‰æ— å†—ä½™è¡¨è¿°ï¼‰",
            "coherence": "è¿è´¯æ€§ï¼ˆé€»è¾‘æ˜¯å¦æµç•…ï¼‰",
            "academic_tone": "å­¦æœ¯æ€§ï¼ˆæ˜¯å¦ç¬¦åˆå­¦æœ¯è§„èŒƒï¼‰"
        }

        scores = {}
        for criterion, description in criteria.items():
            scores[criterion] = self._ai_score_criterion(content, section_type, criterion)

        return {
            "scores": scores,
            "average": sum(scores.values()) / len(scores),
            "suggestions": self._generate_suggestions(scores)
        }
```

---

### ä¼˜åŒ–é¡¹ 10: æ’ä»¶åŒ–æ¶æ„

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½
**å®æ–½éš¾åº¦**: â­â­â­ å¤æ‚
**é¢„æœŸæ•ˆæœ**: æ”¯æŒè‡ªå®šä¹‰è¿ç§»ç­–ç•¥

#### è§£å†³æ–¹æ¡ˆ

å®ç°æ’ä»¶ç³»ç»Ÿï¼š

```python
# core/plugin_manager.pyï¼ˆæ–°å»ºï¼‰

class PluginManager:
    """æ’ä»¶ç®¡ç†å™¨"""

    def __init__(self, plugin_dir: str = "plugins"):
        self.plugin_dir = Path(plugin_dir)
        self.plugins = {}

    def load_plugins(self):
        """åŠ è½½æ‰€æœ‰æ’ä»¶"""
        for plugin_file in self.plugin_dir.glob("*.py"):
            module = import_module(plugin_file.stem)
            if hasattr(module, 'register'):
                plugin = module.register()
                self.plugins[plugin.name] = plugin

    def get_plugin(self, name: str):
        """è·å–æ’ä»¶"""
        return self.plugins.get(name)
```

#### æ’ä»¶ç¤ºä¾‹

```python
# plugins/custom_mapping.pyï¼ˆç¤ºä¾‹ï¼‰

def register():
    return CustomMappingPlugin()

class CustomMappingPlugin:
    name = "custom_mapping"

    def on_mapping(self, old_file, new_file):
        # è‡ªå®šä¹‰æ˜ å°„é€»è¾‘
        if "ç‰¹æ®Š" in old_file:
            return {"should_map": True, "strategy": "custom"}
        return None
```

---

### ä¼˜åŒ–é¡¹ 11: æ€§èƒ½ç›‘æ§ä¸åˆ†æ

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½
**å®æ–½éš¾åº¦**: â­ ç®€å•
**é¢„æœŸæ•ˆæœ**: è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ

#### è§£å†³æ–¹æ¡ˆ

é›†æˆæ€§èƒ½åˆ†æï¼š

```python
import time
from functools import wraps

class PerformanceMonitor:
    """æ€§èƒ½ç›‘æ§å™¨"""

    def __init__(self):
        self.metrics = {}

    def record(self, func):
        """è£…é¥°å™¨ï¼šè®°å½•å‡½æ•°æ‰§è¡Œæ—¶é—´"""
        @wraps(func)
        def wrapper(*args, **kwargs):
            start = time.time()
            result = func(*args, **kwargs)
            elapsed = time.time() - start

            func_name = func.__name__
            if func_name not in self.metrics:
                self.metrics[func_name] = []
            self.metrics[func_name].append(elapsed)

            return result
        return wrapper

    def report(self):
        """ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š"""
        for func_name, times in self.metrics.items():
            avg = sum(times) / len(times)
            print(f"{func_name}: å¹³å‡ {avg:.2f}s ({len(times)} æ¬¡è°ƒç”¨)")
```

---

## ğŸ“… å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2 å‘¨ï¼‰ï¼šç¼“å­˜æœºåˆ¶ + æµ‹è¯•æ¡†æ¶

**ç›®æ ‡**: å»ºç«‹æ€§èƒ½åŸºç¡€å’Œè´¨é‡ä¿è¯

| ä»»åŠ¡ | è´Ÿè´£æ¨¡å— | é¢„æœŸå·¥æ—¶ |
|------|----------|----------|
| å®ç° CacheManager | `core/cache_manager.py` | 2 å¤© |
| é›†æˆåˆ° MappingEngine | `core/mapping_engine.py` | 1 å¤© |
| å»ºç«‹ pytest æ¡†æ¶ | `tests/` | 2 å¤© |
| ç¼–å†™æ ¸å¿ƒæ¨¡å—æµ‹è¯• | `tests/test_*.py` | 3 å¤© |

**äº¤ä»˜ç‰©**:
- `core/cache_manager.py`
- `tests/` æµ‹è¯•æ¡†æ¶
- æµ‹è¯•è¦†ç›–ç‡ â‰¥ 60%

### ç¬¬äºŒé˜¶æ®µï¼ˆ2-3 å‘¨ï¼‰ï¼šæ€§èƒ½ä¼˜åŒ–

**ç›®æ ‡**: æå‡æ€§èƒ½ 5-10 å€

| ä»»åŠ¡ | è´Ÿè´£æ¨¡å— | é¢„æœŸå·¥æ—¶ |
|------|----------|----------|
| å®ç°æ‰¹é‡ AI è°ƒç”¨ | `core/mapping_engine.py` | 3 å¤© |
| å®ç°å¹¶è¡ŒåŒ–å¤„ç† | `core/mapping_engine.py` | 2 å¤© |
| æ€§èƒ½æµ‹è¯•ä¸è°ƒä¼˜ | `tests/test_performance.py` | 2 å¤© |

**äº¤ä»˜ç‰©**:
- æ‰¹é‡ AI è°ƒç”¨åŠŸèƒ½
- å¹¶è¡ŒåŒ–å¤„ç†åŠŸèƒ½
- æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ1-2 å‘¨ï¼‰ï¼šç”¨æˆ·ä½“éªŒ

**ç›®æ ‡**: æå‡ç”¨æˆ·æ»¡æ„åº¦

| ä»»åŠ¡ | è´Ÿè´£æ¨¡å— | é¢„æœŸå·¥æ—¶ |
|------|----------|----------|
| å®ç°è¿›åº¦åé¦ˆç³»ç»Ÿ | `scripts/run.py` | 2 å¤© |
| å®ç°ç»†ç²’åº¦å›æ»š | `core/rollback_manager.py` | 2 å¤© |
| ç®€åŒ–é…ç½®ï¼ˆé¢„è®¾æ¨¡æ¿ï¼‰ | `config.yaml` | 1 å¤© |

**äº¤ä»˜ç‰©**:
- å®æ—¶è¿›åº¦æ¡
- å•æ–‡ä»¶å›æ»šåŠŸèƒ½
- 3 ä¸ªé¢„è®¾æ¨¡æ¿

### ç¬¬å››é˜¶æ®µï¼ˆ2-3 å‘¨ï¼‰ï¼šé«˜çº§åŠŸèƒ½

**ç›®æ ‡**: å¢å¼ºç«äº‰åŠ›

| ä»»åŠ¡ | è´Ÿè´£æ¨¡å— | é¢„æœŸå·¥æ—¶ |
|------|----------|----------|
| æ™ºèƒ½ç‰ˆæœ¬æ£€æµ‹ | `core/project_analyzer.py` | 2 å¤© |
| AI å†™ä½œé£æ ¼è¯„åˆ† | `core/style_scorer.py` | 3 å¤© |
| æ’ä»¶åŒ–æ¶æ„ | `core/plugin_manager.py` | 3 å¤© |

**äº¤ä»˜ç‰©**:
- ç‰ˆæœ¬å…¼å®¹æ€§æ£€æµ‹
- å†™ä½œé£æ ¼è¯„åˆ†
- æ’ä»¶ç³»ç»Ÿ

### ç¬¬äº”é˜¶æ®µï¼ˆ1 å‘¨ï¼‰ï¼šæµ‹è¯•ä¸å‘å¸ƒ

**ç›®æ ‡**: ç¡®ä¿ v1.3.0 è´¨é‡

| ä»»åŠ¡ | é¢„æœŸå·¥æ—¶ |
|------|----------|
| å®Œæ•´æµ‹è¯•è¦†ç›– | 2 å¤© |
| æ–‡æ¡£æ›´æ–° | 1 å¤© |
| å‘å¸ƒ v1.3.0 | 1 å¤© |

**äº¤ä»˜ç‰©**:
- æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- æ›´æ–°çš„æ–‡æ¡£
- v1.3.0 Release

---

## ğŸ“Š é¢„æœŸæ•ˆæœæ€»ç»“

### æ€§èƒ½æå‡

| åœºæ™¯ | å½“å‰ | ä¼˜åŒ–å | æå‡ |
|------|------|--------|------|
| å°å‹é¡¹ç›®ï¼ˆ<20 æ–‡ä»¶ï¼‰ | 5 åˆ†é’Ÿ | 1 åˆ†é’Ÿ | 5x |
| ä¸­å‹é¡¹ç›®ï¼ˆ20-100 æ–‡ä»¶ï¼‰ | 20 åˆ†é’Ÿ | 3 åˆ†é’Ÿ | 6.7x |
| å¤§å‹é¡¹ç›®ï¼ˆ>100 æ–‡ä»¶ï¼‰ | 40 åˆ†é’Ÿ | 5 åˆ†é’Ÿ | 8x |

### ç”¨æˆ·ä½“éªŒæå‡

| æŒ‡æ ‡ | å½“å‰ | ä¼˜åŒ–å |
|------|------|--------|
| é…ç½®ä¸Šæ‰‹æ—¶é—´ | 30 åˆ†é’Ÿ | 5 åˆ†é’Ÿ |
| è¿›åº¦å¯è§æ€§ | æ—  | å®æ—¶è¿›åº¦æ¡ |
| é”™è¯¯æ¢å¤ç²’åº¦ | å…¨éƒ¨æ¢å¤ | å•æ–‡ä»¶æ¢å¤ |
| æ–°æ‰‹å‹å¥½åº¦ | â­â­â­ | â­â­â­â­â­ |

### è´¨é‡ä¿è¯æå‡

| æŒ‡æ ‡ | å½“å‰ | ä¼˜åŒ–å |
|------|------|--------|
| æµ‹è¯•è¦†ç›–ç‡ | 0% | 80% |
| ç‰ˆæœ¬å†²çªæ£€æµ‹ | æ—  | è‡ªåŠ¨æ£€æµ‹ |
| æ€§èƒ½ç›‘æ§ | æ—  | å®Œæ•´æŠ¥å‘Š |

---

## âœ… æ£€æŸ¥æ¸…å•

### ä¼˜åŒ–å‰

- [ ] ç¡®è®¤å½“å‰ç‰ˆæœ¬ v1.2.0 ç¨³å®šè¿è¡Œ
- [ ] å¤‡ä»½ç°æœ‰ä»£ç 
- [ ] åˆ›å»ºä¼˜åŒ–åˆ†æ”¯ `feature/v1.3.0-optimization`

### ä¼˜åŒ–ä¸­

- [ ] æ¯ä¸ªä¼˜åŒ–é¡¹å®Œæˆåæ›´æ–°æ­¤æ–‡æ¡£
- [ ] æ¯ä¸ªä¼˜åŒ–é¡¹å®Œæˆåç¼–å†™/æ›´æ–°æµ‹è¯•
- [ ] æ¯ä¸ªä¼˜åŒ–é¡¹å®Œæˆåæ›´æ–°é…ç½®æ–‡ä»¶

### ä¼˜åŒ–å

- [ ] å®Œæ•´æµ‹è¯•å¥—ä»¶é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] CHANGELOG.md è®°å½•å˜æ›´
- [ ] å‘å¸ƒ v1.3.0

---

**å˜æ›´å†å²è®°å½•åœ¨** [æ ¹çº§ CHANGELOG.md](../../../CHANGELOG.md)
