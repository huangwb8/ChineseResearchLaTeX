# make_latex_model 技能测试计划

**测试实例**: v202601052118
**测试日期**: 2026-01-05
**测试目标**: 验证 `make_latex_model` 技能的核心能力和稳定性

---

## 1. 测试概述

### 1.1 测试目的

全面测试 `make_latex_model` 技能的以下能力：

1. **项目理解能力**: 深度阅读并分析现有 LaTeX 配置
2. **样式提取能力**: 从 Word 模板中精确提取样式要素
3. **差异分析能力**: 识别 LaTeX 与 Word 模板的样式差异
4. **优化执行能力**: 按照优化级别进行精准修改
5. **验证迭代能力**: 编译验证和像素级对比

### 1.2 测试范围

- **测试项目**: NSFC_Young (青年科学基金项目模板)
- **Word 模板**: 2026年最新word模板-青年科学基金项目（C类）-正文.doc
- **关键文件**:
  - `extraTex/@config.tex` (样式配置文件)
  - `main.tex` (主文档)
  - `fonts/` (字体文件)
  - `figures/` (图片资源)

### 1.3 测试级别

本次测试覆盖三种优化级别：
- **minimal**: 最小改动，仅修复明显错误
- **moderate**: 中等优化（默认级别）
- **thorough**: 彻底重构

---

## 2. 测试环境

### 2.1 目录结构

```
skills/make_latex_model/tests/v202601052118/
├── baseline/              # Word 打印的 PDF 基准
│   └── word.pdf          # Word 导出的 PDF（用于精确对比）
├── artifacts/            # 测试生成的产物
│   ├── latex.pdf        # LaTeX 生成的 PDF
│   ├── word.png         # Word PDF 转换的 PNG
│   └── latex.png        # LaTeX PDF 转换的 PNG
├── test_project/         # 复制的测试项目
│   ├── main.tex
│   ├── extraTex/
│   │   └── @config.tex
│   ├── fonts/
│   └── figures/
├── reports/              # 测试报告
│   ├── test_report.md
│   └── comparison.png
└── TEST_PLAN.md          # 本文件
```

### 2.2 依赖工具

- **XeLaTeX**: 编译 LaTeX 文档
- **Python 3**: 运行验证脚本
- **LibreOffice**: 将 Word 转换为 PDF（如无 Microsoft Word）
- **pdftoppm**: PDF 转 PNG 工具
- **ImageMagick**: 图像处理和对比

### 2.3 验证脚本

- `skills/make_latex_model/scripts/validate.sh`: 自动化验证脚本
- `skills/make_latex_model/scripts/benchmark.sh`: 性能基准测试

---

## 3. 测试用例

### 3.1 基础编译测试

**目标**: 验证测试环境可以正常编译 LaTeX 文档

**步骤**:
1. 复制 NSFC_Young 项目关键文件到测试目录
2. 运行 XeLaTeX 编译
3. 检查编译输出（无错误和警告）

**预期结果**:
- ✅ 编译成功，生成 `main.pdf`
- ✅ 无致命错误
- ✅ 字体加载正常

**验收标准**:
- [ ] PDF 文件成功生成
- [ ] 编译日志中无 `Error` 级别信息
- [ ] 文件大小合理（> 10 KB）

---

### 3.2 样式配置分析测试

**目标**: 验证技能能正确分析 `@config.tex` 的样式定义

**步骤**:
1. 读取 `test_project/extraTex/@config.tex`
2. 提取关键样式参数：
   - 页面设置 (geometry)
   - 颜色定义 (MsBlue RGB 值)
   - 字号系统
   - 标题格式 (titlesec)
   - 列表样式 (enumitem)

**预期结果**:
- ✅ 准确识别所有宏包加载
- ✅ 提取正确的样式参数值
- ✅ 理解条件判断结构（如 `\ifwindows`）

**验收标准**:
- [ ] 宏包列表完整
- [ ] 样式参数提取准确率 > 95%
- [ ] 特殊结构（条件判断）识别正确

---

### 3.3 Word 模板样式提取测试

**目标**: 验证能从 Word 模板中提取正确的样式要素

**步骤**:
1. 使用 LibreOffice 转换 Word → PDF
2. 测量关键样式参数：
   - 页面边距（上、下、左、右）
   - 正文字号和行距
   - 各级标题的字号、颜色、缩进、间距
   - 列表编号格式和缩进

**预期结果**:
- ✅ 成功生成 Word PDF 基准
- ✅ 样式参数测量精度 ±0.5pt
- ✅ 颜色值提取准确（RGB 误差 < 2）

**验收标准**:
- [ ] `baseline/word.pdf` 成功生成
- [ ] 关键样式参数记录完整
- [ ] 测量数据具有可复现性

---

### 3.4 差异分析与优化策略测试

**目标**: 验证能正确分析 LaTeX 与 Word 的样式差异

**步骤**:
1. 对比 LaTeX 样式与 Word 模板样式
2. 识别差异点（字号、颜色、间距等）
3. 根据 `optimization_level` 确定修改策略

**测试场景**:
- **minimal**: 仅修复明显错误（如颜色值错误）
- **moderate**: 调整不一致的样式（默认）
- **thorough**: 重构样式系统

**预期结果**:
- ✅ 差异识别准确率 > 90%
- ✅ 优化策略符合配置要求
- ✅ 修改范围合理（不破坏稳定性）

**验收标准**:
- [ ] 差异列表完整
- [ ] 优化策略与配置一致
- [ ] 修改建议具有可操作性

---

### 3.5 样式修改执行测试

**目标**: 验证能按照优化策略精确修改 `@config.tex`

**步骤**:
1. 根据 `moderate` 优化级别执行修改
2. 遵循"轻量级修改原则"
3. 仅修改样式配置，不触碰 `main.tex`

**关键约束**:
- ✅ 仅调整参数值（字号 pt、颜色 RGB、间距 em/cm）
- ✅ 新增自定义命令（不删除现有命令）
- ❌ 不改变宏包加载顺序
- ❌ 不重构条件判断结构

**验收标准**:
- [ ] `@config.tex` 修改符合预期
- [ ] `main.tex` 未被修改
- [ ] 代码风格和注释得以保留
- [ ] 向后兼容性保持

---

### 3.6 编译验证测试

**目标**: 验证修改后的样式能正确编译

**步骤**:
1. 编译修改后的 LaTeX 文档
2. 检查编译日志
3. 验证 PDF 生成

**预期结果**:
- ✅ 编译无错误
- ✅ 样式渲染正确
- ✅ 参考文献正常显示

**验收标准**:
- [ ] 编译成功
- [ ] PDF 视觉效果改善
- [ ] 参考文献引用正确

---

### 3.7 像素级对比验证测试

**目标**: 验证 LaTeX PDF 与 Word PDF 的相似度

**步骤**:
1. 将两个 PDF 转换为高分辨率 PNG (150 DPI)
2. 计算像素差异比例
3. 分析差异原因

**工具**:
- `pdftoppm`: PDF → PNG 转换
- Python PIL: 像素对比

**验收标准**:
- [ ] PNG 成功生成
- [ ] 像素对比报告生成
- [ ] changed_ratio < 0.20（使用 Word PDF 基准）
- [ ] 差异分析合理（说明换行位置变化等）

---

### 3.8 验证脚本自动化测试

**目标**: 验证 `validate.sh` 和 `benchmark.sh` 脚本功能

**步骤**:
1. 运行 `skills/make_latex_model/scripts/validate.sh`
2. 运行 `skills/make_latex_model/scripts/benchmark.sh`
3. 分析报告输出

**预期结果**:
- ✅ 验证脚本成功执行
- ✅ 自动检测编译状态
- ✅ 样式参数检查完成
- ✅ 性能基准数据生成

**验收标准**:
- [ ] 脚本无错误退出
- [ ] 验证报告完整
- [ ] 性能数据合理

---

## 4. 测试执行计划

### 4.1 测试阶段

| 阶段 | 测试用例 | 预计时间 | 依赖 |
|------|----------|----------|------|
| 阶段 1 | 环境准备 | 5 分钟 | - |
| 阶段 2 | 基础编译测试 | 3 分钟 | 阶段 1 |
| 阶段 3 | 样式分析测试 | 5 分钟 | 阶段 2 |
| 阶段 4 | Word 模板测试 | 10 分钟 | 阶段 1 |
| 阶段 5 | 差异分析测试 | 5 分钟 | 阶段 3, 4 |
| 阶段 6 | 优化执行测试 | 8 分钟 | 阶段 5 |
| 阶段 7 | 验证测试 | 5 分钟 | 阶段 6 |
| 阶段 8 | 像素对比测试 | 7 分钟 | 阶段 7 |
| 阶段 9 | 自动化测试 | 3 分钟 | 阶段 8 |
| **总计** | - | **51 分钟** | - |

### 4.2 测试执行顺序

```
1. 环境准备
   ├─ 创建目录结构
   ├─ 复制测试文件
   └─ 检查依赖工具

2. 基础编译测试
   └─ 验证测试环境可用

3. 样式分析 + Word 模板测试（并行）
   ├─ 分析 @config.tex
   └─ 转换 Word → PDF

4. 差异分析与优化
   ├─ 对比样式差异
   └─ 执行优化修改

5. 验证与报告
   ├─ 编译验证
   ├─ 像素对比
   └─ 生成测试报告
```

---

## 5. 测试数据与基准

### 5.1 参考基准（2026 年 Word 模板）

根据 `config.yaml` 中的样式参考基准：

**页面设置**:
- 上边距: 2.54 cm
- 下边距: 2.54 cm
- 左边距: 3.20 cm
- 右边距: 3.14 cm
- 行距: 1.5 倍

**颜色**:
- MsBlue: RGB 0, 112, 192

**字体**:
- 中文: KaiTi (楷体)
- 英文: Times New Roman

**字号** (pt):
- 四号 (sihao): 14 pt
- 小四 (xiaosihao): 12 pt

**标题样式**:
- 一级标题: 14 pt, 加粗, MsBlue, 缩进 1.45em
- 二级标题: 14 pt, 常规, MsBlue, 缩进 1.45em
- 三级标题: 13.5 pt, 加粗, MsBlue, 编号 1.1, 1.2
- 四级标题: 加粗, 编号 (1), (2)

### 5.2 验收容忍度

根据 `config.yaml` 的验证规则：

| 参数 | 容忍度 | 说明 |
|------|--------|------|
| 字号 | ±0.5 pt | 样式参数一致性 |
| 颜色 RGB | ±2 | 颜色误差容忍度 |
| 间距 | ±0.05 em (约 0.2 pt) | 间距误差容忍度 |
| 边距 | ±0.5 mm | 页面边距误差 |
| 行距 | ±0.1 倍 | 行距误差容忍度 |
| 每行字数 | ±1 字 | 视觉相似度 |
| 换行位置 | ±2 pt | 视觉相似度 |
| 像素差异 | < 0.20 | 像素对比（Word PDF 基准） |

---

## 6. 测试报告模板

### 6.1 报告结构

```markdown
# make_latex_model 技能测试报告

## 测试概要
- **测试实例**: v202601052118
- **测试日期**: 2026-01-05
- **测试项目**: NSFC_Young
- **优化级别**: moderate
- **测试结果**: ✅ 通过 / ❌ 失败

## 测试执行情况
### 测试用例执行统计
- 总用例数: 8
- 通过: X
- 失败: Y
- 跳过: Z

### 详细测试结果
[每个测试用例的执行结果...]

## 样式对比分析
### 参数对比表
| 参数 | Word 基准 | LaTeX 原值 | LaTeX 优化后 | 差异 |
|------|-----------|------------|--------------|------|
| ... | ... | ... | ... | ... |

### 像素对比结果
- changed_ratio: X.XXXX
- 视觉相似度: XX%

## 性能基准
- 编译时间: X 秒
- PDF 大小: X KB
- ...

## 问题与建议
### 发现的问题
1. ...
2. ...

### 改进建议
1. ...
2. ...

## 结论
[总结性评价]
```

---

## 7. 风险与对策

### 7.1 潜在风险

| 风险 | 影响 | 概率 | 对策 |
|------|------|------|------|
| Word 转换 PDF 工具不可用 | 高 | 中 | 使用 LibreOffice 命令行 |
| 字体文件缺失 | 高 | 低 | 测试前检查字体目录 |
| 编译错误 | 高 | 中 | 保留原始配置备份 |
| 像素对比失真 | 中 | 高 | 明确基准来源，降低权重 |
| 测试环境不一致 | 中 | 中 | 使用容器或统一环境 |

### 7.2 备选方案

**Word → PDF 转换备选**:
1. Microsoft Word（首选）
2. LibreOffice（免费替代）
3. 在线转换（仅非敏感内容）

**像素对比备选**:
1. Adobe Acrobat 比较工具
2. 手动叠加 PNG
3. Python PIL 脚本

---

## 8. 成功标准

### 8.1 必须满足（第一优先级）

- ✅ 所有测试用例执行完成
- ✅ 编译无错误和严重警告
- ✅ 修改后的 LaTeX 文档可正常使用

### 8.2 应该满足（第二优先级）

- ✅ 样式参数与 Word 基准一致（在容忍度范围内）
- ✅ 验证脚本正常运行
- ✅ 测试报告完整

### 8.3 期望满足（第三优先级）

- ✅ 像素对比指标 < 0.20（使用 Word PDF 基准）
- ✅ 视觉相似度高
- ✅ 性能基准合理

---

## 9. 附录

### 9.1 参考资料

- [SKILL.md](../SKILL.md) - 技能完整文档
- [config.yaml](../config.yaml) - 技能配置文件
- [NSFC 青年基金模板](../../../projects/NSFC_Young/)

### 9.2 工具版本

- XeLaTeX: 使用系统 TeX Live 或 MacTeX
- Python: 3.8+
- LibreOffice: 7.0+

### 9.3 测试日志

测试过程中的详细日志将保存在 `reports/test.log`

---

**测试计划版本**: 1.0
**最后更新**: 2026-01-05
