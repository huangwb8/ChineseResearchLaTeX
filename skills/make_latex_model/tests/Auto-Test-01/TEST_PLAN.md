# Auto-Test-01 测试计划

## 测试目标

通过自动化测试循环，评估并优化 `make_latex_model` skill 的能力，确保能够准确地将 NSFC_Young 项目对齐到 2026 年 Word 模板。

## 测试策略

### 核心原则

1. **隔离性**: 所有测试在独立的工作空间进行，不修改原始项目文件
2. **可重复性**: 每轮测试前清空工作空间，确保测试环境一致
3. **自动化**: 使用 `auto-test-skill` 进行自动化测试
4. **迭代优化**: 每轮测试后基于结果优化目标 skill

### 测试流程图

```
开始
  ↓
初始化测试环境（第 1 轮）
  ↓
┌─────────────────────────────────────┐
│  第 N 轮测试（N = 1 ~ 10）          │
├─────────────────────────────────────┤
│ 1. 清空工作空间                     │
│ 2. 复制 NSFC_Young 到工作空间       │
│ 3. 生成 Word PDF 基准               │
│ 4. 调用 auto-test-skill 执行测试    │
│ 5. 运行 make_latex_model skill      │
│ 6. 编译 LaTeX 生成 PDF              │
│ 7. 进行验证（4 个优先级）           │
│ 8. 记录测试结果                     │
└─────────────────────────────────────┘
  ↓
是否完全通过？
  ├─ 是 → 结束测试，输出成功报告
  └─ 否 → 分析失败原因
         ↓
       优化 make_latex_model skill
         ↓
       是否超过 10 轮？
         ├─ 是 → 结束测试，输出失败报告
         └─ 否 → N = N + 1，进入下一轮
```

## 验收标准

### 第一优先级：基础编译（必须 100% 通过）

- ✅ 编译无错误
- ✅ 编译无警告
- ✅ 字体加载正常
- ✅ 参考文献样式正确

### 第二优先级：样式参数一致性（至少 80% 通过）

- ✅ 行距与 Word 一致（1.5 倍，误差 < 0.1）
- ✅ 字号与 Word 一致（误差 < 0.5pt）
- ✅ 颜色与 Word 一致（MsBlue RGB 0,112,192，误差 < 2）
- ✅ 页边距一致（误差 < 0.5mm）
- ✅ 标题样式一致（缩进、间距、编号格式）

### 第三优先级：视觉相似度（至少 60% 通过）

- ✅ PDF 与 Word 模板视觉高度相似
- ✅ 每行字数与 Word 接近（允许 ±1 字差异）
- ✅ 换行位置与 Word 大致对齐

### 第四优先级：像素对比（辅助验证）

- ⚠️ 像素对比指标 changed_ratio < 0.20
- ⚠️ 仅当使用 Word 打印 PDF 基准时进行此项检查

## 测试工具

### 1. auto-test-skill

- **作用**: 自动化测试框架
- **输入**: 测试配置、目标 skill
- **输出**: 测试报告、失败分析

### 2. LibreOffice

- **作用**: 将 Word 模板转换为 PDF
- **命令**: `soffice --headless --convert-to pdf`

### 3. XeLaTeX

- **作用**: 编译 LaTeX 生成 PDF
- **命令**: `xelatex -interaction=nonstopmode main.tex`

### 4. 验证脚本

- **作用**: 自动验证各项指标
- **脚本**: `skills/make_latex_model/scripts/validate.sh`

## 测试轮次记录

### 第 1 轮
- **时间**: 待定
- **结果**: 待执行
- **失败项**: 待分析
- **优化措施**: 待规划

### 第 2 轮
- **时间**: 待定
- **结果**: 待执行
- **失败项**: 待分析
- **优化措施**: 待规划

...

## 成功标准

测试在以下情况视为成功：

1. **完全通过**: 所有优先级的检查项全部通过
2. **可接受通过**:
   - 第一优先级 100% 通过
   - 第二优先级 ≥ 80% 通过
   - 第三优先级 ≥ 60% 通过

## 失败标准

测试在以下情况视为失败：

1. **超过轮次限制**: 完成 10 轮测试仍未达到成功标准
2. **第一优先级失败**: 基础编译未通过
3. **无法修复**: 连续 3 轮测试结果无改善

## 输出产物

### 成功情况

1. **测试报告**: `artifacts/output/final-report.md`
2. **优化后的 skill**: 更新 `make_latex_model` skill 文件
3. **测试日志**: `logs/summary.log`

### 失败情况

1. **失败报告**: `artifacts/output/failure-report.md`
2. **问题分析**: 详细列出所有失败的检查项和原因
3. **建议**: 后续优化建议

## 风险与对策

### 风险 1: Word 模板转换不准确

- **对策**: 使用 LibreOffice 命令行转换，确保一致性
- **备选**: 如有条件，使用 Microsoft Word 导出 PDF

### 风险 2: 像素对比指标失真

- **对策**: 降低像素对比权重，以样式参数正确性为准
- **参考**: SKILL.md 中的 Q2 深度解析

### 风险 3: 测试环境差异

- **对策**: 每轮清空工作空间，确保环境一致
- **验证**: 记录环境信息（操作系统、软件版本等）

## 执行命令

```bash
# 进入测试目录
cd /Volumes/2T01/Github/ChineseResearchLaTeX/skills/make_latex_model/tests/Auto-Test-01

# 运行测试（执行 run_test.sh）
./run_test.sh

# 查看实时日志
tail -f logs/summary.log

# 清理测试环境
./clean.sh
```
