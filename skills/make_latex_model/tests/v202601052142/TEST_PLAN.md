# make_latex_model 测试计划 v202601052142

## 测试目的

全面评估 `make_latex_model` 技能将 Word 模板转换为 LaTeX 项目的能力。

## 测试对象

- **技能名称**: make_latex_model
- **技能版本**: 1.3.1
- **测试项目**: NSFC_Young
- **Word模板**: 2026年最新word模板-青年科学基金项目（C类）-正文.doc

## 测试场景

### 场景 1：初始状态评估

**目标**: 评估当前 LaTeX 模板与 Word 模板的差异

**步骤**:
1. 编译原始 LaTeX 项目
2. 提取 Word 模板样式参数
3. 对比分析差异
4. 记录基线数据

**预期输出**:
- 基线 PDF (`output/latex_project/main.pdf`)
- 样式差异报告

### 场景 2：样式优化执行

**目标**: 执行 make_latex_model 技能，优化 LaTeX 样式

**步骤**:
1. 调用技能核心流程
2. 修改 `@config.tex` 样式配置
3. 重新编译验证
4. 迭代优化（最多3轮）

**预期输出**:
- 优化后的样式配置
- 更新后的 PDF
- 变更记录

### 场景 3：结果验证

**目标**: 验证优化结果是否符合预期

**步骤**:
1. 运行自动化验证脚本
2. 进行人工视觉对比
3. 评估样式参数一致性
4. 计算综合评分

**预期输出**:
- 验证报告
- 综合评分
- 通过/失败判定

## 测试用例

### TC001: 编译验证

**优先级**: P0（最高）

**前置条件**:
- LaTeX 项目已准备
- 字体文件已安装

**测试步骤**:
1. 执行 `xelatex main.tex`
2. 执行 `bibtex main`
3. 执行 `xelatex main.tex` 两次

**预期结果**:
- ✓ 编译无错误
- ✓ 编译无致命警告
- ✓ PDF 生成成功

**失败标准**:
- ✗ 编译错误
- ✗ PDF 未生成

### TC002: 页面设置验证

**优先级**: P1（高）

**测试步骤**:
1. 读取 `@config.tex` 中的 `\geometry` 设置
2. 对比 Word 模板的页面设置

**预期结果**:
- ✓ 页面边距误差 < 0.5mm
- ✓ 版心尺寸一致

**失败标准**:
- ✗ 边距误差 ≥ 1mm
- ✗ 版心尺寸明显不同

### TC003: 字体字号验证

**优先级**: P1（高）

**测试步骤**:
1. 检查字体设置（楷体 + Times New Roman）
2. 检查基础字号（12pt）
3. 检查各级标题字号

**预期结果**:
- ✓ 中文字体为楷体
- ✓ 英文字体为 Times New Roman
- ✓ 字号误差 < 0.5pt

**失败标准**:
- ✗ 字体设置错误
- ✗ 字号误差 ≥ 1pt

### TC004: 颜色验证

**优先级**: P1（高）

**测试步骤**:
1. 读取 `@config.tex` 中的颜色定义
2. 验证 MsBlue 颜色值

**预期结果**:
- ✓ MsBlue = RGB(0, 112, 192)
- ✓ RGB 误差 < 2

**失败标准**:
- ✗ 颜色值错误
- ✗ RGB 误差 ≥ 5

### TC005: 行距验证

**优先级**: P1（高）

**测试步骤**:
1. 读取 `\linespread` 设置
2. 对比 Word 模板的行距

**预期结果**:
- ✓ 行距 = 1.5 倍（或 Word 模板指定值）
- ✓ 误差 < 0.1

**失败标准**:
- ✗ 行距设置错误
- ✗ 误差 ≥ 0.2

### TC006: 标题格式验证

**优先级**: P1（高）

**测试步骤**:
1. 检查各级标题的 `\titleformat` 定义
2. 验证编号格式、缩进、间距

**预期结果**:
- ✓ 一级标题：字号15pt，加粗，MsBlue
- ✓ 二级标题：字号14pt，加粗，MsBlue
- ✓ 三级标题：编号格式 1.1、1.2
- ✓ 四级标题：编号格式（1）、（2）

**失败标准**:
- ✗ 标题格式缺失
- ✗ 关键参数错误

### TC007: 视觉相似度验证

**优先级**: P2（中）

**测试步骤**:
1. 并排打开 Word PDF 和 LaTeX PDF
2. 人工对比整体布局
3. 检查每行字数和换行位置

**预期结果**:
- ✓ 整体布局相似
- ✓ 每行字数误差 ≤ 1 字
- ✓ 换行位置基本对齐

**失败标准**:
- ✗ 布局明显不同
- ✗ 每行字数误差 ≥ 3 字

### TC008: 像素对比验证

**优先级**: P3（低，辅助验证）

**前置条件**:
- 已生成 Word PDF 基准
- 已安装 pdftoppm 工具

**测试步骤**:
1. 将 PDF 转换为高分辨率 PNG
2. 进行像素级对比
3. 计算差异率

**预期结果**:
- ✓ changed_ratio < 0.20
- ✓ 关键区域（标题）对齐

**注意**:
- 像素对比仅作为辅助验证
- 换行位置变化会导致像素差异增加
- 应以样式参数正确性为主要验收标准

## 测试数据管理

### 输入数据

- `input/word_template/`: Word 模板文件
- `input/project_backup/`: 项目原始状态备份

### 输出数据

- `output/latex_project/`: 生成的 LaTeX 项目
- `output/artifacts/`: 编译产物（PDF、日志等）
- `output/changes/`: 代码变更记录

### 验证数据

- `validation/compilation_log.txt`: 编译日志
- `validation/style_check.json`: 样式检查结果
- `validation/pixel_diff.json`: 像素对比结果

## 测试执行计划

### 阶段 1：环境准备（10分钟）

- [ ] 检查依赖工具（Python、XeLaTeX、BibTeX）
- [ ] 复制测试材料
- [ ] 生成 Word PDF 基准（如需要）

### 阶段 2：基线测试（15分钟）

- [ ] 编译原始项目
- [ ] 提取样式参数
- [ ] 记录基线数据

### 阶段 3：优化执行（30分钟）

- [ ] 执行 make_latex_model 技能
- [ ] 修改样式配置
- [ ] 编译验证
- [ ] 迭代优化

### 阶段 4：结果验证（20分钟）

- [ ] 运行验证脚本
- [ ] 人工视觉对比
- [ ] 生成测试报告

### 总计：约 75 分钟

## 风险与缓解

### 风险 1：Word 模板格式复杂

**影响**: 高
**概率**: 中
**缓解**:
- 使用 LibreOffice 作为替代方案
- 降低像素对比权重
- 以样式参数正确性为主

### 风险 2：跨平台兼容性问题

**影响**: 中
**概率**: 中
**缓解**:
- 在多个平台上测试
- 使用条件判断处理平台差异
- 保留 `\ifwindows` 等结构

### 风险 3：字体渲染差异

**影响**: 中
**概率**: 高
**缓解**:
- 承认字体渲染差异的必然性
- 以参数一致性为主，像素对比为辅
- 人工验证作为最终判断

## 测试通过标准

### 必须满足（P0）

- ✓ 编译无错误
- ✓ PDF 生成成功

### 推荐满足（P1）

- ✓ 80% 以上样式参数检查通过
- ✓ 关键样式（页面、字体、颜色、行距）正确

### 优秀（P2）

- ✓ 视觉相似度评分 ≥ 70%
- ✓ 每行字数误差 ≤ 1 字

### 可选（P3）

- ✓ 像素对比指标 < 20%
- ✓ 关键区域对齐

## 测试报告内容

1. **测试概述**
   - 测试目的、对象、场景

2. **测试环境**
   - 硬件配置
   - 软件版本
   - 依赖工具

3. **测试执行**
   - 执行时间
   - 执行步骤
   - 遇到的问题

4. **测试结果**
   - 各测试用例结果
   - 综合评分
   - 通过/失败判定

5. **分析总结**
   - 成功经验
   - 失败原因
   - 改进建议

6. **附录**
   - 编译日志
   - 样式检查结果
   - 像素对比结果
   - 代码变更记录

## 参考文档

- [技能定义](../SKILL.md)
- [测试实例 README](./README.md)
- [预期结果定义](./expected/README.md)
- [验证脚本说明](../scripts/README.md)
