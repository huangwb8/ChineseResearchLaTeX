# ================================
# make_latex_model 技能默认配置文件
# ================================
#
# 这是技能级别的默认配置，会被模板配置覆盖
# 模板配置位于 templates/ 目录下
#
# 配置优先级（从低到高）:
# 1. 技能默认配置 (config.yaml) - 本文件
# 2. 模板基础配置 (templates/{template}/{template}.yaml)
# 3. 项目本地配置 (projects/{project}/.template.yaml)
#
# ================================

skill_info:
  name: make_latex_model
  version: 2.0.0
  description: LaTeX 模板高保真优化器（通用化版本，支持任意 LaTeX 模板）
  category: normal

# ================================
# 输入参数定义
# ================================
parameters:
  project:
    type: string
    required: true
    description: 项目名称或路径（如 NSFC_Young 或 projects/NSFC_Young）
    default: null

  template:
    type: string
    required: false
    description: 模板名称（如 nsfc/young，留空则自动检测）
    default: null

  word_template_year:
    type: string
    required: false
    description: Word 模板年份（仅用于参考，不影响配置加载）
    pattern: "^\\d{4}$"
    default: "2026"

  optimization_level:
    type: string
    required: false
    description: 优化级别
    allowed_values:
      - minimal      # 最小改动：仅修复明显错误
      - moderate     # 中等优化：调整不一致的样式（默认）
      - thorough     # 彻底重构：最大保真度
    default: moderate

  dry_run:
    type: boolean
    required: false
    description: 预览模式，不实际修改文件
    default: false

# ================================
# 优化策略配置
# ================================
optimization_strategies:
  minimal:
    description: "最小改动：仅修复明显错误"
    actions:
      - fix_color_values
      - fix_critical_font_sizes
      - fix_page_margins

  moderate:
    description: "中等优化：调整不一致的样式（默认）"
    actions:
      - fix_color_values
      - fix_font_sizes
      - fix_page_margins
      - adjust_spacing
      - align_numbering_format
      - align_heading_texts

  thorough:
    description: "彻底重构：最大保真度"
    actions:
      - complete_style_overhaul
      - refactor_title_formatting
      - optimize_list_styles
      - cross_platform_validation
      - align_heading_texts

# ================================
# 编译配置
# ================================
compile_config:
  engine: xelatex
  interaction_mode: nonstopmode
  max_runs: 4
  sequence:
    - xelatex
    - bibtex
    - xelatex
    - xelatex

# ================================
# 验证规则（按优先级分层）
# ================================
validation:
  max_iterations: 3
  required_checks:
    # 第一优先级：基础编译
    - compilation_success
    - no_warnings
    - cross_platform_compatibility

    # 第二优先级：样式参数一致性
    - style_parameter_consistency
    - heading_text_consistency

    # 第三优先级：视觉相似度
    - visual_similarity

    # 第四优先级：像素对比（仅当使用 Word 打印 PDF 基准时）
    - pixel_comparison

  tolerance:
    # 样式参数容忍度（第二优先级）
    font_size_diff: 0.5      # 字号误差容忍度（pt）
    color_diff: 2            # 颜色误差容忍度（RGB）
    spacing_diff: 0.05       # 间距误差容忍度（em）
    margin_diff: 0.5         # 边距误差容忍度（mm）
    line_height_diff: 0.1    # 行距误差容忍度（倍数）

    # 视觉相似度容忍度（第三优先级）
    chars_per_line_diff: 1   # 每行字数误差容忍度（字）
    line_position_diff: 2    # 换行位置误差容忍度（pt）

    # 像素对比容忍度（第四优先级）
    pixel_changed_ratio: 0.20  # 像素差异比例容忍度

  # 验收优先级说明
  acceptance_priority:
    level_1: # 第一优先级：必须满足
      - compilation_success
      - no_warnings
      - cross_platform_compatibility

    level_2: # 第二优先级：高优先级
      - style_parameter_consistency
      - heading_text_consistency

    level_3: # 第三优先级：中优先级
      - visual_similarity

    level_4: # 第四优先级：低优先级（辅助验证）
      - pixel_comparison

# ================================
# 输出配置
# ================================
output:
  format: markdown
  language: zh-CN
  include_diff: true
  include_validation_report: true
  backup_before_modification: false   # 不备份（依赖 Git）

# ================================
# 兼容性配置
# ================================
compatibility:
  preserve_old_commands: true
  preserve_if_conditions: true
  support_os:
    - windows
    - macos
    - linux
