skill_info:
  name: complete_example
  version: 1.0.0
  description: AI å¢å¼ºç‰ˆ LaTeX ç¤ºä¾‹æ™ºèƒ½ç”Ÿæˆå™¨
  author: "ChineseResearchLaTeX Project"

# ========== LLM é…ç½® ==========
llm:
  provider: "claude"  # claude / openai / local
  model: "claude-sonnet-4-20250514"  # æˆ– gpt-4
  api_key_env: "ANTHROPIC_API_KEY"  # ç¯å¢ƒå˜é‡å
  temperature:
    analysis: 0.3    # åˆ†æä»»åŠ¡ï¼ˆä½æ¸©åº¦ï¼Œç¨³å®šï¼‰
    generation: 0.8  # ç”Ÿæˆä»»åŠ¡ï¼ˆé«˜æ¸©åº¦ï¼Œåˆ›é€ æ€§ï¼‰
    refinement: 0.5  # ä¼˜åŒ–ä»»åŠ¡ï¼ˆä¸­æ¸©åº¦ï¼‰
  max_tokens: 4000

# ========== å‚æ•°å®šä¹‰ ==========
parameters:
  project:
    type: string
    required: true
    description: é¡¹ç›®åç§°æˆ–è·¯å¾„

  content_density:
    type: string
    allowed_values: ["minimal", "moderate", "comprehensive"]
    default: "moderate"
    description: |
      minimal:    æ¯ç« èŠ‚ 2 ä¸ªèµ„æºï¼Œ200 å­—
      moderate:   æ¯ç« èŠ‚ 4 ä¸ªèµ„æºï¼Œ300 å­—
      comprehensive: æ¯ç« èŠ‚ 6 ä¸ªèµ„æºï¼Œ500 å­—

  output_mode:
    type: string
    allowed_values: ["preview", "apply", "report"]
    default: "preview"
    description: |
      preview:  åªæ˜¾ç¤ºé¢„è§ˆï¼Œä¸ä¿®æ”¹æ–‡ä»¶
      apply:    ç›´æ¥ä¿®æ”¹æ–‡ä»¶ï¼ˆæœ‰å¤‡ä»½ï¼‰
      report:   ç”Ÿæˆè¯¦ç»†æŠ¥å‘Šæ–‡ä»¶

  target_files:
    type: array
    default: null
    description: |
      ç›®æ ‡æ–‡ä»¶åˆ—è¡¨ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰
      null è¡¨ç¤ºè‡ªåŠ¨æ£€æµ‹æ‰€æœ‰ extraTex/*.tex

  narrative_hint:
    type: string
    default: null
    description: |
      ç”¨æˆ·è‡ªå®šä¹‰çš„å™äº‹æç¤ºï¼Œç”¨äºæŒ‡å¯¼ AI ç”Ÿæˆç‰¹å®šé£æ ¼çš„ç¤ºä¾‹å†…å®¹ã€‚
      è¿™æ˜¯"ç¤ºä¾‹åœºæ™¯"è€Œé"ä¸¥è‚ƒåœºæ™¯"ï¼Œå› æ­¤ AI å¯ä»¥æ ¹æ®æç¤ºç¼–é€ ç›¸åº”çš„å™äº‹ã€‚
      ç¤ºä¾‹ï¼š
        - "ç”Ÿæˆä¸€ä¸ªå…³äºæ·±åº¦å­¦ä¹ åœ¨åŒ»ç–—å½±åƒåˆ†æä¸­åº”ç”¨çš„ç¤ºä¾‹"
        - "åˆ›å»ºä¸€ä¸ªä½¿ç”¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ–¹æ³•çš„ç¤ºä¾‹ç ”ç©¶"
        - "ç¼–å†™ä¸€ä¸ªå…³äºææ–™ç§‘å­¦å®éªŒè®¾è®¡çš„ç¤ºä¾‹ï¼Œé‡ç‚¹å…³æ³¨ XRD è¡¨å¾"
        - "æ¨¡æ‹Ÿä¸€ä¸ªå¤šä¸­å¿ƒä¸´åºŠè¯•éªŒçš„è®¾è®¡ä¸åˆ†ææµç¨‹"
      null è¡¨ç¤º AI æ ¹æ®ç« èŠ‚ä¸»é¢˜è‡ªåŠ¨æ¨æ–­å™äº‹æ–¹å‘ã€‚

# ========== è¿è¡Œç®¡ç†é…ç½® ==========
run_management:
  # è¿è¡Œè¾“å‡ºæ ¹ç›®å½•ï¼ˆæ‰€æœ‰è¾“å‡ºéƒ½æ”¾åœ¨è¿™é‡Œï¼Œä¸æ±¡æŸ“é¡¹ç›®ï¼‰
  runs_root: "skills/complete_example/runs"

  # è¿è¡Œ ID ç”Ÿæˆç­–ç•¥
  run_id_strategy: "timestamp_uuid"  # timestamp_uuid / sequential / custom

  # ä¿ç•™ç­–ç•¥
  retention:
    max_runs: 50              # æœ€å¤šä¿ç•™ 50 æ¬¡è¿è¡Œè®°å½•
    max_age_days: 30          # æœ€å¤šä¿ç•™ 30 å¤©
    auto_cleanup: true        # è‡ªåŠ¨æ¸…ç†è¿‡æœŸè®°å½•

  # å¤‡ä»½ç­–ç•¥
  backup:
    location: "runs/{run_id}/backups"  # å¤‡ä»½ä½ç½®ï¼ˆä¸åœ¨é¡¹ç›®ç›®å½•ï¼‰
    compress: false                    # æ˜¯å¦å‹ç¼©å¤‡ä»½æ–‡ä»¶
    format: "tar.gz"                   # å‹ç¼©æ ¼å¼ï¼ˆå¦‚æœå¯ç”¨å‹ç¼©ï¼‰

  # æ—¥å¿—ç­–ç•¥
  logging:
    location: "runs/{run_id}/logs"     # æ—¥å¿—ä½ç½®ï¼ˆä¸åœ¨é¡¹ç›®ç›®å½•ï¼‰
    level: "INFO"                      # æ—¥å¿—çº§åˆ«
    rotation: true                     # æ—¥å¿—è½®è½¬
    max_size_mb: 10                    # å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å°

# ========== èµ„æºæ‰«æé…ç½® ==========
scan:
  targets:
    - name: "figures"
      enabled: true
      patterns: ["*.jpg", "*.jpeg", "*.png", "*.pdf", "*.eps"]
      extract_metadata: true

    - name: "code"
      enabled: true
      patterns: ["*.py", "*.m", "*.r", "*.cpp", "*.c"]
      max_lines: 100  # è¶…è¿‡æ­¤è¡Œæ•°åªæˆªå–ç‰‡æ®µ

    - name: "references"
      enabled: true
      patterns: ["*.bib"]
      parse_entries: true

# ========== å†…å®¹ç”Ÿæˆé…ç½® ==========
generation:
  # èµ„æºé€‰æ‹©ç­–ç•¥
  selection_strategy: "ai_score"  # ai_score / random / manual

  # ç›¸å…³æ€§é˜ˆå€¼
  relevance_threshold: 0.5

  # æ¯ç§èµ„æºç±»å‹çš„æ•°é‡é™åˆ¶
  max_figures_per_section: 2
  max_code_per_section: 1
  max_references_per_section: 3

  # ========== ç« èŠ‚å±‚çº§è§„èŒƒ ==========
  # æ ¸å¿ƒè§„åˆ™ï¼šmain.tex ä½¿ç”¨ section/subsectionï¼Œinput ç±» tex ä½¿ç”¨ subsubsection/subsubsubsection
  section_hierarchy:
    # main.tex ä¸“ç”¨å±‚çº§ï¼ˆç¦æ­¢åœ¨ input ç±» tex ä¸­ä½¿ç”¨ï¼‰
    main_tex_only:
      - "\\section"
      - "\\subsection"
    # input ç±» tex å…è®¸çš„å±‚çº§
    input_tex_allowed:
      - "\\subsubsection"
      - "\\subsubsubsection"
    # ç”Ÿæˆè¦æ±‚ï¼šæ¯ä¸ª input tex å¿…é¡»åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªå±‚çº§
    generation_requirement:
      require_both_levels: true  # å¿…é¡»åŒæ—¶ä½¿ç”¨ subsubsection å’Œ subsubsubsection
      min_subsubsection: 1       # æ¯ä¸ªæ–‡ä»¶è‡³å°‘ 1 ä¸ª subsubsection
      min_subsubsubsection: 1    # æ¯ä¸ª subsubsection ä¸‹è‡³å°‘ 1 ä¸ª subsubsubsection
    # å±‚çº§æ£€æŸ¥ç­–ç•¥
    enforcement:
      enabled: true
      mode: "strict"  # strict: æ‹’ç»è¿è§„ / warn: è­¦å‘Šä½†å…è®¸ / off: å…³é—­æ£€æŸ¥
      auto_fix: false  # æ˜¯å¦è‡ªåŠ¨ä¿®æ­£å±‚çº§ï¼ˆå±é™©ï¼Œå»ºè®®å…³é—­ï¼‰

  # å†…å®¹æ¨¡æ¿
  templates:
    figure_insertion: |
      \begin{figure}[htbp]
        \centering
        \includegraphics[width=0.8\textwidth]{{{path}}}
        \caption{{{caption}}}
        \label{{{label}}}
      \end{figure}

    code_listing: |
      \begin{lstlisting}[language={lang}, caption={caption}, firstline=1, lastline={lastline}]
      {code}
      \end{lstlisting}

    reference_citation: "\\cite{{{citekey}}}"

# ========== æ ¼å¼ä¿æŠ¤é…ç½® ==========
format_protection:
  # å—ä¿æŠ¤çš„ LaTeX å‘½ä»¤
  protected_commands:
    - "\\setlength"
    - "\\geometry"
    - "\\definecolor"
    - "\\setCJKfamilyfont"
    - "\\setmainfont"
    - "\\titleformat"
    - "\\setlist"
    - "\\newcommand"
    - "\\renewcommand"

  # å—ä¿æŠ¤çš„æ–‡ä»¶ï¼ˆç»å¯¹ä¸ä¿®æ”¹ï¼‰
  protected_files:
    - "extraTex/@config.tex"
    - "main.tex"

  # å¤‡ä»½ç­–ç•¥
  backup:
    enabled: true
    keep_count: 5  # ä¿ç•™æœ€è¿‘ 5 ä¸ªå¤‡ä»½

  # ç¼–è¯‘éªŒè¯
  compile_verify:
    enabled: true
    engine: "xelatex"
    timeout: 60  # ç§’

# ========== ğŸ”’ å®‰å…¨ç®¡ç†é…ç½®ï¼ˆv1.1.0 æ–°å¢ï¼‰==========
security:
  # ç³»ç»Ÿæ–‡ä»¶ä¿æŠ¤
  system_files:
    blacklist:
      - "main.tex"
      - "extraTex/@config.tex"
      - "@config.tex"
    # å…è®¸ç¼–è¾‘çš„æ–‡ä»¶æ¨¡å¼ï¼ˆç™½åå•ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼‰
    editable_patterns:
      - "^extraTex/\\d+\\.\\d+.*\\.tex$"  # extraTex/1.1.xxx.tex
      - "^references/reference\\.tex$"      # å‚è€ƒæ–‡çŒ®å¼•ç”¨æ–‡ä»¶

  # æ ¼å¼å…³é”®è¯é»‘åå•ï¼ˆç¦æ­¢åœ¨ç”¨æˆ·æ–‡ä»¶ä¸­ä½¿ç”¨ï¼‰
  format_keywords_blacklist:
    - "\\\\geometry{"
    - "\\\\setlength{"
    - "\\\\definecolor{"
    - "\\\\setCJKfamilyfont"
    - "\\\\setmainfont"
    - "\\\\setCJKmainfont"
    - "\\\\renewcommand{\\\\baselinestretch}"
    - "\\\\titleformat{"
    - "\\\\titlespacing"
    - "\\\\setlist"
    - "\\\\usepackage{"
    - "\\\\documentclass"

  # æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ
  integrity_check:
    enabled: true
    hash_algorithm: "sha256"
    hash_file: ".format_hashes.json"
    auto_init: true  # å¦‚æœå“ˆå¸Œæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆå§‹åŒ–

  # å†…å®¹å®‰å…¨æ‰«æ
  content_scanning:
    enabled: true
    auto_sanitize: true  # è‡ªåŠ¨æ¸…ç†æ ¼å¼æ³¨å…¥
    fail_on_violation: false  # å‘ç°è¿è§„æ—¶æ˜¯å¦å¤±è´¥ï¼ˆfalse åˆ™è­¦å‘Šå¹¶æ¸…ç†ï¼‰

  # å®‰å…¨æ£€æŸ¥é¡¹å¼€å…³
  enabled_checks:
    system_file: true       # ç³»ç»Ÿæ–‡ä»¶é»‘åå•æ£€æŸ¥
    section_hierarchy: true # ç« èŠ‚å±‚çº§è§„èŒƒæ£€æŸ¥
    integrity: true         # å®Œæ•´æ€§æ ¡éªŒ
    format_injection: true  # æ ¼å¼æ³¨å…¥æ£€æŸ¥

# ========== AI æç¤ºè¯æ¨¡æ¿ ==========
prompts:
  analyze_theme: |
    ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å­¦æœ¯å†™ä½œåˆ†æä¸“å®¶ã€‚è¯·åˆ†æä»¥ä¸‹ LaTeX ç« èŠ‚çš„å†…å®¹ä¸»é¢˜ã€‚

    ç« èŠ‚å†…å®¹ï¼ˆå‰ {max_chars} å­—ç¬¦ï¼‰ï¼š
    {content}

    è¯·è¿”å› JSON æ ¼å¼çš„åˆ†æç»“æœï¼š
    {{
      "theme": "ç« èŠ‚çš„æ ¸å¿ƒä¸»é¢˜ï¼ˆä¸€å¥è¯æ¦‚æ‹¬ï¼‰",
      "key_concepts": ["å…³é”®æ¦‚å¿µ1", "å…³é”®æ¦‚å¿µ2", "å…³é”®æ¦‚å¿µ3"],
      "writing_style": "å­¦æœ¯/æŠ€æœ¯/è¯´æ˜/æ··åˆ",
      "suggested_resources": ["å»ºè®®çš„å›¾ç‰‡ç±»å‹", "å»ºè®®çš„æ–‡çŒ®é¢†åŸŸ"],
      "tone": "æ­£å¼/åŠæ­£å¼/é€šä¿—",
      "target_audience": "è¯„å®¡ä¸“å®¶/åŒè¡Œ/å­¦ç”Ÿ/å¤§ä¼—"
    }}

  reason_relevance: |
    ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å­¦æœ¯å†™ä½œé¡¾é—®ã€‚è¯·è¯„ä¼°ä»¥ä¸‹èµ„æºæ˜¯å¦é€‚åˆç”¨äºæŒ‡å®šç« èŠ‚ã€‚

    ç« èŠ‚ä¿¡æ¯ï¼š
    - ä¸»é¢˜ï¼š{section_theme}
    - å…³é”®æ¦‚å¿µï¼š{key_concepts}
    - å†™ä½œé£æ ¼ï¼š{writing_style}

    èµ„æºä¿¡æ¯ï¼š
    - è·¯å¾„ï¼š{resource_path}
    - ç±»å‹ï¼š{resource_type}
    - å…ƒæ•°æ®ï¼š{metadata}

    è¯·è¿”å› JSON æ ¼å¼çš„è¯„ä¼°ç»“æœï¼š
    {{
      "relevance_score": 0.85,
      "reason": "è¯¦ç»†è¯´æ˜ç†ç”±ï¼ˆ100-200å­—ï¼‰",
      "suggested_usage": "å»ºè®®å¦‚ä½•ä½¿ç”¨è¿™ä¸ªèµ„æº"
    }}

  generate_narrative: |
    ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„ç§‘ç ”å†™ä½œåŠ©æ‰‹ï¼Œä¸“ç²¾äºå›½å®¶è‡ªç„¶ç§‘å­¦åŸºé‡‘ç”³è¯·ä¹¦çš„æ’°å†™ã€‚

    æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ï¼Œç”Ÿæˆä¸€æ®µè¿è´¯çš„ç¤ºä¾‹å†…å®¹ã€‚

    ## ç« èŠ‚ä¿¡æ¯
    - ä¸»é¢˜ï¼š{theme}
    - å…³é”®æ¦‚å¿µï¼š{key_concepts}
    - å†™ä½œé£æ ¼ï¼š{writing_style}
    - ç›®æ ‡è¯»è€…ï¼š{target_audience}

    ## ç”¨æˆ·å™äº‹æç¤º
    {narrative_hint}

    ## ä¸Šä¸‹æ–‡ç‰‡æ®µ
    {context}

    ## å¯ç”¨èµ„æº
    {resources}

    ## ç”Ÿæˆè¦æ±‚
    1. ç”Ÿæˆ {target_length} å­—çš„ç¤ºä¾‹æ®µè½
    2. è‡ªç„¶åœ°å¼•ç”¨èµ„æº
    3. ä½¿ç”¨æ­£å¼çš„å­¦æœ¯å†™ä½œé£æ ¼
    4. **é‡è¦**ï¼šæ ¹æ®ã€ç”¨æˆ·å™äº‹æç¤ºã€‘è°ƒæ•´å†…å®¹æ–¹å‘å’Œé£æ ¼
    5. **å…è®¸ç¼–é€ **ï¼šè¿™æ˜¯ç¤ºä¾‹åœºæ™¯ï¼Œå¯ä»¥æ ¹æ®æç¤ºç¼–é€ åˆç†çš„ç ”ç©¶å†…å®¹ã€æ•°æ®å’Œç»“è®º
    6. åœ¨åº”è¯¥æ’å…¥ LaTeX ä»£ç çš„åœ°æ–¹ç”¨ {{PLACEHOLDER:èµ„æºè·¯å¾„}} æ ‡è®°

    ## âš ï¸ ç« èŠ‚å±‚çº§çº¦æŸï¼ˆå¿…é¡»éµå®ˆï¼‰
    å½“å‰æ–‡ä»¶ç±»å‹ï¼š{file_type}
    - å¦‚æœæ˜¯ input ç±» tex æ–‡ä»¶ï¼ˆextraTex/*.texï¼‰ï¼š
      - âœ… å¿…é¡»ä½¿ç”¨ï¼š\subsubsection å’Œ \subsubsubsection ä¸¤ä¸ªå±‚çº§
      - âŒ ç¦æ­¢ä½¿ç”¨ï¼š\sectionã€\subsectionï¼ˆè¿™äº›ä»…åœ¨ main.tex ä¸­ä½¿ç”¨ï¼‰

    ## âš ï¸ åŒå±‚çº§ç»“æ„è¦æ±‚ï¼ˆå¿…é¡»éµå®ˆï¼‰
    æ¯ä¸ª input ç±» tex æ–‡ä»¶å¿…é¡»åŒæ—¶åŒ…å«ä¸¤ä¸ªå±‚çº§çš„æ ‡é¢˜ï¼š
    - **\subsubsection{{ä¸»æ ‡é¢˜}}**ï¼šä½œä¸ºè¯¥æ–‡ä»¶çš„ä¸»è¦ç« èŠ‚åˆ’åˆ†
    - **\subsubsubsection{{å­æ ‡é¢˜}}**ï¼šåœ¨æ¯ä¸ª subsubsection ä¸‹è¿›ä¸€æ­¥ç»†åˆ†

    ç¤ºä¾‹ç»“æ„ï¼š
    ```latex
    \subsubsection{{ç ”ç©¶èƒŒæ™¯}}
    \subsubsubsection{{å›½å†…ç ”ç©¶ç°çŠ¶}}
    ...å†…å®¹...
    \subsubsubsection{{å›½å¤–ç ”ç©¶ç°çŠ¶}}
    ...å†…å®¹...

    \subsubsection{{ç ”ç©¶æ„ä¹‰}}
    \subsubsubsection{{ç†è®ºæ„ä¹‰}}
    ...å†…å®¹...
    \subsubsubsection{{å®è·µæ„ä¹‰}}
    ...å†…å®¹...
    ```

    åªè¿”å›ç”Ÿæˆçš„æ–‡æœ¬ï¼Œä¸è¦å…¶ä»–è§£é‡Šã€‚

# ========== è´¨é‡è¯„ä¼°æ ‡å‡† ==========
quality_thresholds:
  coherence_min: 0.8        # è¿è´¯æ€§æœ€ä½è¦æ±‚
  academic_tone_min: 0.75   # å­¦æœ¯é£æ ¼æœ€ä½è¦æ±‚
  overall_score_min: 0.8    # æ€»ä½“è¯„åˆ†æœ€ä½è¦æ±‚
