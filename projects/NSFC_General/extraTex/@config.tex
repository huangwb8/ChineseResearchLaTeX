\usepackage[english]{babel} %支持混合语言
\usepackage{xcolor}
\usepackage{graphicx} 
\usepackage{amsmath} %更多数学符号
\usepackage{bm} % 粗体数学符号（\bm 命令）
\usepackage{wasysym}
\usepackage{geometry} %改尺寸
\usepackage{fontspec} %字体包
\usepackage{setspace}
\usepackage{amsfonts} % 数学公式增强
\usepackage{xeCJK} % 调整字间距
\usepackage{titlesec} 
\usepackage{ragged2e} % 正文两端对齐所需的包。在需要两端对齐的文字前面添加\justifying即可。
\usepackage{indentfirst} % 中文写作通常要求标题后的首段也缩进
% \usepackage{ctex}
\usepackage{pifont} % 带圈数字
\usepackage{etoolbox} % 轻量补丁工具（用于可选参考文献逻辑）

% 操作系统检测（避免 ifplatform 在未开启 shell escape 时产生警告）
\newif\ifwindows
\IfFileExists{/dev/null}{\windowsfalse}{\windowstrue}

%%%————————————————————————————————边距
% \CJKsetecglue命令定义了CJK字符与其他字符之间的空白，不只限于数字字符，也适用于字母等其他非CJK字符。如果你想要更精细的控制，可能需要借助其它工具或者宏包。
% \hskip0.15em plus0.05em minus 0.05em表示基础间距为0.15em，可增加至0.2em，也可减少至0.1em以便满足排版需求。
% 页边距和字距的某个组合应该可以完美复制Word。
\geometry{left=3.00cm,right=2.75cm,top=2.63cm,bottom=2.96cm} % 页边距（对齐 2026 Word 模板 v2 PDF）
\CJKsetecglue{\hskip 0.15em plus 0.05em minus 0.05em} % 数字与CJK字符的间距（对齐 2026 Word 模板）
% left=3.20cm,right=3.13-3.14cm



%%%————————————————————————————————颜色
% 说明：在 XeLaTeX + xcolor 组合下，RGB(0,112,192) 在 PDF 中可能被量化为 (0,111,192)；
% 为了让最终 PDF 提取/显示为 Word 的 MsBlue：RGB(0,112,192)，这里将 G 分量 +1。
\definecolor{MsBlue}{RGB}{0,113,192} % 目标：PDF 输出等效 RGB(0,112,192)
\definecolor{headercolor}{RGB}{0,0,0} % 页眉颜色
\definecolor{footercolor}{RGB}{0,0,0} % 页脚颜色

%%%————————————————————————————————对象名
\addto\captionsenglish{
    \renewcommand{\contentsname}{目录}
    \renewcommand{\listfigurename}{插图目录}
    \renewcommand{\listtablename}{表格}
    \renewcommand{\refname}{\sihao \templatefont \bfseries \leftline{参考文献}} % 参考文献标题（与 Local/Young 保持一致）
    \renewcommand{\abstractname}{摘要}
    \renewcommand{\indexname}{索引}
    \renewcommand{\tablename}{表}
    \renewcommand{\figurename}{图}
} %把Figure改成‘图’，reference改成‘参考文献’。如此处理是为了避免和babel包冲突。


%%%————————————————————————————————字号
\newcommand{\chuhao}{\fontsize{42pt}{\baselineskip}\selectfont}
\newcommand{\xiaochuhao}{\fontsize{36pt}{\baselineskip}\selectfont}
\newcommand{\yihao}{\fontsize{26pt}{\baselineskip}\selectfont}
\newcommand{\erhao}{\fontsize{22pt}{\baselineskip}\selectfont}
\newcommand{\xiaoerhao}{\fontsize{18pt}{\baselineskip}\selectfont}
\newcommand{\sanhao}{\fontsize{16pt}{22pt}\selectfont}
\newcommand{\sihao}{\fontsize{14pt}{22pt}\selectfont}
\newcommand{\xiaosihao}{\fontsize{12pt}{22pt}\selectfont}
\newcommand{\yemeizihao}{\fontsize{11pt}{\baselineskip}\selectfont}
\newcommand{\wuhao}{\fontsize{10.5pt}{\baselineskip}\selectfont}
\newcommand{\xiaowuhao}{\fontsize{9pt}{\baselineskip}\selectfont}
\newcommand{\liuhao}{\fontsize{7.875pt}{\baselineskip}\selectfont}
\newcommand{\qihao}{\fontsize{5.25pt}{\baselineskip}\selectfont}
%字号对照表
%二号 21pt
%四号 14
%小四 12
%五号 10.5


%%%————————————————————————————————字体
\ifwindows
  % 可参考[LaTeX 中文字体配置基础指南 - 知乎](https://zhuanlan.zhihu.com/p/538459335) 选择自己喜欢的字体。 个人感觉中宋（SimSun）还可以 (～￣▽￣)～ 
  \setCJKfamilyfont{sectionzhfont}{KaiTi}[AutoFakeBold=3] % 定义模板中文字体为楷体
  \newcommand{\sectionzhfont}{\CJKfamily{sectionzhfont}} % 定义模板中文字体为新命令\sectionzhfont
  \newfontfamily\sectionenfont{KaiTi}[AutoFakeBold] % 定义模板中英文字体为楷体，并定义新命令\sectionzhfont
  \NewDocumentCommand \templatefont { } {\sectionzhfont \sectionenfont} % 模板中英文字体
  \setmainfont{Times New Roman} % 定义主体内容的英文字体为Times New Roman
  \setCJKmainfont{KaiTi}[AutoFakeBold=3]  % 定义主体内容的字体为Kaiti
  \setCJKmonofont{KaiTi}[AutoFakeBold=3]  % 定义 CJK 等宽字体（避免 xeCJK tt 字体警告）
  % \setCJKmainfont{SimSun}[AutoFakeBold=3]  % 定义主体内容的字体为SimSun
  \xeCJKsetup{PunctStyle=quanjiao} % 强制中文标点符号使用中文字体
\else
  % 使用仓库内置字体，避免不同系统的字体名差异影响可复现性
  \setCJKfamilyfont{sectionzhfont}[Path=./fonts/, Extension=.ttf, AutoFakeBold=3]{Kaiti} % 定义模板中文字体为楷体
  \newcommand{\sectionzhfont}{\CJKfamily{sectionzhfont}} % 定义模板中文字体为新命令\sectionzhfont
  \newfontfamily\sectionenfont[Path=./fonts/, Extension=.ttf, AutoFakeBold=3]{Kaiti} % 定义模板中英文字体为楷体，并定义新命令\sectionzhfont
  \NewDocumentCommand \templatefont {} {\sectionzhfont \sectionenfont} % 模板中英文字体
  \setCJKmainfont[Path=./fonts/, Extension=.ttf, AutoFakeBold=3]{Kaiti} % 定义主体内容的字体为Kaiti
  \setCJKmonofont[Path=./fonts/, Extension=.ttf, AutoFakeBold=3]{Kaiti}
  % \setmainfont[Path=./fonts/, Extension=.ttf]{TimesNewRoman} % 定义主体内容的英文字体为Times New Roman。由于是外挂字体，无法自由使用英文斜体和粗体。
  \setmainfont[BoldFont=Times New Roman, AutoFakeBold=5]{Times New Roman} %使用MacOS自带的Times New Roman，可以自由使用英文斜体和粗体。
  % \setCJKmainfont[Path=./fonts/, Extension=.ttf, AutoFakeBold=3]{SimSun} % 定义主体内容的字体为SimSun
  \xeCJKsetup{PunctStyle=quanjiao} % 强制中文标点符号使用中文字体
\fi


%%%————————————————————————————————行距
% Word 2026 模板使用固定行距：22 pt（“固定值 22 磅”）
\renewcommand{\baselinestretch}{1.0}
\AtBeginDocument{\fontsize{12pt}{22pt}\selectfont}
\setlength{\parindent}{0pt} % 保持模板：main.tex 中已有必要的手工缩进控制
\setlength{\parskip}{7.8pt} % Word 模板“段后 7.8pt”
\XeTeXlinebreaklocale "zh" % 中文断行

% Word 空白段落的“视觉高度”对齐：在已有 \parskip 的情况下补足到 1 行行距
\newcommand{\NSFCBlankPara}{\vspace*{\dimexpr\baselineskip-\parskip\relax}}

% 正文段首缩进：仅在 extraTex 正文中启用，避免与 main.tex 的提示语缩进叠加
\newcommand{\NSFCBodyText}{%
  \setlength{\parindent}{2em}%
  % 正文段间距：用户常希望“段间距和行间距一样紧凑”，因此在正文区块内关闭段后距
  % （不影响 main.tex 提示语区域的 Word 风格段后距设置）。
  \setlength{\parskip}{0pt}%
}


%%%————————————————————————————————图片与表格

% 对于表格，推荐使用Excel的插件Excel2LaTeX自动生成LaTeX代码。详见： https://www.zhihu.com/question/307970489/answer/2305355098

%图片
\usepackage{graphicx} %插图宏包
\usepackage{float} %设置图片浮动位置的宏包
\usepackage{subfigure} %插入多图时用子图显示的宏包
\usepackage[section]{placeins} %避免浮动体跨过\section
\usepackage{enumerate} %设置列表环境的包
\usepackage{enumitem} % 增强自定义Bullet（即各种List前的那个标记）
\setlist[enumerate]{
  label={\templatefont \bfseries \hspace{1em} \color{MsBlue}（\arabic*）},
  leftmargin=0em, % 列表的左边界
  itemindent=4em, % item首行缩进
  itemsep=0em, % 列表项之间的垂直间距。
  labelsep=0.1pt,  % label与content的距离
  parsep=0em,  % 两个段落之间的垂直间距。效果上与itemsep类似。
  topsep=0em % 列表与上一段对象的垂直间距。
  % after=\vspace{5pt}
}
% \newcommand{\itemtitlefont}[1]{\textbf{\color{MsBlue} #1}} % 定义item小标题字体；
\newcommand{\itemtitlefont}[1]{{\bfseries \color{MsBlue} #1}} % 定义item小标题字体；
\usepackage{caption}
\captionsetup{font={footnotesize,stretch=1.25},labelsep=period,labelfont=bf, singlelinecheck=off, justification=centering}

%表格
\usepackage{booktabs} %表格
\usepackage{tabularx} %表格宽度
\usepackage{multirow} %多行合并
\usepackage{longtable} % latex 多页显示同一表格
\usepackage{tabu} % 使用longtabu（tabularx + longtable）将长文本在单元格多行显示。
% \captionsetup[table]{name={表},font={footnotesize,stretch=1.25},labelsep=period,labelfont=bf, singlelinecheck=off, justification=centering} 


%%%————————————————————————————————超链接
\usepackage[
	colorlinks,
	urlcolor=MsBlue, % 超链接的颜色。默认是芭比粉
	linkcolor=black,
	anchorcolor=black,
	citecolor=black,
	CJKbookmarks=True
]{hyperref}
\pdfstringdefDisableCommands{%
  \def\linebreak{}%
}

%%%————————————————————————————————参考文献（兼容“xe->bib->xe->xe”）
% 目标：
% 1) 即使正文暂时没有任何 \cite，也能顺利执行 bibtex（不报“no \\bibdata/no \\bibstyle/no \\citation”）。
% 2) 只有在正文实际使用了引用时，才在文末输出“参考文献”，避免空参考文献页影响版式对齐。
\newif\ifNSFCHasCite
\NSFCHasCitefalse
\AtBeginDocument{%
  \pretocmd{\cite}{\global\NSFCHasCitetrue}{}{}%
  \pretocmd{\nocite}{\global\NSFCHasCitetrue}{}{}%
}
\makeatletter
% 参考文献由 main.tex 中的 \input{references/reference.tex} 手动控制
% \AtBeginDocument{%
%   \immediate\write\@auxout{\string\bibdata{references/myexample}}%
%   \immediate\write\@auxout{\string\bibstyle{bibtex-style/gbt7714-nsfc}}%
% }
% \AtEndDocument{%
%   \ifNSFCHasCite
%     \bibliographystyle{bibtex-style/gbt7714-nsfc}
%     \bibliography{references/myexample}
%   \else
%     % 若当前文档未使用任何引用，为了让"xe->bib->xe->xe"流程不报错，
%     % 这里写入一个"哑引用"到 aux（bibtex 能正常运行，但不会在 PDF 中输出参考文献）。
%     \immediate\write\@auxout{\string\citation{Smith1900}}%
%   \fi
% }
\makeatother

%%%————————————————————————————————参考文献间距（可调，且不影响其它样式）
% 间距调节（与 Local/Young 完全一致）：
% - 标题与上文：\NSFCBibTitleAboveSkip（进入参考文献块前的额外垂直距离）
% - 标题与条目：\NSFCBibTitleBelowSkip（在标题后额外增加/减少的垂直距离）
% - 条目间距：\NSFCBibItemSep（thebibliography 的 \itemsep）
% - 条目行宽：\NSFCBibTextWidth（用于跨项目消除换行差异）
%
% 用法：直接改下面四个 length 的值即可（允许负值微调）。
\newlength{\NSFCBibTitleAboveSkip}
\newlength{\NSFCBibTitleBelowSkip}
\newlength{\NSFCBibItemSep}
\newlength{\NSFCBibTextWidth}
% 默认值：保持当前模板视觉效果（对应旧版 reference.tex 的 \vspace{15pt}）
\setlength{\NSFCBibTitleAboveSkip}{15pt}
\setlength{\NSFCBibTitleBelowSkip}{0pt}
\setlength{\NSFCBibItemSep}{0pt}
\setlength{\NSFCBibTextWidth}{397.16727pt} % 推荐默认值：按 Young 的"参考文献条目有效行宽"对齐，用于降低跨项目换行差异；需要更宽/更窄可自行调整
% 说明：上述参数会在本文件末尾的 thebibliography 环境重定义中生效（仅影响参考文献块）。


%%%————————————————————————————————标题计数

% [latex 标题、段落及行距 - 简书](https://www.jianshu.com/p/d7848f815e5f/)
% [LaTeX 中的行间距](https://yinguobing.com/linespace-in-latex/)

\usepackage{titlesec}

\setcounter{secnumdepth}{4} %显示3级目录，然后再具体定制不同的目录
% \setcounter{tocdepth}{4}

% Define section font
\newcommand{\sectionzihao}{\fontsize{14pt}{22pt}\selectfont}
\newcommand{\subsectionzihao}{\fontsize{14pt}{22pt}\selectfont}
\newcommand{\subsubsectionzihao}{\fontsize{13.5pt}{20pt}\selectfont}

% Custom format for section
\titleformat{\section}
  {\color{MsBlue} \sectionzihao \templatefont \bfseries} % format
  {\hspace*{2em}} % label（用于缩进，不影响标题文字内容）
  {0pt} % separation
  {}   % before-code

% Custom format for subsection
\titleformat{\subsection}
  {\color{MsBlue} \subsectionzihao \templatefont} % format
  {} % label
  {0pt} % separation
  {\hspace*{2em}}   % before-code（用于首行缩进，续行自然顶格）

% Custom format for subsubsection
\titleformat{\subsubsection}
  {\color{MsBlue} \subsubsectionzihao \templatefont \bfseries} % format
  {\hspace{1.1em}  \textnormal{\templatefont \arabic{subsection}.\arabic{subsubsection}}} % label
  {0.5em} % separation
  {}   % before-code
\renewcommand\thesubsubsection{\arabic{subsection}.\arabic{subsubsection}} % Reference rule for subsubsection

% Custom format for subsubsubsection
\titleclass{\subsubsubsection}{straight}[\subsubsection]
\newcounter{subsubsubsection}[subsubsection]
\renewcommand\thesubsubsubsection{（\arabic{subsubsubsection}）}
\titleformat{\subsubsubsection}
  {\templatefont \bfseries} % format \color{MsBlue} 
  {\hspace{1em} （\arabic{subsubsubsection}）} % label
  {0.5pt} % separation
  {}   % before-code
\makeatletter
\def\toclevel@subsubsubsection{4}
\def\l@subsubsubsection{\@dottedtocline{4}{7.0em}{4em}}
\makeatother

% Define line stretch for section
\titlespacing*{\section}
  {0pt} % Left indentation
  {0pt plus 0pt minus 0pt} % Space before the title
  {-7pt} % Space after the title（大幅减小与 subsection 的距离）

% Define line stretch for subsection
\titlespacing*{\subsection}
  {0pt} % Left indentation
  {-8pt plus 0pt minus 0pt} % Space before the title（大幅减小与 section 的距离）
  {0pt} % Space after the title（由 \parskip 控制段后）

% Define line stretch for subsubsection
\titlespacing*{\subsubsection}
  {0pt} % Left indentation
  {0pt plus 0pt minus 0pt} % Space before the title
  {0pt plus 0pt minus 0pt} % Space after the title

% Define line stretch for subsubsection
\titlespacing*{\subsubsubsection}
  {0pt} % Left indentation
  {0pt plus 0pt minus 0pt} % Space before the title
  {0pt plus 0pt minus 0pt} % Space after the title


%%%————————————————————————————————代码
\usepackage{listings} %代码块
\usepackage{xcolor}%代码块
\renewcommand{\lstlistingname}{Code}

% 参考：
% https://www.youtube.com/watch?v=qxkQgG1Y0bY
% https://zhuanlan.zhihu.com/p/65441079

% \lstset{
% 	% language=bash,  %代码语言使用的是matlab
% 	frame=shadowbox, %把代码用带有阴影的框圈起来
% 	rulesepcolor=\color{red!20!green!20!blue!20},%代码块边框为淡青色
% 	keywordstyle=\color{blue!90}\bfseries, %代码关键字的颜色为蓝色，粗体
% 	commentstyle=\color{red!10!green!70}\textit,% 设置代码注释的颜色
% 	showstringspaces=true,%不显示代码字符串中间的空格标记
% 	numbers=left, % 显示行号
% 	numberstyle=\tiny,    % 行号字体
% 	stringstyle=\ttfamily, % 代码字符串的特殊格式
% 	breaklines=false, %对过长的代码自动换行
% 	extendedchars=false,  %解决代码跨页时，章节标题，页眉等汉字不显示的问题
% 	escapebegin=\begin{CJK*},escapeend=\end{CJK*},% 代码中出现中文必须加上，否则报错
% 	texcl=true
% }

\lstdefinestyle{codestyle01}{
	backgroundcolor=\color{gray!12},
	%basicstyle=\ttfamily\small,
	basicstyle=\zihao{-5}\ttfamily,
	commentstyle=\color{green!60!black},
	keywordstyle=\color{magenta},
	stringstyle=\color{blue!50!red},
	showstringspaces=false,
	numbers=left,
	numberstyle=\footnotesize\color{gray},
	numbersep=10pt,
	stepnumber=1,
	tabsize=4,
	frame=single,
	framerule=0.3pt,
	rulecolor=\color{black!20},
	xleftmargin=2em,
	xrightmargin=0.5em,
	breaklines=true,
	breakatwhitespace=true,
	captionpos=b
	% frame=tblr
	% frame=L,
	% framerule=1pt,
	% rulecolor=\color{red}
}
\lstset{style=codestyle01}


%%%————————————————————————————————其它设置


\makeatletter	
	\setlength{\@fptop}{0pt} % 图片置顶展示（而不是居中）
  % \setlength{\textfloatsep}{1cm plus 1.0pt minus 2.0pt} % 浮动体（如figure）之间的垂直间距
  \setlength{\intextsep}{0.5cm plus 1.0pt minus 2.0pt} % 浮动体（如figure）与文字的垂直间距
\makeatother

% 去除页码
\pagestyle{empty}

% 汉字与标点的间距；
% \punctstyle{banjiao} % 所有标点半角
% \punctstyle{kaiming} % 部分的标点半角
\punctstyle{hangmobanjiao} % 末半角式，仅行末挤压。

% 参考文献间距（可调）：标题与上文/标题与条目/条目间距（见上方 \NSFCBib* 三个参数）
% 说明：不使用 \section*{\refname}（避免 titlesec 对 \section 的 spacing 差异影响参考文献），
% 仅在 thebibliography 内部手工排标题与列表参数，从而保证三套项目在“同样参考文献参数”下表现一致。
\makeatletter
\renewenvironment{thebibliography}[1]{%
  \par\addvspace{\NSFCBibTitleAboveSkip}%
  \noindent{\refname}\par%
  \vspace{\NSFCBibTitleBelowSkip}%
  \frenchspacing%
  \list{\@biblabel{\@arabic\c@enumiv}}{%
    \settowidth\labelwidth{\@biblabel{#1}}%
    \leftmargin\labelwidth
    \advance\leftmargin\labelsep
    % 统一条目行宽（跨项目像素级一致性依赖此项）
    \rightmargin=\dimexpr\textwidth-\NSFCBibTextWidth-\leftmargin\relax
    \ifdim\rightmargin<0pt\relax \rightmargin=0pt\relax \fi
    \setlength{\itemsep}{\NSFCBibItemSep}%
    \setlength{\parsep}{0pt}%
    \setlength{\parskip}{0pt}%
    \setlength{\topsep}{0pt}%
    \setlength{\partopsep}{0pt}%
    \usecounter{enumiv}%
    \let\p@enumiv\@empty
    \renewcommand\theenumiv{\@arabic\c@enumiv}%
  }%
  \sloppy\clubpenalty4000\widowpenalty4000%
  \sfcode`\.=1000\relax%
}{%
  \def\@noitemerr{\@latex@warning{Empty `thebibliography' environment}}%
  \endlist%
}
\makeatother

% 参考文献中的链接字体用的是texttt
\renewcommand{\ttdefault}{tnr} % 设置默认等宽字体为 Times New Roman

% 自定义第4级小标题
% \newcommand{\ssssubtitle}[1]{\ding{\numexpr171+#1\relax}} % 类似①
\newcommand{\ssssubtitle}[1]{\textcircled{\raisebox{-0.8pt}{\xiaosihao #1}}}
% \newcommand{\ssssubtitle}[1]{#1）} % 类似1）
% \newcommand{\blackding}[1]{\ding{\numexpr181+#1\relax}}
% \newcommand{\whitedingB}[1]{\ding{\numexpr191+#1\relax}}
% \newcommand{\blackdingB}[1]{\ding{\numexpr201+#1\relax}}
